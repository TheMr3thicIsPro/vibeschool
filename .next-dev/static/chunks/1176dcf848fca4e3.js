(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,83823,e=>{"use strict";var t=e.i(47167);class s{storageKey="vibeschool-community-data";DEBUG_COMMUNITY="true"===t.default.env.DEBUG_COMMUNITY;constructor(){this.initStorage()}initStorage(){localStorage.getItem(this.storageKey)||localStorage.setItem(this.storageKey,JSON.stringify({profiles:[],friendRequests:[],friends:[],conversations:[],conversationMembers:[],messages:[],blocks:[],reports:[],typingIndicators:{}}))}getData(){let e=localStorage.getItem(this.storageKey);if(!e)return this.initStorage(),this.getData();try{return JSON.parse(e)}catch(e){return console.error("[COMMUNITY][LocalDB] Error parsing data:",e),this.initStorage(),this.getData()}}setData(e){localStorage.setItem(this.storageKey,JSON.stringify(e))}async getProfile(e){let t=this.getData().profiles.find(t=>t.id===e)||null;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] getProfile",{userId:e,profile:t?"found":"not found"}),t}async updateProfile(e,t){let s=this.getData(),r=s.profiles.findIndex(t=>t.id===e);if(-1!==r)s.profiles[r]={...s.profiles[r],...t,last_seen_at:new Date().toISOString()};else{let r={id:e,username:t.username||"",display_name:t.display_name||"",avatar_url:t.avatar_url,role:t.role||"student",created_at:new Date().toISOString(),last_seen_at:new Date().toISOString(),is_online:!1};s.profiles.push(r)}return this.setData(s),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] updateProfile",{userId:e,data:t}),s.profiles.find(t=>t.id===e)}async searchProfiles(e){let t=this.getData(),s=e.toLowerCase(),r=t.profiles.filter(e=>e.username.toLowerCase().includes(s)||e.display_name.toLowerCase().includes(s));return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] searchProfiles",{query:e,results:r.length}),r}async createFriendRequest(e,t){let s=this.getData(),r={id:crypto.randomUUID(),requester_id:e,addressee_id:t,status:"pending",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return s.friendRequests.push(r),this.setData(s),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] createFriendRequest",{requesterId:e,addresseeId:t,requestId:r.id}),r}async updateFriendRequest(e,t){let s=this.getData(),r=s.friendRequests.findIndex(t=>t.id===e);if(-1!==r){if(s.friendRequests[r].status=t,s.friendRequests[r].updated_at=new Date().toISOString(),"accepted"===t){let e=s.friendRequests[r],t={user_id:e.requester_id,friend_id:e.addressee_id,created_at:new Date().toISOString()},a={user_id:e.addressee_id,friend_id:e.requester_id,created_at:new Date().toISOString()};s.friends.push(t,a)}return this.setData(s),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] updateFriendRequest",{requestId:e,status:t}),s.friendRequests[r]}throw Error("Friend request not found")}async getFriendRequests(e){let t=this.getData().friendRequests.filter(t=>t.addressee_id===e||t.requester_id===e);return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] getFriendRequests",{userId:e,count:t.length}),t}async getFriends(e){let t=this.getData().friends.filter(t=>t.user_id===e);return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] getFriends",{userId:e,count:t.length}),t}async unfriend(e,t){let s=this.getData();s.friends=s.friends.filter(s=>s.user_id!==e||s.friend_id!==t||s.user_id!==t||s.friend_id!==e),this.setData(s),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] unfriend",{userId:e,friendId:t})}async createConversation(e,t,s,r){let a=this.getData(),o={id:crypto.randomUUID(),is_group:e,title:s||(e?"Group Chat":void 0),created_by:t,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};a.conversations.push(o);let i={conversation_id:o.id,user_id:t,role:"owner",joined_at:new Date().toISOString()};if(a.conversationMembers.push(i),r){for(let e of r)if(e!==t){let t={conversation_id:o.id,user_id:e,role:"member",joined_at:new Date().toISOString()};a.conversationMembers.push(t)}}return this.setData(a),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] createConversation",{isGroup:e,createdBy:t,title:s,userIds:r,conversationId:o.id}),o}async getConversations(e){let t=this.getData(),s=t.conversationMembers.filter(t=>t.user_id===e).map(e=>e.conversation_id),r=t.conversations.filter(e=>s.includes(e.id));return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] getConversations",{userId:e,count:r.length}),r}async getConversation(e){let t=this.getData().conversations.find(t=>t.id===e)||null;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] getConversation",{conversationId:e,found:!!t}),t}async addConversationMember(e,t,s="member"){let r=this.getData();if(!r.conversationMembers.find(s=>s.conversation_id===e&&s.user_id===t)){let a={conversation_id:e,user_id:t,role:s,joined_at:new Date().toISOString()};r.conversationMembers.push(a),this.setData(r),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] addConversationMember",{conversationId:e,userId:t,role:s})}}async removeConversationMember(e,t){let s=this.getData();s.conversationMembers=s.conversationMembers.filter(s=>s.conversation_id!==e||s.user_id!==t),this.setData(s),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] removeConversationMember",{conversationId:e,userId:t})}async updateConversation(e,t){let s=this.getData(),r=s.conversations.findIndex(t=>t.id===e);-1!==r&&(s.conversations[r]={...s.conversations[r],...t,updated_at:new Date().toISOString()},this.setData(s),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] updateConversation",{conversationId:e,data:t}))}async createMessage(e){let t=this.getData(),s={...e,id:crypto.randomUUID(),created_at:new Date().toISOString()};return t.messages.push(s),this.setData(t),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] createMessage",{conversationId:e.conversation_id,senderId:e.sender_id,messageId:s.id}),s}async getMessages(e,t=0,s=50){let r=this.getData().messages.filter(t=>t.conversation_id===e&&!t.deleted_at).sort((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime()).slice(t,t+s);return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] getMessages",{conversationId:e,offset:t,limit:s,count:r.length}),r}async updateMessage(e,t){let s=this.getData(),r=s.messages.findIndex(t=>t.id===e);if(-1!==r)return s.messages[r].body=t,s.messages[r].edited_at=new Date().toISOString(),this.setData(s),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] updateMessage",{messageId:e,body:t}),s.messages[r];throw Error("Message not found")}async deleteMessage(e){let t=this.getData(),s=t.messages.findIndex(t=>t.id===e);-1!==s&&(t.messages[s].deleted_at=new Date().toISOString(),this.setData(t),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] deleteMessage",{messageId:e}))}async blockUser(e,t){let s=this.getData();if(!s.blocks.find(s=>s.blocker_id===e&&s.blocked_id===t)){let r={blocker_id:e,blocked_id:t,created_at:new Date().toISOString()};s.blocks.push(r),this.setData(s),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] blockUser",{blockerId:e,blockedId:t})}}async unblockUser(e,t){let s=this.getData();s.blocks=s.blocks.filter(s=>s.blocker_id!==e||s.blocked_id!==t),this.setData(s),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] unblockUser",{blockerId:e,blockedId:t})}async isBlocked(e,t){let s=this.getData().blocks.some(s=>s.blocker_id===e&&s.blocked_id===t);return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] isBlocked",{blockerId:e,blockedId:t,isBlocked:s}),s}async reportUser(e,t,s){let r=this.getData(),a={id:crypto.randomUUID(),reporter_id:e,reported_user_id:t,reason:s,created_at:new Date().toISOString()};return r.reports.push(a),this.setData(r),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] reportUser",{reporterId:e,reportedUserId:t,reason:s}),a}async reportMessage(e,t,s){let r=this.getData(),a={id:crypto.randomUUID(),reporter_id:e,message_id:t,reason:s,created_at:new Date().toISOString()};return r.reports.push(a),this.setData(r),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] reportMessage",{reporterId:e,messageId:t,reason:s}),a}setTypingStatus(e,t,s){this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] setTypingStatus",{conversationId:e,userId:t,isTyping:s});let r=this.getData(),a=Date.now(),o=r.typingIndicators[e]||[];if(s){let e=o.findIndex(e=>e.userId===t);e>=0?o[e].timestamp=a:o.push({userId:t,timestamp:a})}else{let e=o.findIndex(e=>e.userId===t);e>=0&&o.splice(e,1)}r.typingIndicators[e]=o,this.setData(r)}async getTypingUsers(e){let t=this.getData(),s=Date.now()-5e3,r=(t.typingIndicators[e]||[]).filter(e=>e.timestamp>s);t.typingIndicators[e]=r,this.setData(t);let a=r.map(e=>e.userId);return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] getTypingUsers",{conversationId:e,userIds:a}),a}async markAsRead(e,t,s){let r=this.getData(),a=r.conversationMembers.findIndex(s=>s.conversation_id===e&&s.user_id===t);-1!==a&&(r.conversationMembers[a].last_read_at=s,this.setData(r),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] markAsRead",{conversationId:e,userId:t,lastReadAt:s}))}async getUnreadCount(e,t){let s=this.getData(),r=s.conversationMembers.find(s=>s.conversation_id===e&&s.user_id===t),a=new Date(r?.last_read_at?r.last_read_at:0),o=s.messages.filter(s=>s.conversation_id===e&&new Date(s.created_at)>a&&s.sender_id!==t).length;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] getUnreadCount",{conversationId:e,userId:t,unreadCount:o}),o}}var r=e.i(88715);class a{supabase;DEBUG_COMMUNITY="true"===t.default.env.DEBUG_COMMUNITY;constructor(){this.supabase=(0,r.createClient)("https://toorbxzuursbcykjujhh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvb3JieHp1dXJzYmN5a2p1amhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2OTI0NDQsImV4cCI6MjA4MzI2ODQ0NH0.ciBMNKhEpYDQP1g-JjlP_1amlDPccc4YJbJ4LNiOwX8")}async getProfile(e){let{data:t,error:s}=await this.supabase.from("profiles").select("*").eq("id",e).single();return s?(this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] getProfile error",s),null):(this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] getProfile",{userId:e,profile:t?"found":"not found"}),t)}async updateProfile(e,t){let{data:s,error:r}=await this.supabase.from("profiles").update({...t,last_seen_at:new Date().toISOString()}).eq("id",e).select().single();if(r)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] updateProfile error",r),r;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] updateProfile",{userId:e,data:t}),s}async searchProfiles(e){let{data:t,error:s}=await this.supabase.from("profiles").select("*").or(`username.ilike.%${e}%,display_name.ilike.%${e}%`);return s?(this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] searchProfiles error",s),[]):(this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] searchProfiles",{query:e,results:t?.length||0}),t)}async createFriendRequest(e,t){let s={id:crypto.randomUUID(),requester_id:e,addressee_id:t,status:"pending",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:r,error:a}=await this.supabase.from("friend_requests").insert([s]).select().single();if(a)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] createFriendRequest error",a),a;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] createFriendRequest",{requesterId:e,addresseeId:t,requestId:r.id}),r}async updateFriendRequest(e,t){let{data:s,error:r}=await this.supabase.from("friend_requests").update({status:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(r)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] updateFriendRequest error",r),r;if("accepted"===t&&s){let e={user_id:s.requester_id,friend_id:s.addressee_id,created_at:new Date().toISOString()},t={user_id:s.addressee_id,friend_id:s.requester_id,created_at:new Date().toISOString()};await this.supabase.from("friends").insert([e,t])}return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] updateFriendRequest",{requestId:e,status:t}),s}async getFriendRequests(e){let{data:t,error:s}=await this.supabase.from("friend_requests").select("*").or(`requester_id.eq.${e},addressee_id.eq.${e}`);return s?(this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] getFriendRequests error",s),[]):(this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] getFriendRequests",{userId:e,count:t?.length||0}),t)}async getFriends(e){let{data:t,error:s}=await this.supabase.from("friends").select("*").eq("user_id",e);return s?(this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] getFriends error",s),[]):(this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] getFriends",{userId:e,count:t?.length||0}),t)}async unfriend(e,t){await this.supabase.from("friends").delete().or(`(user_id.eq.${e},friend_id.eq.${t}),(user_id.eq.${t},friend_id.eq.${e})`),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] unfriend",{userId:e,friendId:t})}async createConversation(e,t,s,r){let a={id:crypto.randomUUID(),is_group:e,title:s||(e?"Group Chat":void 0),created_by:t,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:o,error:i}=await this.supabase.from("conversations").insert([a]).select().single();if(i)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] createConversation error",i),i;if(await this.supabase.from("conversation_members").insert([{conversation_id:o.id,user_id:t,role:"owner",joined_at:new Date().toISOString()}]),r)for(let e of r)e!==t&&await this.supabase.from("conversation_members").insert([{conversation_id:o.id,user_id:e,role:"member",joined_at:new Date().toISOString()}]);return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] createConversation",{isGroup:e,createdBy:t,title:s,userIds:r,conversationId:o.id}),o}async getConversations(e){let{data:t,error:s}=await this.supabase.from("conversation_members").select("conversation_id").eq("user_id",e);if(s)return this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] getConversations error",s),[];let r=t.map(e=>e.conversation_id),{data:a,error:o}=await this.supabase.from("conversations").select("*").in("id",r);return o?(this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] getConversations error fetching conversations",o),[]):(this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] getConversations",{userId:e,count:a?.length||0}),a)}async getConversation(e){let{data:t,error:s}=await this.supabase.from("conversations").select("*").eq("id",e).single();return s?(this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] getConversation error",s),null):(this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] getConversation",{conversationId:e,found:!!t}),t)}async addConversationMember(e,t,s="member"){let{error:r}=await this.supabase.from("conversation_members").insert([{conversation_id:e,user_id:t,role:s,joined_at:new Date().toISOString()}]);if(r)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] addConversationMember error",r),r;this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] addConversationMember",{conversationId:e,userId:t,role:s})}async removeConversationMember(e,t){let{error:s}=await this.supabase.from("conversation_members").delete().match({conversation_id:e,user_id:t});if(s)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] removeConversationMember error",s),s;this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] removeConversationMember",{conversationId:e,userId:t})}async updateConversation(e,t){let{error:s}=await this.supabase.from("conversations").update({...t,updated_at:new Date().toISOString()}).eq("id",e);if(s)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] updateConversation error",s),s;this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] updateConversation",{conversationId:e,data:t})}async createMessage(e){let t={...e,id:crypto.randomUUID(),created_at:new Date().toISOString()},{data:s,error:r}=await this.supabase.from("messages").insert([t]).select().single();if(r)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] createMessage error",r),r;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] createMessage",{conversationId:e.conversation_id,senderId:e.sender_id,messageId:s.id}),s}async getMessages(e,t=0,s=50){let{data:r,error:a}=await this.supabase.from("messages").select("*").eq("conversation_id",e).is("deleted_at",null).order("created_at",{ascending:!0}).range(t,t+s-1);return a?(this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] getMessages error",a),[]):(this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] getMessages",{conversationId:e,offset:t,limit:s,count:r?.length||0}),r)}async updateMessage(e,t){let{data:s,error:r}=await this.supabase.from("messages").update({body:t,edited_at:new Date().toISOString()}).eq("id",e).select().single();if(r)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] updateMessage error",r),r;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] updateMessage",{messageId:e,body:t}),s}async deleteMessage(e){let{error:t}=await this.supabase.from("messages").update({deleted_at:new Date().toISOString()}).eq("id",e);if(t)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] deleteMessage error",t),t;this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] deleteMessage",{messageId:e})}async blockUser(e,t){let s={blocker_id:e,blocked_id:t,created_at:new Date().toISOString()},{error:r}=await this.supabase.from("blocks").insert([s]);if(r)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] blockUser error",r),r;this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] blockUser",{blockerId:e,blockedId:t})}async unblockUser(e,t){let{error:s}=await this.supabase.from("blocks").delete().match({blocker_id:e,blocked_id:t});if(s)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] unblockUser error",s),s;this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] unblockUser",{blockerId:e,blockedId:t})}async isBlocked(e,t){let{data:s,error:r}=await this.supabase.from("blocks").select("id").match({blocker_id:e,blocked_id:t}).single();if(r&&"PGRST116"!==r.code)return this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] isBlocked error",r),!1;let a=!!s;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] isBlocked",{blockerId:e,blockedId:t,isBlocked:a}),a}async reportUser(e,t,s){let r={id:crypto.randomUUID(),reporter_id:e,reported_user_id:t,reason:s,created_at:new Date().toISOString()},{data:a,error:o}=await this.supabase.from("reports").insert([r]).select().single();if(o)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] reportUser error",o),o;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] reportUser",{reporterId:e,reportedUserId:t,reason:s}),a}async reportMessage(e,t,s){let r={id:crypto.randomUUID(),reporter_id:e,message_id:t,reason:s,created_at:new Date().toISOString()},{data:a,error:o}=await this.supabase.from("reports").insert([r]).select().single();if(o)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] reportMessage error",o),o;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] reportMessage",{reporterId:e,messageId:t,reason:s}),a}setTypingStatus(e,t,s){this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] setTypingStatus",{conversationId:e,userId:t,isTyping:s})}async getTypingUsers(e){return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] getTypingUsers",{conversationId:e}),[]}async markAsRead(e,t,s){let{error:r}=await this.supabase.from("conversation_members").update({last_read_at:s}).match({conversation_id:e,user_id:t});if(r)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] markAsRead error",r),r;this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] markAsRead",{conversationId:e,userId:t,lastReadAt:s})}async getUnreadCount(e,t){let{data:s,error:r}=await this.supabase.from("conversation_members").select("last_read_at").match({conversation_id:e,user_id:t}).single();if(r)return this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] getUnreadCount error getting member",r),0;let a=new Date(s?.last_read_at?s.last_read_at:0),{count:o,error:i}=await this.supabase.from("messages").select("*",{count:"exact",head:!0}).eq("conversation_id",e).gt("created_at",a.toISOString()).neq("sender_id",t).is("deleted_at",null);return i?(this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] getUnreadCount error getting count",i),0):(this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] getUnreadCount",{conversationId:e,userId:t,unreadCount:o}),o||0)}}let o=null,i=async()=>{if(o)return o;let e="true"===t.default.env.DEBUG_COMMUNITY;try{if((await fetch("https://toorbxzuursbcykjujhh.supabase.co/auth/v1/health")).ok)return e&&console.log("[COMMUNITY] Using SupabaseDB backend"),o=new a}catch(t){e&&console.log("[COMMUNITY] Supabase not reachable, using LocalDB backend")}return e&&console.log("[COMMUNITY] Using LocalDB backend"),o=new s};e.s(["getCommunityDB",0,i],83823)},89922,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(32341),a=e.i(83823);e.s(["default",0,()=>{let{state:e}=(0,r.useAuthStore)(),o=e.user,[i,n]=(0,s.useState)(""),[l,d]=(0,s.useState)(""),[c,u]=(0,s.useState)(null),[M,g]=(0,s.useState)(null),[U,h]=(0,s.useState)(!1),[D,I]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{I(await (0,a.getCommunityDB)())})()},[]);let _=async()=>{if(i&&o)try{h(!0),console.log("[FRIENDREQ] send to",i);let e=await fetch("/api/friends/requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({toUserId:i})}),t=await e.json();console.log("[FRIENDREQ] response",e.status,t),d(JSON.stringify(t,null,2))}catch(e){console.error("[FRIENDREQ] Error sending friend request:",e),d(`Error: ${e}`)}finally{h(!1)}},p=async()=>{try{h(!0);let e=await fetch("/api/friends/requests"),t=await e.json();u(t),d(JSON.stringify(t,null,2))}catch(e){console.error("[FRIENDREQ] Error getting requests:",e),d(`Error: ${e}`)}finally{h(!1)}},C=async()=>{try{h(!0);let e=await fetch("/api/friends"),t=await e.json();g(t),d(JSON.stringify(t,null,2))}catch(e){console.error("[FRIENDREQ] Error getting friends:",e),d(`Error: ${e}`)}finally{h(!1)}};return(0,t.jsx)("div",{className:"min-h-screen bg-gray-900 text-white p-8",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-8 text-center",children:"Friend Request Test Page"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,t.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"User Info"}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("p",{className:"text-gray-300",children:[(0,t.jsx)("strong",{children:"Current User ID:"})," ",o?.id||"Not logged in"]}),(0,t.jsxs)("p",{className:"text-gray-300",children:[(0,t.jsx)("strong",{children:"Current Username:"})," ",o?.username||"Not logged in"]})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"block text-gray-300 mb-2",children:"To User ID:"}),(0,t.jsx)("input",{type:"text",value:i,onChange:e=>n(e.target.value),placeholder:"Enter user ID to send request to",className:"w-full bg-gray-700 text-white rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-accent-primary"})]}),(0,t.jsx)("button",{onClick:_,disabled:U||!i||!o,className:"w-full py-2 bg-accent-primary text-white rounded-lg hover:bg-accent-primary/90 disabled:opacity-50 border border-accent-primary",children:U?"Sending...":"SEND REQUEST"})]}),(0,t.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Actions"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("button",{onClick:p,disabled:U,className:"w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-500 disabled:opacity-50",children:"GET REQUESTS"}),(0,t.jsx)("button",{onClick:C,disabled:U,className:"w-full py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 disabled:opacity-50",children:"GET FRIENDS"})]}),(0,t.jsxs)("div",{className:"mt-6",children:[(0,t.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Last Response:"}),(0,t.jsx)("pre",{className:"bg-gray-900 p-4 rounded text-sm overflow-auto max-h-60",children:l||"No response yet"})]})]})]}),c&&(0,t.jsxs)("div",{className:"mt-8 bg-gray-800 p-6 rounded-lg",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Recent Requests"}),(0,t.jsx)("div",{className:"overflow-auto",children:(0,t.jsx)("pre",{className:"text-sm",children:JSON.stringify(c,null,2)})})]}),M&&(0,t.jsxs)("div",{className:"mt-8 bg-gray-800 p-6 rounded-lg",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Friends List"}),(0,t.jsx)("div",{className:"overflow-auto",children:(0,t.jsx)("pre",{className:"text-sm",children:JSON.stringify(M,null,2)})})]})]})})}])}]);