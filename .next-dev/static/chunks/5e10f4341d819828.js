(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,46753,e=>{"use strict";let t=(0,e.i(75254).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["default",()=>t])},18566,(e,t,s)=>{t.exports=e.r(76562)},75254,e=>{"use strict";var t=e.i(71645);let s=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},a=(...e)=>e.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim();var r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,t.forwardRef)(({color:e="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:n,className:o="",children:l,iconNode:d,...c},u)=>(0,t.createElement)("svg",{ref:u,...r,width:s,height:s,stroke:e,strokeWidth:n?24*Number(i)/Number(s):i,className:a("lucide",o),...!l&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(c)&&{"aria-hidden":"true"},...c},[...d.map(([e,s])=>(0,t.createElement)(e,s)),...Array.isArray(l)?l:[l]])),n=(e,r)=>{let n=(0,t.forwardRef)(({className:n,...o},l)=>(0,t.createElement)(i,{ref:l,iconNode:r,className:a(`lucide-${s(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,n),...o}));return n.displayName=s(e),n};e.s(["default",()=>n],75254)},48010,43194,12978,e=>{"use strict";var t=e.i(43476),s=e.i(32341),a=e.i(18566),r=e.i(71645);let i=({duration:e=3e3,className:t="",showPercentage:s=!0})=>{let[a,i]=(0,r.useState)(0);return(0,r.useEffect)(()=>{let t=setInterval(()=>{i(e=>e>=100?(clearInterval(t),100):e+1)},e/100);return()=>clearInterval(t)},[e]),r.default.createElement("div",{className:"w-full "+t},s&&r.default.createElement("div",{className:"flex justify-between items-center mb-2"},r.default.createElement("span",{className:"text-sm font-medium text-gray-300"},"Loading..."),r.default.createElement("span",{className:"text-sm font-medium text-accent-primary"},a+"%")),r.default.createElement("div",{className:"w-full bg-gray-800 rounded-full h-2.5"},r.default.createElement("div",{className:"bg-gradient-to-r from-accent-primary to-purple-600 h-2.5 rounded-full transition-all duration-100 ease-out",style:{width:a+"%"}})),a>=100&&r.default.createElement("div",{className:"mt-2 text-center text-sm text-green-400 animate-pulse"},"Complete!"))};e.s(["default",0,i],43194);let n=({className:e="",count:s=1,showLoadingBar:a=!1,loadingDuration:r=3e3})=>{let n=Array.from({length:s},(s,a)=>(0,t.jsx)("div",{className:`animate-pulse bg-gray-700 rounded ${e}`},a));return(0,t.jsxs)(t.Fragment,{children:[a&&(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsx)(i,{duration:r})}),n]})};e.s(["default",0,n],12978);let o=({className:e="",loadingText:s="Loading...",showLoadingBar:a=!0,showSkeletons:r=!0,skeletonCount:o=5,duration:l=5e3})=>(0,t.jsxs)("div",{className:`relative ${e}`,children:[a&&(0,t.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50 pt-2 px-4",children:(0,t.jsx)(i,{duration:l,showPercentage:!1})}),r&&(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"mb-8 text-center",children:[(0,t.jsx)(n,{className:"h-8 w-64 mb-4 mx-auto"}),(0,t.jsx)(n,{className:"h-4 w-48 mx-auto"})]}),(0,t.jsx)("div",{className:"space-y-6",children:Array.from({length:o}).map((e,s)=>(0,t.jsxs)("div",{className:"card p-6 border border-card-border",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)(n,{className:"h-6 w-32"}),(0,t.jsx)(n,{className:"h-4 w-16"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(n,{className:"h-4 w-full"}),(0,t.jsx)(n,{className:"h-4 w-5/6"}),(0,t.jsx)(n,{className:"h-4 w-4/6"}),(0,t.jsxs)("div",{className:"flex gap-3 mt-4",children:[(0,t.jsx)(n,{className:"h-10 w-24 rounded-lg"}),(0,t.jsx)(n,{className:"h-10 w-24 rounded-lg"})]})]})]},s))})]})]});e.s(["default",0,({children:e})=>{let[i,n]=(0,r.useState)(!1);(0,r.useEffect)(()=>{n(!0)},[]);let{state:l}=(0,s.useAuthStore)(),{user:d,authLoading:c}=l,u=(0,a.useRouter)();return((0,r.useEffect)(()=>{!i||c||d||u.push("/auth/login")},[i,d,c,u]),i)?c?(0,t.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,t.jsx)(o,{loadingText:"Checking authentication status..."})}):d?(0,t.jsx)(t.Fragment,{children:e}):null:(0,t.jsx)(t.Fragment,{children:e})}],48010)},83823,e=>{"use strict";var t=e.i(47167);class s{storageKey="vibeschool-community-data";DEBUG_COMMUNITY="true"===t.default.env.DEBUG_COMMUNITY;constructor(){this.initStorage()}initStorage(){localStorage.getItem(this.storageKey)||localStorage.setItem(this.storageKey,JSON.stringify({profiles:[],friendRequests:[],friends:[],conversations:[],conversationMembers:[],messages:[],blocks:[],reports:[],typingIndicators:{}}))}getData(){let e=localStorage.getItem(this.storageKey);if(!e)return this.initStorage(),this.getData();try{return JSON.parse(e)}catch(e){return console.error("[COMMUNITY][LocalDB] Error parsing data:",e),this.initStorage(),this.getData()}}setData(e){localStorage.setItem(this.storageKey,JSON.stringify(e))}async getProfile(e){let t=this.getData().profiles.find(t=>t.id===e)||null;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] getProfile",{userId:e,profile:t?"found":"not found"}),t}async updateProfile(e,t){let s=this.getData(),a=s.profiles.findIndex(t=>t.id===e);if(-1!==a)s.profiles[a]={...s.profiles[a],...t,last_seen_at:new Date().toISOString()};else{let a={id:e,username:t.username||"",display_name:t.display_name||"",avatar_url:t.avatar_url,role:t.role||"student",created_at:new Date().toISOString(),last_seen_at:new Date().toISOString(),is_online:!1};s.profiles.push(a)}return this.setData(s),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] updateProfile",{userId:e,data:t}),s.profiles.find(t=>t.id===e)}async searchProfiles(e){let t=this.getData(),s=e.toLowerCase(),a=t.profiles.filter(e=>e.username.toLowerCase().includes(s)||e.display_name.toLowerCase().includes(s));return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] searchProfiles",{query:e,results:a.length}),a}async createFriendRequest(e,t){let s=this.getData(),a={id:crypto.randomUUID(),requester_id:e,addressee_id:t,status:"pending",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return s.friendRequests.push(a),this.setData(s),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] createFriendRequest",{requesterId:e,addresseeId:t,requestId:a.id}),a}async updateFriendRequest(e,t){let s=this.getData(),a=s.friendRequests.findIndex(t=>t.id===e);if(-1!==a){if(s.friendRequests[a].status=t,s.friendRequests[a].updated_at=new Date().toISOString(),"accepted"===t){let e=s.friendRequests[a],t={user_id:e.requester_id,friend_id:e.addressee_id,created_at:new Date().toISOString()},r={user_id:e.addressee_id,friend_id:e.requester_id,created_at:new Date().toISOString()};s.friends.push(t,r)}return this.setData(s),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] updateFriendRequest",{requestId:e,status:t}),s.friendRequests[a]}throw Error("Friend request not found")}async getFriendRequests(e){let t=this.getData().friendRequests.filter(t=>t.addressee_id===e||t.requester_id===e);return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] getFriendRequests",{userId:e,count:t.length}),t}async getFriends(e){let t=this.getData().friends.filter(t=>t.user_id===e);return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] getFriends",{userId:e,count:t.length}),t}async unfriend(e,t){let s=this.getData();s.friends=s.friends.filter(s=>s.user_id!==e||s.friend_id!==t||s.user_id!==t||s.friend_id!==e),this.setData(s),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] unfriend",{userId:e,friendId:t})}async createConversation(e,t,s,a){let r=this.getData(),i={id:crypto.randomUUID(),is_group:e,title:s||(e?"Group Chat":void 0),created_by:t,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};r.conversations.push(i);let n={conversation_id:i.id,user_id:t,role:"owner",joined_at:new Date().toISOString()};if(r.conversationMembers.push(n),a){for(let e of a)if(e!==t){let t={conversation_id:i.id,user_id:e,role:"member",joined_at:new Date().toISOString()};r.conversationMembers.push(t)}}return this.setData(r),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] createConversation",{isGroup:e,createdBy:t,title:s,userIds:a,conversationId:i.id}),i}async getConversations(e){let t=this.getData(),s=t.conversationMembers.filter(t=>t.user_id===e).map(e=>e.conversation_id),a=t.conversations.filter(e=>s.includes(e.id));return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] getConversations",{userId:e,count:a.length}),a}async getConversation(e){let t=this.getData().conversations.find(t=>t.id===e)||null;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] getConversation",{conversationId:e,found:!!t}),t}async addConversationMember(e,t,s="member"){let a=this.getData();if(!a.conversationMembers.find(s=>s.conversation_id===e&&s.user_id===t)){let r={conversation_id:e,user_id:t,role:s,joined_at:new Date().toISOString()};a.conversationMembers.push(r),this.setData(a),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] addConversationMember",{conversationId:e,userId:t,role:s})}}async removeConversationMember(e,t){let s=this.getData();s.conversationMembers=s.conversationMembers.filter(s=>s.conversation_id!==e||s.user_id!==t),this.setData(s),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] removeConversationMember",{conversationId:e,userId:t})}async updateConversation(e,t){let s=this.getData(),a=s.conversations.findIndex(t=>t.id===e);-1!==a&&(s.conversations[a]={...s.conversations[a],...t,updated_at:new Date().toISOString()},this.setData(s),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] updateConversation",{conversationId:e,data:t}))}async createMessage(e){let t=this.getData(),s={...e,id:crypto.randomUUID(),created_at:new Date().toISOString()};return t.messages.push(s),this.setData(t),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] createMessage",{conversationId:e.conversation_id,senderId:e.sender_id,messageId:s.id}),s}async getMessages(e,t=0,s=50){let a=this.getData().messages.filter(t=>t.conversation_id===e&&!t.deleted_at).sort((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime()).slice(t,t+s);return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] getMessages",{conversationId:e,offset:t,limit:s,count:a.length}),a}async updateMessage(e,t){let s=this.getData(),a=s.messages.findIndex(t=>t.id===e);if(-1!==a)return s.messages[a].body=t,s.messages[a].edited_at=new Date().toISOString(),this.setData(s),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] updateMessage",{messageId:e,body:t}),s.messages[a];throw Error("Message not found")}async deleteMessage(e){let t=this.getData(),s=t.messages.findIndex(t=>t.id===e);-1!==s&&(t.messages[s].deleted_at=new Date().toISOString(),this.setData(t),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] deleteMessage",{messageId:e}))}async blockUser(e,t){let s=this.getData();if(!s.blocks.find(s=>s.blocker_id===e&&s.blocked_id===t)){let a={blocker_id:e,blocked_id:t,created_at:new Date().toISOString()};s.blocks.push(a),this.setData(s),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] blockUser",{blockerId:e,blockedId:t})}}async unblockUser(e,t){let s=this.getData();s.blocks=s.blocks.filter(s=>s.blocker_id!==e||s.blocked_id!==t),this.setData(s),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] unblockUser",{blockerId:e,blockedId:t})}async isBlocked(e,t){let s=this.getData().blocks.some(s=>s.blocker_id===e&&s.blocked_id===t);return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] isBlocked",{blockerId:e,blockedId:t,isBlocked:s}),s}async reportUser(e,t,s){let a=this.getData(),r={id:crypto.randomUUID(),reporter_id:e,reported_user_id:t,reason:s,created_at:new Date().toISOString()};return a.reports.push(r),this.setData(a),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] reportUser",{reporterId:e,reportedUserId:t,reason:s}),r}async reportMessage(e,t,s){let a=this.getData(),r={id:crypto.randomUUID(),reporter_id:e,message_id:t,reason:s,created_at:new Date().toISOString()};return a.reports.push(r),this.setData(a),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] reportMessage",{reporterId:e,messageId:t,reason:s}),r}setTypingStatus(e,t,s){this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] setTypingStatus",{conversationId:e,userId:t,isTyping:s});let a=this.getData(),r=Date.now(),i=a.typingIndicators[e]||[];if(s){let e=i.findIndex(e=>e.userId===t);e>=0?i[e].timestamp=r:i.push({userId:t,timestamp:r})}else{let e=i.findIndex(e=>e.userId===t);e>=0&&i.splice(e,1)}a.typingIndicators[e]=i,this.setData(a)}async getTypingUsers(e){let t=this.getData(),s=Date.now()-5e3,a=(t.typingIndicators[e]||[]).filter(e=>e.timestamp>s);t.typingIndicators[e]=a,this.setData(t);let r=a.map(e=>e.userId);return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] getTypingUsers",{conversationId:e,userIds:r}),r}async markAsRead(e,t,s){let a=this.getData(),r=a.conversationMembers.findIndex(s=>s.conversation_id===e&&s.user_id===t);-1!==r&&(a.conversationMembers[r].last_read_at=s,this.setData(a),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] markAsRead",{conversationId:e,userId:t,lastReadAt:s}))}async getUnreadCount(e,t){let s=this.getData(),a=s.conversationMembers.find(s=>s.conversation_id===e&&s.user_id===t),r=new Date(a?.last_read_at?a.last_read_at:0),i=s.messages.filter(s=>s.conversation_id===e&&new Date(s.created_at)>r&&s.sender_id!==t).length;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][LocalDB] getUnreadCount",{conversationId:e,userId:t,unreadCount:i}),i}}var a=e.i(88715);class r{supabase;DEBUG_COMMUNITY="true"===t.default.env.DEBUG_COMMUNITY;constructor(){this.supabase=(0,a.createClient)("https://toorbxzuursbcykjujhh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvb3JieHp1dXJzYmN5a2p1amhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2OTI0NDQsImV4cCI6MjA4MzI2ODQ0NH0.ciBMNKhEpYDQP1g-JjlP_1amlDPccc4YJbJ4LNiOwX8")}async getProfile(e){let{data:t,error:s}=await this.supabase.from("profiles").select("*").eq("id",e).single();return s?(this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] getProfile error",s),null):(this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] getProfile",{userId:e,profile:t?"found":"not found"}),t)}async updateProfile(e,t){let{data:s,error:a}=await this.supabase.from("profiles").update({...t,last_seen_at:new Date().toISOString()}).eq("id",e).select().single();if(a)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] updateProfile error",a),a;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] updateProfile",{userId:e,data:t}),s}async searchProfiles(e){let{data:t,error:s}=await this.supabase.from("profiles").select("*").or(`username.ilike.%${e}%,display_name.ilike.%${e}%`);return s?(this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] searchProfiles error",s),[]):(this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] searchProfiles",{query:e,results:t?.length||0}),t)}async createFriendRequest(e,t){let s={id:crypto.randomUUID(),requester_id:e,addressee_id:t,status:"pending",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:a,error:r}=await this.supabase.from("friend_requests").insert([s]).select().single();if(r)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] createFriendRequest error",r),r;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] createFriendRequest",{requesterId:e,addresseeId:t,requestId:a.id}),a}async updateFriendRequest(e,t){let{data:s,error:a}=await this.supabase.from("friend_requests").update({status:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(a)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] updateFriendRequest error",a),a;if("accepted"===t&&s){let e={user_id:s.requester_id,friend_id:s.addressee_id,created_at:new Date().toISOString()},t={user_id:s.addressee_id,friend_id:s.requester_id,created_at:new Date().toISOString()};await this.supabase.from("friends").insert([e,t])}return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] updateFriendRequest",{requestId:e,status:t}),s}async getFriendRequests(e){let{data:t,error:s}=await this.supabase.from("friend_requests").select("*").or(`requester_id.eq.${e},addressee_id.eq.${e}`);return s?(this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] getFriendRequests error",s),[]):(this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] getFriendRequests",{userId:e,count:t?.length||0}),t)}async getFriends(e){let{data:t,error:s}=await this.supabase.from("friends").select("*").eq("user_id",e);return s?(this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] getFriends error",s),[]):(this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] getFriends",{userId:e,count:t?.length||0}),t)}async unfriend(e,t){await this.supabase.from("friends").delete().or(`(user_id.eq.${e},friend_id.eq.${t}),(user_id.eq.${t},friend_id.eq.${e})`),this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] unfriend",{userId:e,friendId:t})}async createConversation(e,t,s,a){let r={id:crypto.randomUUID(),is_group:e,title:s||(e?"Group Chat":void 0),created_by:t,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:i,error:n}=await this.supabase.from("conversations").insert([r]).select().single();if(n)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] createConversation error",n),n;if(await this.supabase.from("conversation_members").insert([{conversation_id:i.id,user_id:t,role:"owner",joined_at:new Date().toISOString()}]),a)for(let e of a)e!==t&&await this.supabase.from("conversation_members").insert([{conversation_id:i.id,user_id:e,role:"member",joined_at:new Date().toISOString()}]);return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] createConversation",{isGroup:e,createdBy:t,title:s,userIds:a,conversationId:i.id}),i}async getConversations(e){let{data:t,error:s}=await this.supabase.from("conversation_members").select("conversation_id").eq("user_id",e);if(s)return this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] getConversations error",s),[];let a=t.map(e=>e.conversation_id),{data:r,error:i}=await this.supabase.from("conversations").select("*").in("id",a);return i?(this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] getConversations error fetching conversations",i),[]):(this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] getConversations",{userId:e,count:r?.length||0}),r)}async getConversation(e){let{data:t,error:s}=await this.supabase.from("conversations").select("*").eq("id",e).single();return s?(this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] getConversation error",s),null):(this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] getConversation",{conversationId:e,found:!!t}),t)}async addConversationMember(e,t,s="member"){let{error:a}=await this.supabase.from("conversation_members").insert([{conversation_id:e,user_id:t,role:s,joined_at:new Date().toISOString()}]);if(a)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] addConversationMember error",a),a;this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] addConversationMember",{conversationId:e,userId:t,role:s})}async removeConversationMember(e,t){let{error:s}=await this.supabase.from("conversation_members").delete().match({conversation_id:e,user_id:t});if(s)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] removeConversationMember error",s),s;this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] removeConversationMember",{conversationId:e,userId:t})}async updateConversation(e,t){let{error:s}=await this.supabase.from("conversations").update({...t,updated_at:new Date().toISOString()}).eq("id",e);if(s)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] updateConversation error",s),s;this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] updateConversation",{conversationId:e,data:t})}async createMessage(e){let t={...e,id:crypto.randomUUID(),created_at:new Date().toISOString()},{data:s,error:a}=await this.supabase.from("messages").insert([t]).select().single();if(a)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] createMessage error",a),a;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] createMessage",{conversationId:e.conversation_id,senderId:e.sender_id,messageId:s.id}),s}async getMessages(e,t=0,s=50){let{data:a,error:r}=await this.supabase.from("messages").select("*").eq("conversation_id",e).is("deleted_at",null).order("created_at",{ascending:!0}).range(t,t+s-1);return r?(this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] getMessages error",r),[]):(this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] getMessages",{conversationId:e,offset:t,limit:s,count:a?.length||0}),a)}async updateMessage(e,t){let{data:s,error:a}=await this.supabase.from("messages").update({body:t,edited_at:new Date().toISOString()}).eq("id",e).select().single();if(a)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] updateMessage error",a),a;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] updateMessage",{messageId:e,body:t}),s}async deleteMessage(e){let{error:t}=await this.supabase.from("messages").update({deleted_at:new Date().toISOString()}).eq("id",e);if(t)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] deleteMessage error",t),t;this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] deleteMessage",{messageId:e})}async blockUser(e,t){let s={blocker_id:e,blocked_id:t,created_at:new Date().toISOString()},{error:a}=await this.supabase.from("blocks").insert([s]);if(a)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] blockUser error",a),a;this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] blockUser",{blockerId:e,blockedId:t})}async unblockUser(e,t){let{error:s}=await this.supabase.from("blocks").delete().match({blocker_id:e,blocked_id:t});if(s)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] unblockUser error",s),s;this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] unblockUser",{blockerId:e,blockedId:t})}async isBlocked(e,t){let{data:s,error:a}=await this.supabase.from("blocks").select("id").match({blocker_id:e,blocked_id:t}).single();if(a&&"PGRST116"!==a.code)return this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] isBlocked error",a),!1;let r=!!s;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] isBlocked",{blockerId:e,blockedId:t,isBlocked:r}),r}async reportUser(e,t,s){let a={id:crypto.randomUUID(),reporter_id:e,reported_user_id:t,reason:s,created_at:new Date().toISOString()},{data:r,error:i}=await this.supabase.from("reports").insert([a]).select().single();if(i)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] reportUser error",i),i;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] reportUser",{reporterId:e,reportedUserId:t,reason:s}),r}async reportMessage(e,t,s){let a={id:crypto.randomUUID(),reporter_id:e,message_id:t,reason:s,created_at:new Date().toISOString()},{data:r,error:i}=await this.supabase.from("reports").insert([a]).select().single();if(i)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] reportMessage error",i),i;return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] reportMessage",{reporterId:e,messageId:t,reason:s}),r}setTypingStatus(e,t,s){this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] setTypingStatus",{conversationId:e,userId:t,isTyping:s})}async getTypingUsers(e){return this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] getTypingUsers",{conversationId:e}),[]}async markAsRead(e,t,s){let{error:a}=await this.supabase.from("conversation_members").update({last_read_at:s}).match({conversation_id:e,user_id:t});if(a)throw this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] markAsRead error",a),a;this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] markAsRead",{conversationId:e,userId:t,lastReadAt:s})}async getUnreadCount(e,t){let{data:s,error:a}=await this.supabase.from("conversation_members").select("last_read_at").match({conversation_id:e,user_id:t}).single();if(a)return this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] getUnreadCount error getting member",a),0;let r=new Date(s?.last_read_at?s.last_read_at:0),{count:i,error:n}=await this.supabase.from("messages").select("*",{count:"exact",head:!0}).eq("conversation_id",e).gt("created_at",r.toISOString()).neq("sender_id",t).is("deleted_at",null);return n?(this.DEBUG_COMMUNITY&&console.error("[COMMUNITY][SupabaseDB] getUnreadCount error getting count",n),0):(this.DEBUG_COMMUNITY&&console.log("[COMMUNITY][SupabaseDB] getUnreadCount",{conversationId:e,userId:t,unreadCount:i}),i||0)}}let i=null,n=async()=>{if(i)return i;let e="true"===t.default.env.DEBUG_COMMUNITY;try{if((await fetch("https://toorbxzuursbcykjujhh.supabase.co/auth/v1/health")).ok)return e&&console.log("[COMMUNITY] Using SupabaseDB backend"),i=new r}catch(t){e&&console.log("[COMMUNITY] Supabase not reachable, using LocalDB backend")}return e&&console.log("[COMMUNITY] Using LocalDB backend"),i=new s};e.s(["getCommunityDB",0,n],83823)},98740,e=>{"use strict";let t=(0,e.i(75254).default)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);e.s(["default",()=>t])},54943,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["default",()=>t])},54089,e=>{"use strict";let t=(0,e.i(75254).default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);e.s(["default",()=>t])},26524,e=>{"use strict";let t=(0,e.i(75254).default)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]);e.s(["default",()=>t])},86108,e=>{"use strict";let t=(0,e.i(75254).default)("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);e.s(["default",()=>t])},27330,77386,69141,e=>{"use strict";var t=e.i(75254);let s=(0,t.default)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);e.s(["default",()=>s],27330);let a=(0,t.default)("user-check",[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);e.s(["default",()=>a],77386);let r=(0,t.default)("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);e.s(["default",()=>r],69141)},15570,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(32341),r=e.i(83823),i=e.i(54089),i=i,n=e.i(26524),n=n,o=e.i(86108),o=o,l=e.i(98740),l=l,d=e.i(46753),d=d,c=e.i(27330),c=c,u=e.i(77386),u=u,m=e.i(69141),m=m,h=e.i(54943),h=h,g=e.i(48010),p=e.i(12978);e.s(["default",0,({db:e,currentUser:f})=>{let{state:M}=(0,a.useAuthStore)(),x=f||M.user,[N,y]=(0,s.useState)(e),[U,b]=(0,s.useState)("messages"),[D,_]=(0,s.useState)([]),[I,C]=(0,s.useState)(null),[v,O]=(0,s.useState)([]),[w,j]=(0,s.useState)(""),[T,S]=(0,s.useState)(!0),[B,Y]=(0,s.useState)(null),[E,k]=(0,s.useState)(!1),[G,q]=(0,s.useState)([]),R=(0,s.useRef)(null),[F,L]=(0,s.useState)([]),[P,$]=(0,s.useState)([]),[A,J]=(0,s.useState)(""),[z,Q]=(0,s.useState)([]),[K,H]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let t=async()=>{if(!e)try{let e=await (0,r.getCommunityDB)();y(e)}catch(e){console.error("[COMMUNITY] Error initializing community DB:",e),Y("Failed to initialize community system")}};x&&!e?t():e&&y(e)},[x,e]),(0,s.useEffect)(()=>{N&&x&&X()},[N,x]),(0,s.useEffect)(()=>{I&&N&&x&&Z(I.id)},[I,N,x]),(0,s.useEffect)(()=>{W()},[v]),(0,s.useEffect)(()=>{N&&x&&V()},[N,x,U]);let X=async()=>{try{S(!0);let e=await N.getConversations(x.id);_(e),S(!1)}catch(e){console.error("[COMMUNITY] Error loading conversations:",e),Y("Failed to load conversations"),S(!1)}},Z=async e=>{try{let t=await N.getMessages(e);O(t)}catch(e){console.error("[COMMUNITY] Error loading messages:",e),Y("Failed to load messages")}},V=async()=>{if(N&&x)try{let e=await N.getFriends(x.id),t=await Promise.all(e.map(async e=>{let t=await N.getProfile(e.friend_id);return{...e,profile:t}}));L(t);let s=await N.getFriendRequests(x.id);$(s)}catch(e){console.error("[COMMUNITY] Error loading friends/requests:",e)}},W=()=>{R.current?.scrollIntoView({behavior:"smooth"})},ee=async()=>{if(w.trim()&&I&&N)try{let e=await N.createMessage({conversation_id:I.id,sender_id:x.id,body:w.trim()});O(t=>[...t,e]),j(""),_(t=>t.map(t=>t.id===I.id?{...t,updated_at:e.created_at}:t))}catch(e){console.error("[COMMUNITY] Error sending message:",e),Y("Failed to send message")}},et=async e=>{if(e.trim()&&N)try{H(!0);let t=await N.searchProfiles(e);Q(t.filter(e=>e.id!==x.id))}catch(e){console.error("[COMMUNITY] Error searching users:",e)}finally{H(!1)}},es=async e=>{try{console.log("[FRIENDREQ] send to",e);let t=await fetch("/api/friends/requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({toUserId:e})}),s=await t.json();console.log("[FRIENDREQ] response",t.status,s),t.ok&&s.ok?(V(),Q([]),J(""),console.log("[FRIENDREQ] request sent successfully")):console.error("[FRIENDREQ] Failed to send request:",s.error)}catch(e){console.error("[FRIENDREQ] Error sending friend request:",e)}},ea=async(e,t)=>{try{console.log("[FRIENDREQ] update request",{requestId:e,status:t});let s=await fetch(`/api/friends/requests/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})}),a=await s.json();console.log("[FRIENDREQ] update response",s.status,a),s.ok&&a.ok?V():console.error("[FRIENDREQ] Failed to update request:",a.error)}catch(e){console.error("[FRIENDREQ] Error updating friend request:",e)}},er=v.reduce((e,t)=>{let s,a,r,i=(s=new Date(t.created_at),((r=new Date(a=new Date)).setDate(r.getDate()-1),s.toDateString()===a.toDateString())?"Today":s.toDateString()===r.toDateString()?"Yesterday":s.toLocaleDateString());return e[i]||(e[i]=[]),e[i].push(t),e},{});return(0,t.jsx)(g.default,{children:(0,t.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white flex",children:[(0,t.jsxs)("div",{className:"w-1/3 border-r border-gray-700 flex flex-col",children:[(0,t.jsx)("div",{className:"p-4 border-b border-gray-700",children:(0,t.jsxs)("div",{className:"flex space-x-1 bg-gray-800 rounded-lg p-1",children:[(0,t.jsx)("button",{onClick:()=>b("messages"),className:`flex-1 py-2 px-3 rounded-md text-sm font-medium transition-colors ${"messages"===U?"bg-accent-primary text-white border border-accent-primary":"text-gray-300 hover:text-white hover:bg-gray-700"}`,children:"Messages"}),(0,t.jsx)("button",{onClick:()=>b("friends"),className:`flex-1 py-2 px-3 rounded-md text-sm font-medium transition-colors ${"friends"===U?"bg-accent-primary text-white border border-accent-primary":"text-gray-300 hover:text-white hover:bg-gray-700"}`,children:"Friends"}),(0,t.jsxs)("button",{onClick:()=>b("requests"),className:`flex-1 py-2 px-3 rounded-md text-sm font-medium transition-colors relative ${"requests"===U?"bg-accent-primary text-white border border-accent-primary":"text-gray-300 hover:text-white hover:bg-gray-700"}`,children:["Requests",P.filter(e=>e.addressee_id===x.id&&"pending"===e.status).length>0&&(0,t.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:P.filter(e=>e.addressee_id===x.id&&"pending"===e.status).length})]})]})}),"messages"===U&&(0,t.jsxs)(t.Fragment,{children:[T&&(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:(0,t.jsx)("div",{className:"space-y-4",children:[0,1,2,3,4].map((e,s)=>(0,t.jsx)("div",{className:"p-4 border-b border-gray-700",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(p.default,{className:"w-10 h-10 rounded-full"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(p.default,{className:"h-4 w-3/4 mb-2"}),(0,t.jsx)(p.default,{className:"h-3 w-1/2"})]})]})},s))})}),!T&&(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:D.map(e=>(0,t.jsx)("div",{className:`p-4 border-b border-gray-700 cursor-pointer hover:bg-gray-800 ${I?.id===e.id?"bg-gray-800":""}`,onClick:()=>C(e),children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-accent-primary to-purple-600 flex items-center justify-center text-white font-bold",children:e.title||e.is_group?(0,t.jsx)(l.default,{className:"w-4 h-4"}):(0,t.jsx)(d.default,{className:"w-4 h-4"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h3",{className:"font-medium truncate",children:e.title||"Direct Message"}),(0,t.jsx)("p",{className:"text-sm text-gray-400 truncate",children:"No messages yet"})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsx)("p",{className:"text-xs text-gray-500",children:e.updated_at?new Date(e.updated_at).toLocaleDateString():""})})]})},e.id))})]}),"friends"===U&&(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-gray-700",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(h.default,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,t.jsx)("input",{type:"text",placeholder:"Search users...",value:A,onChange:e=>J(e.target.value),onKeyPress:e=>"Enter"===e.key&&et(A),className:"w-full bg-gray-800 text-white rounded-lg py-2 px-4 pl-10 focus:outline-none focus:ring-2 focus:ring-accent-primary"})]}),A&&(0,t.jsx)("button",{onClick:()=>et(A),disabled:K,className:"mt-2 w-full py-2 bg-accent-primary text-white rounded-lg hover:bg-accent-primary/90 disabled:opacity-50 border border-accent-primary",children:K?"Searching...":"Search"})]}),z.length>0&&(0,t.jsxs)("div",{className:"p-4 border-b border-gray-700",children:[(0,t.jsx)("h3",{className:"font-medium mb-2",children:"Search Results"}),(0,t.jsx)("div",{className:"space-y-2",children:z.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-800 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-accent-primary to-purple-600 flex items-center justify-center text-white text-sm font-bold",children:e.username.charAt(0).toUpperCase()}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.username}),(0,t.jsx)("p",{className:"text-sm text-gray-400",children:e.display_name})]})]}),(0,t.jsx)("button",{onClick:()=>es(e.id),className:"p-2 bg-accent-primary text-white rounded-full hover:bg-accent-primary/90 border border-accent-primary",children:(0,t.jsx)(c.default,{className:"w-4 h-4"})})]},e.id))})]}),(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("h3",{className:"font-medium mb-2",children:["Your Friends (",F.length,")"]}),0===F.length?(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"No friends yet. Search for users to add friends!"}):(0,t.jsx)("div",{className:"space-y-2",children:F.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-800 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-accent-primary to-purple-600 flex items-center justify-center text-white text-sm font-bold",children:e.profile?.username.charAt(0).toUpperCase()||"U"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.profile?.username||"Unknown User"}),(0,t.jsx)("p",{className:"text-sm text-gray-400",children:e.profile?.display_name||"No display name"})]})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:["Friends since ",new Date(e.created_at).toLocaleDateString()]})]},e.friend_id))})]})]}),"requests"===U&&(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)("h3",{className:"font-medium mb-2",children:"Friend Requests"}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Sent Requests"}),0===P.filter(e=>e.requester_id===x.id).length?(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"No sent requests"}):(0,t.jsx)("div",{className:"space-y-2",children:P.filter(e=>e.requester_id===x.id).map(e=>(0,t.jsx)("div",{className:"p-2 bg-gray-800 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-accent-primary to-purple-600 flex items-center justify-center text-white text-sm font-bold",children:e.addressee_id.charAt(0).toUpperCase()}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-medium",children:["User ",e.addressee_id.substring(0,8)]}),(0,t.jsxs)("p",{className:"text-sm text-gray-400 capitalize",children:["Status: ",e.status]})]})]}),"pending"===e.status&&(0,t.jsx)("button",{onClick:()=>ea(e.id,"cancelled"),className:"p-1 text-red-500 hover:bg-red-500/20 rounded",children:(0,t.jsx)(m.default,{className:"w-4 h-4"})})]})},e.id))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Received Requests"}),0===P.filter(e=>e.addressee_id===x.id&&"pending"===e.status).length?(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"No pending requests"}):(0,t.jsx)("div",{className:"space-y-2",children:P.filter(e=>e.addressee_id===x.id&&"pending"===e.status).map(e=>(0,t.jsx)("div",{className:"p-2 bg-gray-800 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-accent-primary to-purple-600 flex items-center justify-center text-white text-sm font-bold",children:e.requester_id.charAt(0).toUpperCase()}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-medium",children:["User ",e.requester_id.substring(0,8)]}),(0,t.jsxs)("p",{className:"text-sm text-gray-400",children:["Sent ",new Date(e.created_at).toLocaleDateString()]})]})]}),(0,t.jsxs)("div",{className:"flex space-x-1",children:[(0,t.jsx)("button",{onClick:()=>ea(e.id,"accepted"),className:"p-1 text-green-500 hover:bg-green-500/20 rounded",children:(0,t.jsx)(u.default,{className:"w-4 h-4"})}),(0,t.jsx)("button",{onClick:()=>ea(e.id,"declined"),className:"p-1 text-red-500 hover:bg-red-500/20 rounded",children:(0,t.jsx)(m.default,{className:"w-4 h-4"})})]})]})},e.id))})]})]})})]}),(0,t.jsx)("div",{className:"flex-1 flex flex-col",children:"messages"===U&&I?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"p-4 border-b border-gray-700 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-accent-primary to-purple-600 flex items-center justify-center text-white font-bold",children:I.title||I.is_group?(0,t.jsx)(l.default,{className:"w-4 h-4"}):(0,t.jsx)(d.default,{className:"w-4 h-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium",children:I.title||"Direct Message"}),(0,t.jsx)("p",{className:"text-sm text-gray-400",children:I.is_group?"Group chat":"Direct message"})]})]}),(0,t.jsx)("button",{className:"p-2 rounded-full hover:bg-gray-700",children:(0,t.jsx)(o.default,{className:"w-5 h-5"})})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[Object.entries(er).map(([e,s])=>(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-center my-4",children:(0,t.jsx)("span",{className:"text-xs bg-gray-800 text-gray-400 px-3 py-1 rounded-full",children:e})}),s.map(e=>(0,t.jsx)("div",{className:`flex ${e.sender_id===x.id?"justify-end":"justify-start"}`,children:(0,t.jsxs)("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${e.sender_id===x.id?"bg-accent-primary text-white":"bg-gray-800 text-white"}`,children:[(0,t.jsx)("p",{children:e.body}),(0,t.jsx)("p",{className:`text-xs mt-1 ${e.sender_id===x.id?"text-black/70":"text-gray-400"}`,children:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},e.id))]},e)),(0,t.jsx)("div",{ref:R})]}),G.length>0&&(0,t.jsx)("div",{className:"px-4 py-2 text-sm text-gray-500",children:1===G.length?(0,t.jsxs)("span",{children:[G[0]," is typing..."]}):(0,t.jsxs)("span",{children:[G.length," people are typing..."]})}),(0,t.jsx)("div",{className:"p-4 border-t border-gray-700",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("button",{className:"p-2 rounded-full hover:bg-gray-700",children:(0,t.jsx)(n.default,{className:"w-5 h-5"})}),(0,t.jsxs)("div",{className:"flex-1 relative",children:[(0,t.jsx)("textarea",{value:w,onChange:e=>{j(e.target.value),!E&&I&&k(!0)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ee())},onBlur:()=>{E&&k(!1)},placeholder:"Type a message...",className:"w-full bg-gray-800 text-white rounded-lg py-2 px-4 pr-12 resize-none focus:outline-none focus:ring-2 focus:ring-accent-primary",rows:1}),(0,t.jsx)("button",{onClick:ee,disabled:!w.trim(),className:`absolute right-3 bottom-2 p-1 rounded-full ${w.trim()?"text-accent-primary hover:bg-accent-primary/20":"text-gray-500"}`,children:(0,t.jsx)(i.default,{className:"w-5 h-5"})})]})]})})]}):"messages"===U?(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-full bg-gray-800 flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)(l.default,{className:"w-8 h-8 text-gray-600"})}),(0,t.jsx)("h3",{className:"text-xl font-medium mb-2",children:"No Conversation Selected"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Select a conversation from the list or start a new one"})]})}):(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-full bg-gray-800 flex items-center justify-center mx-auto mb-4",children:"friends"===U?(0,t.jsx)(d.default,{className:"w-8 h-8 text-gray-600"}):(0,t.jsx)(c.default,{className:"w-8 h-8 text-gray-600"})}),(0,t.jsx)("h3",{className:"text-xl font-medium mb-2",children:"friends"===U?"Friends":"Friend Requests"}),(0,t.jsx)("p",{className:"text-gray-500",children:"friends"===U?"Manage your friends and search for new ones":"Manage your friend requests"})]})})})]})})}],15570)}]);