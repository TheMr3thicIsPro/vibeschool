(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,s,r)=>{s.exports=e.r(76562)},75254,e=>{"use strict";var s=e.i(71645);let r=e=>{let s=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,s,r)=>r?r.toUpperCase():s.toLowerCase());return s.charAt(0).toUpperCase()+s.slice(1)},t=(...e)=>e.filter((e,s,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===s).join(" ").trim();var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,s.forwardRef)(({color:e="currentColor",size:r=24,strokeWidth:n=2,absoluteStrokeWidth:a,className:l="",children:i,iconNode:c,...d},u)=>(0,s.createElement)("svg",{ref:u,...o,width:r,height:r,stroke:e,strokeWidth:a?24*Number(n)/Number(r):n,className:t("lucide",l),...!i&&!(e=>{for(let s in e)if(s.startsWith("aria-")||"role"===s||"title"===s)return!0})(d)&&{"aria-hidden":"true"},...d},[...c.map(([e,r])=>(0,s.createElement)(e,r)),...Array.isArray(i)?i:[i]])),a=(e,o)=>{let a=(0,s.forwardRef)(({className:a,...l},i)=>(0,s.createElement)(n,{ref:i,iconNode:o,className:t(`lucide-${r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,a),...l}));return a.displayName=r(e),a};e.s(["default",()=>a],75254)},33525,(e,s,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return t}});let t=e=>{}},98183,(e,s,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t={assign:function(){return i},searchParamsToUrlQuery:function(){return n},urlQueryToSearchParams:function(){return l}};for(var o in t)Object.defineProperty(r,o,{enumerable:!0,get:t[o]});function n(e){let s={};for(let[r,t]of e.entries()){let e=s[r];void 0===e?s[r]=t:Array.isArray(e)?e.push(t):s[r]=[e,t]}return s}function a(e){return"string"==typeof e?e:("number"!=typeof e||isNaN(e))&&"boolean"!=typeof e?"":String(e)}function l(e){let s=new URLSearchParams;for(let[r,t]of Object.entries(e))if(Array.isArray(t))for(let e of t)s.append(r,a(e));else s.set(r,a(t));return s}function i(e,...s){for(let r of s){for(let s of r.keys())e.delete(s);for(let[s,t]of r.entries())e.append(s,t)}return e}},95057,(e,s,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t={formatUrl:function(){return l},formatWithValidation:function(){return c},urlObjectKeys:function(){return i}};for(var o in t)Object.defineProperty(r,o,{enumerable:!0,get:t[o]});let n=e.r(90809)._(e.r(98183)),a=/https?|ftp|gopher|file/;function l(e){let{auth:s,hostname:r}=e,t=e.protocol||"",o=e.pathname||"",l=e.hash||"",i=e.query||"",c=!1;s=s?encodeURIComponent(s).replace(/%3A/i,":")+"@":"",e.host?c=s+e.host:r&&(c=s+(~r.indexOf(":")?`[${r}]`:r),e.port&&(c+=":"+e.port)),i&&"object"==typeof i&&(i=String(n.urlQueryToSearchParams(i)));let d=e.search||i&&`?${i}`||"";return t&&!t.endsWith(":")&&(t+=":"),e.slashes||(!t||a.test(t))&&!1!==c?(c="//"+(c||""),o&&"/"!==o[0]&&(o="/"+o)):c||(c=""),l&&"#"!==l[0]&&(l="#"+l),d&&"?"!==d[0]&&(d="?"+d),o=o.replace(/[?#]/g,encodeURIComponent),d=d.replace("#","%23"),`${t}${c}${o}${d}${l}`}let i=["auth","hash","host","hostname","href","path","pathname","port","protocol","query","search","slashes"];function c(e){return l(e)}},18581,(e,s,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"useMergedRef",{enumerable:!0,get:function(){return o}});let t=e.r(71645);function o(e,s){let r=(0,t.useRef)(null),o=(0,t.useRef)(null);return(0,t.useCallback)(t=>{if(null===t){let e=r.current;e&&(r.current=null,e());let s=o.current;s&&(o.current=null,s())}else e&&(r.current=n(e,t)),s&&(o.current=n(s,t))},[e,s])}function n(e,s){if("function"!=typeof e)return e.current=s,()=>{e.current=null};{let r=e(s);return"function"==typeof r?r:()=>e(null)}}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),s.exports=r.default)},18967,(e,s,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t={DecodeError:function(){return b},MiddlewareNotFoundError:function(){return w},MissingStaticPage:function(){return y},NormalizeError:function(){return x},PageNotFoundError:function(){return _},SP:function(){return p},ST:function(){return h},WEB_VITALS:function(){return n},execOnce:function(){return a},getDisplayName:function(){return u},getLocationOrigin:function(){return c},getURL:function(){return d},isAbsoluteUrl:function(){return i},isResSent:function(){return g},loadGetInitialProps:function(){return m},normalizeRepeatedSlashes:function(){return f},stringifyError:function(){return v}};for(var o in t)Object.defineProperty(r,o,{enumerable:!0,get:t[o]});let n=["CLS","FCP","FID","INP","LCP","TTFB"];function a(e){let s,r=!1;return(...t)=>(r||(r=!0,s=e(...t)),s)}let l=/^[a-zA-Z][a-zA-Z\d+\-.]*?:/,i=e=>l.test(e);function c(){let{protocol:e,hostname:s,port:r}=window.location;return`${e}//${s}${r?":"+r:""}`}function d(){let{href:e}=window.location,s=c();return e.substring(s.length)}function u(e){return"string"==typeof e?e:e.displayName||e.name||"Unknown"}function g(e){return e.finished||e.headersSent}function f(e){let s=e.split("?");return s[0].replace(/\\/g,"/").replace(/\/\/+/g,"/")+(s[1]?`?${s.slice(1).join("?")}`:"")}async function m(e,s){let r=s.res||s.ctx&&s.ctx.res;if(!e.getInitialProps)return s.ctx&&s.Component?{pageProps:await m(s.Component,s.ctx)}:{};let t=await e.getInitialProps(s);if(r&&g(r))return t;if(!t)throw Object.defineProperty(Error(`"${u(e)}.getInitialProps()" should resolve to an object. But found "${t}" instead.`),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return t}let p="undefined"!=typeof performance,h=p&&["mark","measure","getEntriesByName"].every(e=>"function"==typeof performance[e]);class b extends Error{}class x extends Error{}class _ extends Error{constructor(e){super(),this.code="ENOENT",this.name="PageNotFoundError",this.message=`Cannot find module for page: ${e}`}}class y extends Error{constructor(e,s){super(),this.message=`Failed to load static file for page: ${e} ${s}`}}class w extends Error{constructor(){super(),this.code="ENOENT",this.message="Cannot find the middleware module"}}function v(e){return JSON.stringify({message:e.message,stack:e.stack})}},73668,(e,s,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"isLocalURL",{enumerable:!0,get:function(){return n}});let t=e.r(18967),o=e.r(52817);function n(e){if(!(0,t.isAbsoluteUrl)(e))return!0;try{let s=(0,t.getLocationOrigin)(),r=new URL(e,s);return r.origin===s&&(0,o.hasBasePath)(r.pathname)}catch(e){return!1}}},84508,(e,s,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"errorOnce",{enumerable:!0,get:function(){return t}});let t=e=>{}},22016,(e,s,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t={default:function(){return b},useLinkStatus:function(){return _}};for(var o in t)Object.defineProperty(r,o,{enumerable:!0,get:t[o]});let n=e.r(90809),a=e.r(43476),l=n._(e.r(71645)),i=e.r(95057),c=e.r(8372),d=e.r(18581),u=e.r(18967),g=e.r(5550);e.r(33525);let f=e.r(91949),m=e.r(73668),p=e.r(9396);function h(e){return"string"==typeof e?e:(0,i.formatUrl)(e)}function b(s){var r;let t,o,n,[i,b]=(0,l.useOptimistic)(f.IDLE_LINK_STATUS),_=(0,l.useRef)(null),{href:y,as:w,children:v,prefetch:j=null,passHref:N,replace:C,shallow:P,scroll:E,onClick:L,onMouseEnter:S,onTouchStart:k,legacyBehavior:D=!1,onNavigate:A,ref:R,unstable_dynamicOnHover:O,...U}=s;t=v,D&&("string"==typeof t||"number"==typeof t)&&(t=(0,a.jsx)("a",{children:t}));let T=l.default.useContext(c.AppRouterContext),F=!1!==j,I=!1!==j?null===(r=j)||"auto"===r?p.FetchStrategy.PPR:p.FetchStrategy.Full:p.FetchStrategy.PPR,{href:M,as:$}=l.default.useMemo(()=>{let e=h(y);return{href:e,as:w?h(w):e}},[y,w]);if(D){if(t?.$$typeof===Symbol.for("react.lazy"))throw Object.defineProperty(Error("`<Link legacyBehavior>` received a direct child that is either a Server Component, or JSX that was loaded with React.lazy(). This is not supported. Either remove legacyBehavior, or make the direct child a Client Component that renders the Link's `<a>` tag."),"__NEXT_ERROR_CODE",{value:"E863",enumerable:!1,configurable:!0});o=l.default.Children.only(t)}let B=D?o&&"object"==typeof o&&o.ref:R,q=l.default.useCallback(e=>(null!==T&&(_.current=(0,f.mountLinkInstance)(e,M,T,I,F,b)),()=>{_.current&&((0,f.unmountLinkForCurrentNavigation)(_.current),_.current=null),(0,f.unmountPrefetchableInstance)(e)}),[F,M,T,I,b]),z={ref:(0,d.useMergedRef)(q,B),onClick(s){D||"function"!=typeof L||L(s),D&&o.props&&"function"==typeof o.props.onClick&&o.props.onClick(s),!T||s.defaultPrevented||function(s,r,t,o,n,a,i){if("undefined"!=typeof window){let c,{nodeName:d}=s.currentTarget;if("A"===d.toUpperCase()&&((c=s.currentTarget.getAttribute("target"))&&"_self"!==c||s.metaKey||s.ctrlKey||s.shiftKey||s.altKey||s.nativeEvent&&2===s.nativeEvent.which)||s.currentTarget.hasAttribute("download"))return;if(!(0,m.isLocalURL)(r)){n&&(s.preventDefault(),location.replace(r));return}if(s.preventDefault(),i){let e=!1;if(i({preventDefault:()=>{e=!0}}),e)return}let{dispatchNavigateAction:u}=e.r(99781);l.default.startTransition(()=>{u(t||r,n?"replace":"push",a??!0,o.current)})}}(s,M,$,_,C,E,A)},onMouseEnter(e){D||"function"!=typeof S||S(e),D&&o.props&&"function"==typeof o.props.onMouseEnter&&o.props.onMouseEnter(e),T&&F&&(0,f.onNavigationIntent)(e.currentTarget,!0===O)},onTouchStart:function(e){D||"function"!=typeof k||k(e),D&&o.props&&"function"==typeof o.props.onTouchStart&&o.props.onTouchStart(e),T&&F&&(0,f.onNavigationIntent)(e.currentTarget,!0===O)}};return(0,u.isAbsoluteUrl)($)?z.href=$:D&&!N&&("a"!==o.type||"href"in o.props)||(z.href=(0,g.addBasePath)($)),n=D?l.default.cloneElement(o,z):(0,a.jsx)("a",{...U,...z,children:t}),(0,a.jsx)(x.Provider,{value:i,children:n})}e.r(84508);let x=(0,l.createContext)(f.IDLE_LINK_STATUS),_=()=>(0,l.useContext)(x);("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),s.exports=r.default)},48010,43194,12978,e=>{"use strict";var s=e.i(43476),r=e.i(32341),t=e.i(18566),o=e.i(71645);let n=({duration:e=3e3,className:s="",showPercentage:r=!0})=>{let[t,n]=(0,o.useState)(0);return(0,o.useEffect)(()=>{let s=setInterval(()=>{n(e=>e>=100?(clearInterval(s),100):e+1)},e/100);return()=>clearInterval(s)},[e]),o.default.createElement("div",{className:"w-full "+s},r&&o.default.createElement("div",{className:"flex justify-between items-center mb-2"},o.default.createElement("span",{className:"text-sm font-medium text-gray-300"},"Loading..."),o.default.createElement("span",{className:"text-sm font-medium text-accent-primary"},t+"%")),o.default.createElement("div",{className:"w-full bg-gray-800 rounded-full h-2.5"},o.default.createElement("div",{className:"bg-gradient-to-r from-accent-primary to-purple-600 h-2.5 rounded-full transition-all duration-100 ease-out",style:{width:t+"%"}})),t>=100&&o.default.createElement("div",{className:"mt-2 text-center text-sm text-green-400 animate-pulse"},"Complete!"))};e.s(["default",0,n],43194);let a=({className:e="",count:r=1,showLoadingBar:t=!1,loadingDuration:o=3e3})=>{let a=Array.from({length:r},(r,t)=>(0,s.jsx)("div",{className:`animate-pulse bg-gray-700 rounded ${e}`},t));return(0,s.jsxs)(s.Fragment,{children:[t&&(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(n,{duration:o})}),a]})};e.s(["default",0,a],12978);let l=({className:e="",loadingText:r="Loading...",showLoadingBar:t=!0,showSkeletons:o=!0,skeletonCount:l=5,duration:i=5e3})=>(0,s.jsxs)("div",{className:`relative ${e}`,children:[t&&(0,s.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50 pt-2 px-4",children:(0,s.jsx)(n,{duration:i,showPercentage:!1})}),o&&(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"mb-8 text-center",children:[(0,s.jsx)(a,{className:"h-8 w-64 mb-4 mx-auto"}),(0,s.jsx)(a,{className:"h-4 w-48 mx-auto"})]}),(0,s.jsx)("div",{className:"space-y-6",children:Array.from({length:l}).map((e,r)=>(0,s.jsxs)("div",{className:"card p-6 border border-card-border",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)(a,{className:"h-6 w-32"}),(0,s.jsx)(a,{className:"h-4 w-16"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(a,{className:"h-4 w-full"}),(0,s.jsx)(a,{className:"h-4 w-5/6"}),(0,s.jsx)(a,{className:"h-4 w-4/6"}),(0,s.jsxs)("div",{className:"flex gap-3 mt-4",children:[(0,s.jsx)(a,{className:"h-10 w-24 rounded-lg"}),(0,s.jsx)(a,{className:"h-10 w-24 rounded-lg"})]})]})]},r))})]})]});e.s(["default",0,({children:e})=>{let[n,a]=(0,o.useState)(!1);(0,o.useEffect)(()=>{a(!0)},[]);let{state:i}=(0,r.useAuthStore)(),{user:c,authLoading:d}=i,u=(0,t.useRouter)();return((0,o.useEffect)(()=>{!n||d||c||u.push("/auth/login")},[n,c,d,u]),n)?d?(0,s.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,s.jsx)(l,{loadingText:"Checking authentication status..."})}):c?(0,s.jsx)(s.Fragment,{children:e}):null:(0,s.jsx)(s.Fragment,{children:e})}],48010)},46753,e=>{"use strict";let s=(0,e.i(75254).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["default",()=>s])},63160,e=>{"use strict";var s=e.i(7471);let r=async()=>{console.log("listCourses: Fetching published courses");let{data:e,error:r}=await s.supabase.from("courses").select("id, title, description, thumbnail_url, is_published, created_at").eq("is_published",!0).order("created_at",{ascending:!1});if(r)throw console.error("listCourses: Error fetching courses:",r),console.error("Supabase error",{message:r?.message,details:r?.details,hint:r?.hint,code:r?.code}),r;if(!e||0===e.length)return console.log("listCourses: No courses found"),[];let t=e.map(e=>e.id),{data:o,error:n}=await s.supabase.from("modules").select("id, course_id, title, order_index").in("course_id",t).order("order_index",{ascending:!0});if(n)throw console.error("listCourses: Error fetching modules:",n),console.error("Supabase error",{message:n?.message,details:n?.details,hint:n?.hint,code:n?.code}),n;let a={};if(o)for(let e of o)a[e.course_id]||(a[e.course_id]=[]),a[e.course_id].push(e);let l=o?.map(e=>e.id)||[],i=[];if(l.length>0){let{data:e,error:r}=await s.supabase.from("lessons").select("id, module_id, title, description, order_index, video_provider, video_url, youtube_video_id, is_preview, is_published, created_at").in("module_id",l).order("order_index",{ascending:!0});if(r)throw console.error("listCourses: Error fetching lessons:",r),console.error("Supabase error",{message:r?.message,details:r?.details,hint:r?.hint,code:r?.code}),console.warn("Warning: Failed to fetch lessons, continuing with empty lessons array"),i=[],r;i=e||[]}let c={};for(let e of i)c[e.module_id]||(c[e.module_id]=[]),c[e.module_id].push(e);let d=e.map(e=>({...e,modules:a[e.id]?a[e.id].map(e=>({...e,lessons:c[e.id]||[]})):[]}));return console.log("listCourses: Final result",{count:d.length}),d},t=async(e,r)=>{console.log("getCourse: Fetching course:",e,"for user:",r);let{data:t,error:n}=await s.supabase.from("courses").select("id, title, description, thumbnail_url, is_published, created_at").eq("id",e).eq("is_published",!0).single();if(n)throw console.error("getCourse: Error fetching course:",n),console.error("Supabase error",{message:n?.message,details:n?.details,hint:n?.hint,code:n?.code}),n;if(!t)throw Error("Course not found");let{data:a,error:l}=await s.supabase.from("modules").select("id, course_id, title, order_index").eq("course_id",e).order("order_index",{ascending:!0});if(l)throw console.error("getCourse: Error fetching modules:",l),console.error("Supabase error",{message:l?.message,details:l?.details,hint:l?.hint,code:l?.code}),l;let i=a?.map(e=>e.id)||[],c=[];if(i.length>0){let{data:e,error:r}=await s.supabase.from("lessons").select("id, module_id, title, description, order_index, video_provider, video_url, youtube_video_id, is_preview, is_published, created_at").in("module_id",i).order("order_index",{ascending:!0});if(r)throw console.error("getCourse: Error fetching lessons:",r),console.error("Supabase error",{message:r?.message,details:r?.details,hint:r?.hint,code:r?.code}),console.warn("Warning: Failed to fetch lessons, continuing with empty lessons array"),c=[],r;c=e||[]}let d={};for(let e of c)d[e.module_id]||(d[e.module_id]=[]),d[e.module_id].push(e);let u={...t,modules:a?.map(e=>({...e,lessons:d[e.id]||[]}))||[]};if(console.log("getCourse: Result",{course:u.id,modules:u.modules.length}),r){let s=await o(r,e);return{...u,progress:s}}return u},o=async(e,r)=>{console.log("getCourseProgress: Fetching progress for user:",e,"course:",r);let{data:t,error:o}=await s.supabase.from("modules").select("id").eq("course_id",r);if(o)throw console.error("getCourseProgress: Error fetching modules:",o),console.error("Supabase error",{message:o?.message,details:o?.details,hint:o?.hint,code:o?.code}),o;let n=[];if(t&&t.length>0){let e=t.map(e=>e.id),{data:r,error:o}=await s.supabase.from("lessons").select("id").in("module_id",e);if(o)return console.error("getCourseProgress: Error fetching lessons:",o),console.error("Supabase error",{message:o?.message,details:o?.details,hint:o?.hint,code:o?.code}),console.warn("Warning: Failed to fetch lessons for progress calculation"),{total_lessons:0,completed_lessons:0,progress_percent:0,last_accessed_lesson_id:null};n=r?.map(e=>e.id)||[]}let a=n.length;if(0===a)return{total_lessons:0,completed_lessons:0,progress_percent:0,last_accessed_lesson_id:null};let{data:l,error:i}=await s.supabase.from("user_lesson_progress").select("lesson_id, completed, updated_at").eq("user_id",e).in("lesson_id",n);if(i)throw console.error("getCourseProgress: Error fetching progress data:",i),console.error("Supabase error",{message:i?.message,details:i?.details,hint:i?.hint,code:i?.code}),i;let c=l?.filter(e=>e.completed).length||0,d=a>0?Math.round(c/a*100):0,u=l?.sort((e,s)=>new Date(s.updated_at).getTime()-new Date(e.updated_at).getTime());return{total_lessons:a,completed_lessons:c,progress_percent:d,last_accessed_lesson_id:u?.[0]?.lesson_id||null}},n=async(e,r)=>{console.log("getNextLesson: Finding next lesson for user:",e,"course:",r);let o=await t(r,e);if(!o.modules||0===o.modules.length)return console.log("getNextLesson: No modules found"),null;let{data:n,error:a}=await s.supabase.from("user_lesson_progress").select("lesson_id, completed").eq("user_id",e).eq("completed",!0);if(a)throw console.error("getNextLesson: Error fetching progress:",a),console.error("Supabase error",{message:a?.message,details:a?.details,hint:a?.hint,code:a?.code}),a;let l=new Set(n?.map(e=>e.lesson_id)||[]);for(let e of o.modules)if(e.lessons){for(let s of e.lessons)if(!l.has(s.id))return console.log("getNextLesson: Found next lesson:",s.id),s}console.log("getNextLesson: All lessons completed, returning first lesson");let i=o.modules[0];return i&&i.lessons&&i.lessons.length>0?i.lessons[0]:null},a=async(e,r)=>{console.log("getResumeLesson: Finding resume lesson for user:",e,"course:",r);let{data:t,error:o}=await s.supabase.from("user_lesson_progress").select(`
      lesson_id,
      completed,
      last_position_seconds
    `).eq("user_id",e).order("updated_at",{ascending:!1}).limit(5);if(o)throw console.error("getResumeLesson: Error fetching recent progress:",o),console.error("Supabase error",{message:o?.message,details:o?.details,hint:o?.hint,code:o?.code}),o;if(t){for(let e of t)if(!e.completed&&e.last_position_seconds>0){let{data:r,error:t}=await s.supabase.from("lessons").select("*").eq("id",e.lesson_id).single();if(!t&&r)return console.log("getResumeLesson: Found resume lesson with progress:",r.id),r}}return n(e,r)},l=async(e,r,t)=>{console.log("updateUserLessonProgress: Updating progress for user:",e,"lesson:",r,"data:",t);let{data:o,error:n}=await s.supabase.from("user_lesson_progress").upsert({user_id:e,lesson_id:r,...t,updated_at:new Date().toISOString()},{onConflict:"user_id,lesson_id"}).select().single();if(console.log("updateUserLessonProgress: Result",{data:o,error:n}),n)throw console.error("updateUserLessonProgress: Error updating progress:",n),console.error("Supabase error",{message:n?.message,details:n?.details,hint:n?.hint,code:n?.code}),n;return o},i=async(e,s=3)=>{console.log("getContinueLearningItems: Fetching items for user:",e,"limit:",s);let t=await r(),a=[];for(let s of t){let r=await o(e,s.id);if(r.total_lessons>0&&r.progress_percent<100){let t=await n(e,s.id);t&&a.push({course:s,next_lesson:t,progress_percent:r.progress_percent})}}return a.sort((e,s)=>e.progress_percent-s.progress_percent).slice(0,s)},c=async(e,r)=>{console.log("getUserLessonProgress: Fetching progress for user:",e,"lesson:",r);let{data:t,error:o}=await s.supabase.from("user_lesson_progress").select("*").eq("user_id",e).eq("lesson_id",r).maybeSingle();if(console.log("getUserLessonProgress: Result",{data:t,error:o}),o&&"PGRST116"!==o.code)throw console.error("getUserLessonProgress: Error fetching progress:",o),console.error("Supabase error",{message:o?.message,details:o?.details,hint:o?.hint,code:o?.code}),o;return t||(console.log("getUserLessonProgress: No progress found, returning default"),{user_id:e,lesson_id:r,completed:!1,completed_at:null,last_position_seconds:0,updated_at:new Date().toISOString()})},d=async(e,r)=>{console.log("checkLessonAccess: Checking access for user:",e,"lesson:",r);let{data:t,error:o}=await s.supabase.from("lessons").select("is_preview").eq("id",r).single();if(o)return console.error("checkLessonAccess: Error fetching lesson:",o),console.error("Supabase error",{message:o?.message,details:o?.details,hint:o?.hint,code:o?.code}),{hasAccess:!1,isPreview:!1};if(t.is_preview)return console.log("checkLessonAccess: Lesson is preview, access granted"),{hasAccess:!0,isPreview:!0};let{data:n,error:a}=await s.supabase.from("profiles").select("plan").eq("id",e).maybeSingle();if(a)return console.error("checkLessonAccess: Error fetching profile:",a),console.error("Supabase error",{message:a?.message,details:a?.details,hint:a?.hint,code:a?.code}),{hasAccess:!1,isPreview:!1};if(!n)return console.log("checkLessonAccess: No profile found for user, denying access"),{hasAccess:!1,isPreview:!1};let l="member"===n.plan;return console.log("checkLessonAccess: Member access check result:",{hasAccess:l,plan:n.plan}),{hasAccess:l,isPreview:!1}};e.s(["checkLessonAccess",0,d,"getContinueLearningItems",0,i,"getCourse",0,t,"getCourseProgress",0,o,"getNextLesson",0,n,"getResumeLesson",0,a,"getUserLessonProgress",0,c,"listCourses",0,r,"updateUserLessonProgress",0,l])},87316,e=>{"use strict";let s=(0,e.i(75254).default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>s],87316)},63365,e=>{"use strict";var s=e.i(7471);let r=async e=>{console.log("getLessonById: Fetching lesson:",e);let{data:r,error:t}=await s.supabase.from("lessons").select(`
      id,
      title,
      description,
      video_provider,
      video_url,
      youtube_video_id,
      is_preview,
      is_published,
      module_id,
      modules (
        id,
        title,
        course_id,
        courses (
          id,
          title
        )
      )
    `).eq("id",e).eq("is_published",!0).single();if(console.log("getLessonById: Result",{data:r,error:t}),t)throw console.error("getLessonById: Error fetching lesson:",t),t;return r},t=async(e=10)=>{console.log("getLatestAnnouncements: Fetching latest announcements, limit:",e);let{data:r,error:t}=await s.supabase.from("announcements").select("id, title, body, created_at").order("created_at",{ascending:!1}).limit(e);if(console.log("getLatestAnnouncements: Result",{data:r,error:t}),t)throw console.error("getLatestAnnouncements: Error fetching announcements:",t),t;return r||[]},o=async e=>{console.log("getUserProfile: Fetching profile for user:",e);let{data:r,error:t}=await s.supabase.from("profiles").select("id, username, full_name, role, plan, created_at, trial_started_at, trial_expires_at, account_locked").eq("id",e).maybeSingle();if(console.log("getUserProfile: Result",{data:r,error:t}),t)throw console.error("getUserProfile: Error fetching profile:",t),t;return r||(console.log("getUserProfile: No profile found for user:",e),null)},n=async()=>{console.log("getAllCourses: Fetching all courses");let{data:e,error:r}=await s.supabase.from("courses").select(`
      id,
      title,
      description,
      thumbnail_url,
      is_published,
      created_at,
      updated_at
    `).order("created_at",{ascending:!1});if(console.log("getAllCourses: Result",{data:e,error:r}),r)throw console.error("getAllCourses: Error fetching courses:",r),r;return e||[]},a=async(e,s)=>{if(console.log("checkLessonAccess: Checking access for user:",e,"lesson:",s),(await r(s)).is_preview)return console.log("checkLessonAccess: Lesson is preview, access granted"),{hasAccess:!0,isPreview:!0};let t=await o(e);if(!t)return console.log("checkLessonAccess: No profile found for user, denying access"),{hasAccess:!1,isPreview:!1};let n=!1;if("member"===t.plan)n=!0;else if("free"===t.plan&&t.trial_expires_at){let e=new Date(t.trial_expires_at);n=new Date<e}return console.log("checkLessonAccess: Trial/membership access check result:",{hasAccess:n,plan:t.plan,trialExpiresAt:t.trial_expires_at}),{hasAccess:n,isPreview:!1}};e.s(["checkLessonAccess",0,a,"getAllCourses",0,n,"getLatestAnnouncements",0,t,"getLessonById",0,r])},25652,e=>{"use strict";let s=(0,e.i(75254).default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);e.s(["TrendingUp",()=>s],25652)},30257,e=>{"use strict";var s=e.i(43476),r=e.i(71645),t=e.i(18566),o=e.i(32341),n=e.i(66745),a=e.i(7471),l=e.i(10980),i=e.i(87316),c=e.i(25652);let d=(0,e.i(75254).default)("award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);var u=e.i(48010),g=e.i(10400),f=e.i(63365),m=e.i(63160),p=e.i(43194),h=e.i(12978);let b=({className:e=""})=>(0,s.jsxs)("div",{className:`relative ${e}`,children:[(0,s.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50 pt-2 px-4",children:(0,s.jsx)(p.default,{duration:5e3,showPercentage:!1})}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)(h.default,{className:"h-8 w-64 mb-2"}),(0,s.jsx)(h.default,{className:"h-4 w-48"})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[0,1,2,3].map((e,r)=>(0,s.jsx)("div",{className:"card p-6 border border-card-border",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(h.default,{className:"h-4 w-20 mb-2"}),(0,s.jsx)(h.default,{className:"h-6 w-16"})]}),(0,s.jsx)(h.default,{className:"h-12 w-12 rounded-full"})]})},r))}),(0,s.jsxs)("div",{className:"card p-6 border border-card-border mb-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)(h.default,{className:"h-6 w-48"}),(0,s.jsx)(h.default,{className:"h-4 w-24"})]}),(0,s.jsx)("div",{className:"space-y-4",children:[0,1,2].map((e,r)=>(0,s.jsxs)("div",{className:"flex items-center p-4 bg-card-bg rounded-lg border border-card-border",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(h.default,{className:"h-5 w-64 mb-2"}),(0,s.jsx)(h.default,{className:"h-4 w-40"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(h.default,{className:"h-2 w-32 rounded-full"}),(0,s.jsx)(h.default,{className:"h-4 w-16"}),(0,s.jsx)(h.default,{className:"h-10 w-20 rounded-lg"})]})]},r))})]}),(0,s.jsxs)("div",{className:"card p-6 border border-card-border",children:[(0,s.jsx)(h.default,{className:"h-6 w-32 mb-4"}),(0,s.jsx)("div",{className:"space-y-4",children:[0,1,2].map((e,r)=>(0,s.jsxs)("div",{className:"p-4 bg-card-bg rounded-lg border border-card-border",children:[(0,s.jsx)(h.default,{className:"h-5 w-48 mb-2"}),(0,s.jsx)(h.default,{className:"h-4 w-full mb-2"}),(0,s.jsx)(h.default,{className:"h-3 w-32"})]},r))})]})]});e.s(["default",0,()=>{console.debug("[Dashboard] component mounted");let{state:e}=(0,o.useAuthStore)(),p=e.user;console.debug("[Dashboard] user from auth state:",p?{id:p.id,email:p.email}:"no user");let h=(0,t.useRouter)(),[x,_]=(0,r.useState)(null),[y,w]=(0,r.useState)(!0);console.debug("[Dashboard] initial loading state:",!0);let[v,j]=(0,r.useState)({progressPercent:0,lessonsCompleted:0,currentModule:"Start a course",joined:"N/A"}),[N,C]=(0,r.useState)([]),[P,E]=(0,r.useState)([]),L=(0,r.useRef)(!1);console.debug("[Dashboard] didRun ref initialized:",L.current),(0,r.useEffect)(()=>{(console.debug("[Dashboard] BUILD-DEBUG: Starting data loading - window available"),console.debug("[Dashboard] useEffect triggered"),console.debug("[Dashboard] user in effect:",p?{id:p.id}:"no user"),console.debug("[Dashboard] didRun.current before check:",L.current),p)?L.current?console.debug("[Dashboard] didRun already executed, returning early"):(console.debug("[Dashboard] setting didRun to true"),L.current=!0,console.debug("[Dashboard] loading start"),(async()=>{try{console.debug("[Dashboard] getting session");let{data:e,error:s}=await a.supabase.auth.getSession();console.debug("[Dashboard] session data received:",{hasSession:!!e?.session,hasError:!!s});let r=e?.session;if(!r?.access_token){console.warn("[Dashboard] No session access token, skipping profile ensure for now"),w(!1),console.debug("[Dashboard] loading set to false due to no session");return}console.debug("[Dashboard] ensuring profile");let t=await (0,n.ensureProfile)(a.supabase,p);console.debug("[Dashboard] profile ensured:",t),_(t),console.debug("[Dashboard] loading dashboard data"),await S(t,p.id)}catch(e){console.error("[Dashboard] Failed to ensure profile",e)}finally{w(!1),console.debug("[Dashboard] loading set to false in finally"),console.debug("[Dashboard] loading complete")}})()):console.debug("[Dashboard] no user, returning early")},[p,a.supabase]);let S=async(e,s)=>{console.debug("[Dashboard] loadDashboardData called with:",{profile:!!e,userId:s});try{console.debug("DEBUG: Account role and plan:",{userId:s,role:e?.role,plan:e?.plan,username:e?.username}),console.debug("[Dashboard] loading announcements");let r=await (0,f.getLatestAnnouncements)(10);console.debug("[Dashboard] announcements loaded:",r.length),E(r),console.debug("[Dashboard] setting joined date"),j(s=>({...s,joined:e?.created_at?new Date(e.created_at).toLocaleDateString():"N/A"})),console.debug("[Dashboard] loading continue learning items");let t=await (0,m.getContinueLearningItems)(s,3);console.debug("DEBUG: Dashboard - Continue learning items:",t),console.debug("[Dashboard] counting published courses");let{data:o,error:n}=await a.supabase.from("courses").select("id").eq("is_published",!0);console.debug("DEBUG: Total published courses available:",o?.length||0);let l=0,i=0;console.debug("[Dashboard] calculating progress across all courses");let{data:c,error:d}=await a.supabase.from("courses").select("id").eq("is_published",!0);if(c)for(let e of c){console.debug("[Dashboard] getting progress for course:",e.id);let r=await (0,m.getCourseProgress)(s,e.id);l+=r.total_lessons,i+=r.completed_lessons}let u=l>0?Math.round(i/l*100):0;console.debug("[Dashboard] calculated progress:",{totalLessons:l,completedLessons:i,progressPercent:u}),j(e=>({...e,progressPercent:u,lessonsCompleted:i})),console.debug("[Dashboard] transforming continue items for display");let g=t.map(e=>({course_title:e.course.title,lesson_title:e.next_lesson.title,progress_percent:e.progress_percent,course_id:e.course.id,lesson_id:e.next_lesson.id,is_preview:e.next_lesson.is_preview}));C(g),g.length>0&&j(e=>({...e,currentModule:g[0].course_title}));let p={profile:!!e,userId:s,announcementsCount:r.length,continueItemsCount:t.length,totalLessons:l,completedLessons:i,progressPercent:u};console.debug("[Dashboard] data",p)}catch(e){console.error("Error loading dashboard data:",e)}};x&&("admin"===x.role||x.role);let k=[{name:"Progress",value:`${v.progressPercent}%`,icon:c.TrendingUp},{name:"Lessons Completed",value:`${v.lessonsCompleted} completed`,icon:d},{name:"Current Module",value:v.currentModule,icon:l.BookOpen},{name:"Joined",value:v.joined,icon:i.Calendar}];return(console.debug("[Dashboard] render - loading state:",y),y)?(console.debug("[Dashboard] rendering skeleton loading with progress bar overlay"),(0,s.jsx)(u.default,{children:(0,s.jsx)(g.default,{children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsx)(b,{})})})})):(console.debug("[Dashboard] loading complete, rendering dashboard content"),(0,s.jsx)(u.default,{children:(0,s.jsx)(g.default,{children:(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold text-white",children:["Welcome back, ",x?.username||p?.email?.split("@")[0],"!"]}),(0,s.jsx)("p",{className:"text-gray-400",children:"Continue your journey in AI coding"})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:k.map((e,r)=>{let t=e.icon;return(0,s.jsx)("div",{className:"card p-6 border border-card-border",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-gray-400 text-sm",children:e.name}),(0,s.jsx)("p",{className:"text-2xl font-bold text-white mt-1",children:e.value})]}),(0,s.jsx)("div",{className:"p-3 rounded-full bg-accent-primary/10",children:(0,s.jsx)(t,{className:"text-accent-primary",size:24})})]})},r)})}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"card p-6 border border-card-border mb-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-white",children:"Continue Learning"}),(0,s.jsx)("button",{onClick:()=>h.push("/courses"),className:"text-accent-primary hover:underline hover-lift",children:"Browse Courses"})]}),(0,s.jsx)("div",{className:"space-y-4",children:N.length>0?N.map((e,r)=>(0,s.jsxs)("div",{className:"flex items-center p-4 bg-card-bg rounded-lg border border-card-border hover:border-accent-primary transition-colors cursor-pointer",onClick:()=>h.push(`/learn/${e.lesson_id}`),children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"font-medium text-white",children:e.lesson_title}),(0,s.jsx)("p",{className:"text-gray-400 text-sm",children:e.course_title})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-32 bg-gray-700 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-accent-primary h-2 rounded-full",style:{width:`${e.progress_percent}%`}})}),(0,s.jsxs)("span",{className:"text-sm text-gray-400",children:[e.progress_percent,"%"]}),(0,s.jsx)("button",{className:"ml-4 px-4 py-2 bg-accent-primary text-white rounded-lg hover:bg-accent-primary/90 transition-colors hover-lift border border-accent-primary",onClick:s=>{s.stopPropagation(),h.push(`/learn/${e.lesson_id}`)},children:"Continue"})]})]},r)):(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(l.BookOpen,{size:48,className:"text-gray-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-400 text-lg mb-2",children:"No ongoing lessons"}),(0,s.jsx)("p",{className:"text-gray-500 mb-4",children:"Start a course to begin your learning journey!"}),(0,s.jsx)("button",{onClick:()=>h.push("/courses"),className:"px-6 py-3 bg-accent-primary text-white rounded-lg hover:bg-accent-primary/90 font-medium hover-lift border border-accent-primary",children:"Browse Courses"})]})})]}),(0,s.jsxs)("div",{className:"card p-6 border border-card-border",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-white mb-4",children:"Announcements"}),(0,s.jsx)("div",{className:"space-y-4",children:P.length>0?P.map((e,r)=>(0,s.jsxs)("div",{className:"p-4 bg-card-bg rounded-lg border border-card-border",children:[(0,s.jsx)("h3",{className:"font-medium text-white",children:e.title}),(0,s.jsx)("p",{className:"text-gray-400 text-sm mt-2",children:e.body}),(0,s.jsxs)("p",{className:"text-gray-500 text-xs mt-2",children:["Posted ",new Date(e.created_at).toLocaleDateString()]})]},r)):(0,s.jsx)("p",{className:"text-gray-400 text-center py-4",children:"No announcements yet."})})]})]})]})})}))}],30257)}]);