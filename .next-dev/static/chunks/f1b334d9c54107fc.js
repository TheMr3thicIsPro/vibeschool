(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,r,s)=>{r.exports=e.r(76562)},75254,e=>{"use strict";var r=e.i(71645);let s=e=>{let r=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,s)=>s?s.toUpperCase():r.toLowerCase());return r.charAt(0).toUpperCase()+r.slice(1)},t=(...e)=>e.filter((e,r,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===r).join(" ").trim();var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,r.forwardRef)(({color:e="currentColor",size:s=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:l="",children:a,iconNode:c,...d},u)=>(0,r.createElement)("svg",{ref:u,...o,width:s,height:s,stroke:e,strokeWidth:i?24*Number(n)/Number(s):n,className:t("lucide",l),...!a&&!(e=>{for(let r in e)if(r.startsWith("aria-")||"role"===r||"title"===r)return!0})(d)&&{"aria-hidden":"true"},...d},[...c.map(([e,s])=>(0,r.createElement)(e,s)),...Array.isArray(a)?a:[a]])),i=(e,o)=>{let i=(0,r.forwardRef)(({className:i,...l},a)=>(0,r.createElement)(n,{ref:a,iconNode:o,className:t(`lucide-${s(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,i),...l}));return i.displayName=s(e),i};e.s(["default",()=>i],75254)},33525,(e,r,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"warnOnce",{enumerable:!0,get:function(){return t}});let t=e=>{}},98183,(e,r,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0});var t={assign:function(){return a},searchParamsToUrlQuery:function(){return n},urlQueryToSearchParams:function(){return l}};for(var o in t)Object.defineProperty(s,o,{enumerable:!0,get:t[o]});function n(e){let r={};for(let[s,t]of e.entries()){let e=r[s];void 0===e?r[s]=t:Array.isArray(e)?e.push(t):r[s]=[e,t]}return r}function i(e){return"string"==typeof e?e:("number"!=typeof e||isNaN(e))&&"boolean"!=typeof e?"":String(e)}function l(e){let r=new URLSearchParams;for(let[s,t]of Object.entries(e))if(Array.isArray(t))for(let e of t)r.append(s,i(e));else r.set(s,i(t));return r}function a(e,...r){for(let s of r){for(let r of s.keys())e.delete(r);for(let[r,t]of s.entries())e.append(r,t)}return e}},95057,(e,r,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0});var t={formatUrl:function(){return l},formatWithValidation:function(){return c},urlObjectKeys:function(){return a}};for(var o in t)Object.defineProperty(s,o,{enumerable:!0,get:t[o]});let n=e.r(90809)._(e.r(98183)),i=/https?|ftp|gopher|file/;function l(e){let{auth:r,hostname:s}=e,t=e.protocol||"",o=e.pathname||"",l=e.hash||"",a=e.query||"",c=!1;r=r?encodeURIComponent(r).replace(/%3A/i,":")+"@":"",e.host?c=r+e.host:s&&(c=r+(~s.indexOf(":")?`[${s}]`:s),e.port&&(c+=":"+e.port)),a&&"object"==typeof a&&(a=String(n.urlQueryToSearchParams(a)));let d=e.search||a&&`?${a}`||"";return t&&!t.endsWith(":")&&(t+=":"),e.slashes||(!t||i.test(t))&&!1!==c?(c="//"+(c||""),o&&"/"!==o[0]&&(o="/"+o)):c||(c=""),l&&"#"!==l[0]&&(l="#"+l),d&&"?"!==d[0]&&(d="?"+d),o=o.replace(/[?#]/g,encodeURIComponent),d=d.replace("#","%23"),`${t}${c}${o}${d}${l}`}let a=["auth","hash","host","hostname","href","path","pathname","port","protocol","query","search","slashes"];function c(e){return l(e)}},18581,(e,r,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"useMergedRef",{enumerable:!0,get:function(){return o}});let t=e.r(71645);function o(e,r){let s=(0,t.useRef)(null),o=(0,t.useRef)(null);return(0,t.useCallback)(t=>{if(null===t){let e=s.current;e&&(s.current=null,e());let r=o.current;r&&(o.current=null,r())}else e&&(s.current=n(e,t)),r&&(o.current=n(r,t))},[e,r])}function n(e,r){if("function"!=typeof e)return e.current=r,()=>{e.current=null};{let s=e(r);return"function"==typeof s?s:()=>e(null)}}("function"==typeof s.default||"object"==typeof s.default&&null!==s.default)&&void 0===s.default.__esModule&&(Object.defineProperty(s.default,"__esModule",{value:!0}),Object.assign(s.default,s),r.exports=s.default)},18967,(e,r,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0});var t={DecodeError:function(){return b},MiddlewareNotFoundError:function(){return w},MissingStaticPage:function(){return _},NormalizeError:function(){return x},PageNotFoundError:function(){return y},SP:function(){return p},ST:function(){return h},WEB_VITALS:function(){return n},execOnce:function(){return i},getDisplayName:function(){return u},getLocationOrigin:function(){return c},getURL:function(){return d},isAbsoluteUrl:function(){return a},isResSent:function(){return m},loadGetInitialProps:function(){return f},normalizeRepeatedSlashes:function(){return g},stringifyError:function(){return v}};for(var o in t)Object.defineProperty(s,o,{enumerable:!0,get:t[o]});let n=["CLS","FCP","FID","INP","LCP","TTFB"];function i(e){let r,s=!1;return(...t)=>(s||(s=!0,r=e(...t)),r)}let l=/^[a-zA-Z][a-zA-Z\d+\-.]*?:/,a=e=>l.test(e);function c(){let{protocol:e,hostname:r,port:s}=window.location;return`${e}//${r}${s?":"+s:""}`}function d(){let{href:e}=window.location,r=c();return e.substring(r.length)}function u(e){return"string"==typeof e?e:e.displayName||e.name||"Unknown"}function m(e){return e.finished||e.headersSent}function g(e){let r=e.split("?");return r[0].replace(/\\/g,"/").replace(/\/\/+/g,"/")+(r[1]?`?${r.slice(1).join("?")}`:"")}async function f(e,r){let s=r.res||r.ctx&&r.ctx.res;if(!e.getInitialProps)return r.ctx&&r.Component?{pageProps:await f(r.Component,r.ctx)}:{};let t=await e.getInitialProps(r);if(s&&m(s))return t;if(!t)throw Object.defineProperty(Error(`"${u(e)}.getInitialProps()" should resolve to an object. But found "${t}" instead.`),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return t}let p="undefined"!=typeof performance,h=p&&["mark","measure","getEntriesByName"].every(e=>"function"==typeof performance[e]);class b extends Error{}class x extends Error{}class y extends Error{constructor(e){super(),this.code="ENOENT",this.name="PageNotFoundError",this.message=`Cannot find module for page: ${e}`}}class _ extends Error{constructor(e,r){super(),this.message=`Failed to load static file for page: ${e} ${r}`}}class w extends Error{constructor(){super(),this.code="ENOENT",this.message="Cannot find the middleware module"}}function v(e){return JSON.stringify({message:e.message,stack:e.stack})}},73668,(e,r,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"isLocalURL",{enumerable:!0,get:function(){return n}});let t=e.r(18967),o=e.r(52817);function n(e){if(!(0,t.isAbsoluteUrl)(e))return!0;try{let r=(0,t.getLocationOrigin)(),s=new URL(e,r);return s.origin===r&&(0,o.hasBasePath)(s.pathname)}catch(e){return!1}}},84508,(e,r,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"errorOnce",{enumerable:!0,get:function(){return t}});let t=e=>{}},22016,(e,r,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0});var t={default:function(){return b},useLinkStatus:function(){return y}};for(var o in t)Object.defineProperty(s,o,{enumerable:!0,get:t[o]});let n=e.r(90809),i=e.r(43476),l=n._(e.r(71645)),a=e.r(95057),c=e.r(8372),d=e.r(18581),u=e.r(18967),m=e.r(5550);e.r(33525);let g=e.r(91949),f=e.r(73668),p=e.r(9396);function h(e){return"string"==typeof e?e:(0,a.formatUrl)(e)}function b(r){var s;let t,o,n,[a,b]=(0,l.useOptimistic)(g.IDLE_LINK_STATUS),y=(0,l.useRef)(null),{href:_,as:w,children:v,prefetch:j=null,passHref:N,replace:S,shallow:L,scroll:E,onClick:q,onMouseEnter:P,onTouchStart:C,legacyBehavior:k=!1,onNavigate:A,ref:I,unstable_dynamicOnHover:R,...z}=r;t=v,k&&("string"==typeof t||"number"==typeof t)&&(t=(0,i.jsx)("a",{children:t}));let T=l.default.useContext(c.AppRouterContext),U=!1!==j,F=!1!==j?null===(s=j)||"auto"===s?p.FetchStrategy.PPR:p.FetchStrategy.Full:p.FetchStrategy.PPR,{href:O,as:B}=l.default.useMemo(()=>{let e=h(_);return{href:e,as:w?h(w):e}},[_,w]);if(k){if(t?.$$typeof===Symbol.for("react.lazy"))throw Object.defineProperty(Error("`<Link legacyBehavior>` received a direct child that is either a Server Component, or JSX that was loaded with React.lazy(). This is not supported. Either remove legacyBehavior, or make the direct child a Client Component that renders the Link's `<a>` tag."),"__NEXT_ERROR_CODE",{value:"E863",enumerable:!1,configurable:!0});o=l.default.Children.only(t)}let $=k?o&&"object"==typeof o&&o.ref:I,M=l.default.useCallback(e=>(null!==T&&(y.current=(0,g.mountLinkInstance)(e,O,T,F,U,b)),()=>{y.current&&((0,g.unmountLinkForCurrentNavigation)(y.current),y.current=null),(0,g.unmountPrefetchableInstance)(e)}),[U,O,T,F,b]),D={ref:(0,d.useMergedRef)(M,$),onClick(r){k||"function"!=typeof q||q(r),k&&o.props&&"function"==typeof o.props.onClick&&o.props.onClick(r),!T||r.defaultPrevented||function(r,s,t,o,n,i,a){if("undefined"!=typeof window){let c,{nodeName:d}=r.currentTarget;if("A"===d.toUpperCase()&&((c=r.currentTarget.getAttribute("target"))&&"_self"!==c||r.metaKey||r.ctrlKey||r.shiftKey||r.altKey||r.nativeEvent&&2===r.nativeEvent.which)||r.currentTarget.hasAttribute("download"))return;if(!(0,f.isLocalURL)(s)){n&&(r.preventDefault(),location.replace(s));return}if(r.preventDefault(),a){let e=!1;if(a({preventDefault:()=>{e=!0}}),e)return}let{dispatchNavigateAction:u}=e.r(99781);l.default.startTransition(()=>{u(t||s,n?"replace":"push",i??!0,o.current)})}}(r,O,B,y,S,E,A)},onMouseEnter(e){k||"function"!=typeof P||P(e),k&&o.props&&"function"==typeof o.props.onMouseEnter&&o.props.onMouseEnter(e),T&&U&&(0,g.onNavigationIntent)(e.currentTarget,!0===R)},onTouchStart:function(e){k||"function"!=typeof C||C(e),k&&o.props&&"function"==typeof o.props.onTouchStart&&o.props.onTouchStart(e),T&&U&&(0,g.onNavigationIntent)(e.currentTarget,!0===R)}};return(0,u.isAbsoluteUrl)(B)?D.href=B:k&&!N&&("a"!==o.type||"href"in o.props)||(D.href=(0,m.addBasePath)(B)),n=k?l.default.cloneElement(o,D):(0,i.jsx)("a",{...z,...D,children:t}),(0,i.jsx)(x.Provider,{value:a,children:n})}e.r(84508);let x=(0,l.createContext)(g.IDLE_LINK_STATUS),y=()=>(0,l.useContext)(x);("function"==typeof s.default||"object"==typeof s.default&&null!==s.default)&&void 0===s.default.__esModule&&(Object.defineProperty(s.default,"__esModule",{value:!0}),Object.assign(s.default,s),r.exports=s.default)},48010,43194,12978,e=>{"use strict";var r=e.i(43476),s=e.i(32341),t=e.i(18566),o=e.i(71645);let n=({duration:e=3e3,className:r="",showPercentage:s=!0})=>{let[t,n]=(0,o.useState)(0);return(0,o.useEffect)(()=>{let r=setInterval(()=>{n(e=>e>=100?(clearInterval(r),100):e+1)},e/100);return()=>clearInterval(r)},[e]),o.default.createElement("div",{className:"w-full "+r},s&&o.default.createElement("div",{className:"flex justify-between items-center mb-2"},o.default.createElement("span",{className:"text-sm font-medium text-gray-300"},"Loading..."),o.default.createElement("span",{className:"text-sm font-medium text-accent-primary"},t+"%")),o.default.createElement("div",{className:"w-full bg-gray-800 rounded-full h-2.5"},o.default.createElement("div",{className:"bg-gradient-to-r from-accent-primary to-purple-600 h-2.5 rounded-full transition-all duration-100 ease-out",style:{width:t+"%"}})),t>=100&&o.default.createElement("div",{className:"mt-2 text-center text-sm text-green-400 animate-pulse"},"Complete!"))};e.s(["default",0,n],43194);let i=({className:e="",count:s=1,showLoadingBar:t=!1,loadingDuration:o=3e3})=>{let i=Array.from({length:s},(s,t)=>(0,r.jsx)("div",{className:`animate-pulse bg-gray-700 rounded ${e}`},t));return(0,r.jsxs)(r.Fragment,{children:[t&&(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)(n,{duration:o})}),i]})};e.s(["default",0,i],12978);let l=({className:e="",loadingText:s="Loading...",showLoadingBar:t=!0,showSkeletons:o=!0,skeletonCount:l=5,duration:a=5e3})=>(0,r.jsxs)("div",{className:`relative ${e}`,children:[t&&(0,r.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50 pt-2 px-4",children:(0,r.jsx)(n,{duration:a,showPercentage:!1})}),o&&(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"mb-8 text-center",children:[(0,r.jsx)(i,{className:"h-8 w-64 mb-4 mx-auto"}),(0,r.jsx)(i,{className:"h-4 w-48 mx-auto"})]}),(0,r.jsx)("div",{className:"space-y-6",children:Array.from({length:l}).map((e,s)=>(0,r.jsxs)("div",{className:"card p-6 border border-card-border",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)(i,{className:"h-6 w-32"}),(0,r.jsx)(i,{className:"h-4 w-16"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(i,{className:"h-4 w-full"}),(0,r.jsx)(i,{className:"h-4 w-5/6"}),(0,r.jsx)(i,{className:"h-4 w-4/6"}),(0,r.jsxs)("div",{className:"flex gap-3 mt-4",children:[(0,r.jsx)(i,{className:"h-10 w-24 rounded-lg"}),(0,r.jsx)(i,{className:"h-10 w-24 rounded-lg"})]})]})]},s))})]})]});e.s(["default",0,({children:e})=>{let[n,i]=(0,o.useState)(!1);(0,o.useEffect)(()=>{i(!0)},[]);let{state:a}=(0,s.useAuthStore)(),{user:c,authLoading:d}=a,u=(0,t.useRouter)();return((0,o.useEffect)(()=>{!n||d||c||u.push("/auth/login")},[n,c,d,u]),n)?d?(0,r.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,r.jsx)(l,{loadingText:"Checking authentication status..."})}):c?(0,r.jsx)(r.Fragment,{children:e}):null:(0,r.jsx)(r.Fragment,{children:e})}],48010)},46753,e=>{"use strict";let r=(0,e.i(75254).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["default",()=>r])},63160,e=>{"use strict";var r=e.i(7471);let s=async()=>{console.log("listCourses: Fetching published courses");let{data:e,error:s}=await r.supabase.from("courses").select("id, title, description, thumbnail_url, is_published, created_at").eq("is_published",!0).order("created_at",{ascending:!1});if(s)throw console.error("listCourses: Error fetching courses:",s),console.error("Supabase error",{message:s?.message,details:s?.details,hint:s?.hint,code:s?.code}),s;if(!e||0===e.length)return console.log("listCourses: No courses found"),[];let t=e.map(e=>e.id),{data:o,error:n}=await r.supabase.from("modules").select("id, course_id, title, order_index").in("course_id",t).order("order_index",{ascending:!0});if(n)throw console.error("listCourses: Error fetching modules:",n),console.error("Supabase error",{message:n?.message,details:n?.details,hint:n?.hint,code:n?.code}),n;let i={};if(o)for(let e of o)i[e.course_id]||(i[e.course_id]=[]),i[e.course_id].push(e);let l=o?.map(e=>e.id)||[],a=[];if(l.length>0){let{data:e,error:s}=await r.supabase.from("lessons").select("id, module_id, title, description, order_index, video_provider, video_url, youtube_video_id, is_preview, is_published, created_at").in("module_id",l).order("order_index",{ascending:!0});if(s)throw console.error("listCourses: Error fetching lessons:",s),console.error("Supabase error",{message:s?.message,details:s?.details,hint:s?.hint,code:s?.code}),console.warn("Warning: Failed to fetch lessons, continuing with empty lessons array"),a=[],s;a=e||[]}let c={};for(let e of a)c[e.module_id]||(c[e.module_id]=[]),c[e.module_id].push(e);let d=e.map(e=>({...e,modules:i[e.id]?i[e.id].map(e=>({...e,lessons:c[e.id]||[]})):[]}));return console.log("listCourses: Final result",{count:d.length}),d},t=async(e,s)=>{console.log("getCourse: Fetching course:",e,"for user:",s);let{data:t,error:n}=await r.supabase.from("courses").select("id, title, description, thumbnail_url, is_published, created_at").eq("id",e).eq("is_published",!0).single();if(n)throw console.error("getCourse: Error fetching course:",n),console.error("Supabase error",{message:n?.message,details:n?.details,hint:n?.hint,code:n?.code}),n;if(!t)throw Error("Course not found");let{data:i,error:l}=await r.supabase.from("modules").select("id, course_id, title, order_index").eq("course_id",e).order("order_index",{ascending:!0});if(l)throw console.error("getCourse: Error fetching modules:",l),console.error("Supabase error",{message:l?.message,details:l?.details,hint:l?.hint,code:l?.code}),l;let a=i?.map(e=>e.id)||[],c=[];if(a.length>0){let{data:e,error:s}=await r.supabase.from("lessons").select("id, module_id, title, description, order_index, video_provider, video_url, youtube_video_id, is_preview, is_published, created_at").in("module_id",a).order("order_index",{ascending:!0});if(s)throw console.error("getCourse: Error fetching lessons:",s),console.error("Supabase error",{message:s?.message,details:s?.details,hint:s?.hint,code:s?.code}),console.warn("Warning: Failed to fetch lessons, continuing with empty lessons array"),c=[],s;c=e||[]}let d={};for(let e of c)d[e.module_id]||(d[e.module_id]=[]),d[e.module_id].push(e);let u={...t,modules:i?.map(e=>({...e,lessons:d[e.id]||[]}))||[]};if(console.log("getCourse: Result",{course:u.id,modules:u.modules.length}),s){let r=await o(s,e);return{...u,progress:r}}return u},o=async(e,s)=>{console.log("getCourseProgress: Fetching progress for user:",e,"course:",s);let{data:t,error:o}=await r.supabase.from("modules").select("id").eq("course_id",s);if(o)throw console.error("getCourseProgress: Error fetching modules:",o),console.error("Supabase error",{message:o?.message,details:o?.details,hint:o?.hint,code:o?.code}),o;let n=[];if(t&&t.length>0){let e=t.map(e=>e.id),{data:s,error:o}=await r.supabase.from("lessons").select("id").in("module_id",e);if(o)return console.error("getCourseProgress: Error fetching lessons:",o),console.error("Supabase error",{message:o?.message,details:o?.details,hint:o?.hint,code:o?.code}),console.warn("Warning: Failed to fetch lessons for progress calculation"),{total_lessons:0,completed_lessons:0,progress_percent:0,last_accessed_lesson_id:null};n=s?.map(e=>e.id)||[]}let i=n.length;if(0===i)return{total_lessons:0,completed_lessons:0,progress_percent:0,last_accessed_lesson_id:null};let{data:l,error:a}=await r.supabase.from("user_lesson_progress").select("lesson_id, completed, updated_at").eq("user_id",e).in("lesson_id",n);if(a)throw console.error("getCourseProgress: Error fetching progress data:",a),console.error("Supabase error",{message:a?.message,details:a?.details,hint:a?.hint,code:a?.code}),a;let c=l?.filter(e=>e.completed).length||0,d=i>0?Math.round(c/i*100):0,u=l?.sort((e,r)=>new Date(r.updated_at).getTime()-new Date(e.updated_at).getTime());return{total_lessons:i,completed_lessons:c,progress_percent:d,last_accessed_lesson_id:u?.[0]?.lesson_id||null}},n=async(e,s)=>{console.log("getNextLesson: Finding next lesson for user:",e,"course:",s);let o=await t(s,e);if(!o.modules||0===o.modules.length)return console.log("getNextLesson: No modules found"),null;let{data:n,error:i}=await r.supabase.from("user_lesson_progress").select("lesson_id, completed").eq("user_id",e).eq("completed",!0);if(i)throw console.error("getNextLesson: Error fetching progress:",i),console.error("Supabase error",{message:i?.message,details:i?.details,hint:i?.hint,code:i?.code}),i;let l=new Set(n?.map(e=>e.lesson_id)||[]);for(let e of o.modules)if(e.lessons){for(let r of e.lessons)if(!l.has(r.id))return console.log("getNextLesson: Found next lesson:",r.id),r}console.log("getNextLesson: All lessons completed, returning first lesson");let a=o.modules[0];return a&&a.lessons&&a.lessons.length>0?a.lessons[0]:null},i=async(e,s)=>{console.log("getResumeLesson: Finding resume lesson for user:",e,"course:",s);let{data:t,error:o}=await r.supabase.from("user_lesson_progress").select(`
      lesson_id,
      completed,
      last_position_seconds
    `).eq("user_id",e).order("updated_at",{ascending:!1}).limit(5);if(o)throw console.error("getResumeLesson: Error fetching recent progress:",o),console.error("Supabase error",{message:o?.message,details:o?.details,hint:o?.hint,code:o?.code}),o;if(t){for(let e of t)if(!e.completed&&e.last_position_seconds>0){let{data:s,error:t}=await r.supabase.from("lessons").select("*").eq("id",e.lesson_id).single();if(!t&&s)return console.log("getResumeLesson: Found resume lesson with progress:",s.id),s}}return n(e,s)},l=async(e,s,t)=>{console.log("updateUserLessonProgress: Updating progress for user:",e,"lesson:",s,"data:",t);let{data:o,error:n}=await r.supabase.from("user_lesson_progress").upsert({user_id:e,lesson_id:s,...t,updated_at:new Date().toISOString()},{onConflict:"user_id,lesson_id"}).select().single();if(console.log("updateUserLessonProgress: Result",{data:o,error:n}),n)throw console.error("updateUserLessonProgress: Error updating progress:",n),console.error("Supabase error",{message:n?.message,details:n?.details,hint:n?.hint,code:n?.code}),n;return o},a=async(e,r=3)=>{console.log("getContinueLearningItems: Fetching items for user:",e,"limit:",r);let t=await s(),i=[];for(let r of t){let s=await o(e,r.id);if(s.total_lessons>0&&s.progress_percent<100){let t=await n(e,r.id);t&&i.push({course:r,next_lesson:t,progress_percent:s.progress_percent})}}return i.sort((e,r)=>e.progress_percent-r.progress_percent).slice(0,r)},c=async(e,s)=>{console.log("getUserLessonProgress: Fetching progress for user:",e,"lesson:",s);let{data:t,error:o}=await r.supabase.from("user_lesson_progress").select("*").eq("user_id",e).eq("lesson_id",s).maybeSingle();if(console.log("getUserLessonProgress: Result",{data:t,error:o}),o&&"PGRST116"!==o.code)throw console.error("getUserLessonProgress: Error fetching progress:",o),console.error("Supabase error",{message:o?.message,details:o?.details,hint:o?.hint,code:o?.code}),o;return t||(console.log("getUserLessonProgress: No progress found, returning default"),{user_id:e,lesson_id:s,completed:!1,completed_at:null,last_position_seconds:0,updated_at:new Date().toISOString()})},d=async(e,s)=>{console.log("checkLessonAccess: Checking access for user:",e,"lesson:",s);let{data:t,error:o}=await r.supabase.from("lessons").select("is_preview").eq("id",s).single();if(o)return console.error("checkLessonAccess: Error fetching lesson:",o),console.error("Supabase error",{message:o?.message,details:o?.details,hint:o?.hint,code:o?.code}),{hasAccess:!1,isPreview:!1};if(t.is_preview)return console.log("checkLessonAccess: Lesson is preview, access granted"),{hasAccess:!0,isPreview:!0};let{data:n,error:i}=await r.supabase.from("profiles").select("plan").eq("id",e).maybeSingle();if(i)return console.error("checkLessonAccess: Error fetching profile:",i),console.error("Supabase error",{message:i?.message,details:i?.details,hint:i?.hint,code:i?.code}),{hasAccess:!1,isPreview:!1};if(!n)return console.log("checkLessonAccess: No profile found for user, denying access"),{hasAccess:!1,isPreview:!1};let l="member"===n.plan;return console.log("checkLessonAccess: Member access check result:",{hasAccess:l,plan:n.plan}),{hasAccess:l,isPreview:!1}};e.s(["checkLessonAccess",0,d,"getContinueLearningItems",0,a,"getCourse",0,t,"getCourseProgress",0,o,"getNextLesson",0,n,"getResumeLesson",0,i,"getUserLessonProgress",0,c,"listCourses",0,s,"updateUserLessonProgress",0,l])},63365,e=>{"use strict";var r=e.i(7471);let s=async e=>{console.log("getLessonById: Fetching lesson:",e);let{data:s,error:t}=await r.supabase.from("lessons").select(`
      id,
      title,
      description,
      video_provider,
      video_url,
      youtube_video_id,
      is_preview,
      is_published,
      module_id,
      modules (
        id,
        title,
        course_id,
        courses (
          id,
          title
        )
      )
    `).eq("id",e).eq("is_published",!0).single();if(console.log("getLessonById: Result",{data:s,error:t}),t)throw console.error("getLessonById: Error fetching lesson:",t),t;return s},t=async(e=10)=>{console.log("getLatestAnnouncements: Fetching latest announcements, limit:",e);let{data:s,error:t}=await r.supabase.from("announcements").select("id, title, body, created_at").order("created_at",{ascending:!1}).limit(e);if(console.log("getLatestAnnouncements: Result",{data:s,error:t}),t)throw console.error("getLatestAnnouncements: Error fetching announcements:",t),t;return s||[]},o=async e=>{console.log("getUserProfile: Fetching profile for user:",e);let{data:s,error:t}=await r.supabase.from("profiles").select("id, username, full_name, role, plan, created_at, trial_started_at, trial_expires_at, account_locked").eq("id",e).maybeSingle();if(console.log("getUserProfile: Result",{data:s,error:t}),t)throw console.error("getUserProfile: Error fetching profile:",t),t;return s||(console.log("getUserProfile: No profile found for user:",e),null)},n=async()=>{console.log("getAllCourses: Fetching all courses");let{data:e,error:s}=await r.supabase.from("courses").select(`
      id,
      title,
      description,
      thumbnail_url,
      is_published,
      created_at,
      updated_at
    `).order("created_at",{ascending:!1});if(console.log("getAllCourses: Result",{data:e,error:s}),s)throw console.error("getAllCourses: Error fetching courses:",s),s;return e||[]},i=async(e,r)=>{if(console.log("checkLessonAccess: Checking access for user:",e,"lesson:",r),(await s(r)).is_preview)return console.log("checkLessonAccess: Lesson is preview, access granted"),{hasAccess:!0,isPreview:!0};let t=await o(e);if(!t)return console.log("checkLessonAccess: No profile found for user, denying access"),{hasAccess:!1,isPreview:!1};let n=!1;if("member"===t.plan)n=!0;else if("free"===t.plan&&t.trial_expires_at){let e=new Date(t.trial_expires_at);n=new Date<e}return console.log("checkLessonAccess: Trial/membership access check result:",{hasAccess:n,plan:t.plan,trialExpiresAt:t.trial_expires_at}),{hasAccess:n,isPreview:!1}};e.s(["checkLessonAccess",0,i,"getAllCourses",0,n,"getLatestAnnouncements",0,t,"getLessonById",0,s])},51876,e=>{"use strict";e.i(47167);var r=e.i(43476),s=e.i(71645),t=e.i(18566),o=e.i(32341);let n=(0,e.i(75254).default)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);var i=e.i(48010),l=e.i(10400),a=e.i(63365),c=e.i(63160),d=e.i(7471);let u=async e=>{console.log("getQuizByLessonId: Fetching quiz for lesson:",e);try{let{data:r,error:s}=await d.supabase.from("quizzes").select("*").eq("lesson_id",e).eq("is_active",!0).maybeSingle();if(s)throw console.error("getQuizByLessonId: Error fetching quiz:",{name:s.name,message:s.message,details:s.details}),s;if(!r)return null;console.log("getQuizByLessonId: Fetching questions for lesson:",e);let{data:t,error:o}=await d.supabase.from("quiz_questions").select("*").limit(10);t&&console.log("getQuizByLessonId: All questions in DB:",t.map(e=>({id:e.id,lesson_id:e.lesson_id,text:e.question_text?.substring(0,30)+"..."})));let{data:n,error:i}=await d.supabase.from("quiz_questions").select("*").eq("lesson_id",e).order("order_index",{ascending:!0});if(i)throw console.error("getQuizByLessonId: Error fetching questions:",i),i;console.log("getQuizByLessonId: Raw questions data:",n?.length||0,"questions found"),n&&console.log("getQuizByLessonId: Questions sample:",n.slice(0,2).map(e=>({id:e.id,text:e.question_text?.substring(0,50)+"..."})));let l=[...n||[]].sort((e,r)=>e.order_index-r.order_index);console.log("getQuizByLessonId: Sorted questions count:",l.length);let a=[];for(let[e,r]of(console.log("getQuizByLessonId: Processing",l.length,"questions"),l.entries())){console.log(`getQuizByLessonId: Processing question ${e+1}/${l.length}:`,{id:r.id,text:r.question_text?.substring(0,50)+"..."});let{data:s,error:t}=await d.supabase.from("quiz_options").select("*").eq("question_id",r.id).order("order_index",{ascending:!0});if(t)throw console.error("getQuizByLessonId: Error fetching options for question:",r.id,t),t;console.log(`getQuizByLessonId: Question ${r.id} has ${s?.length||0} options`),a.push({...r,options:s||[]})}console.log("getQuizByLessonId: Built questionsWithOptions array with",a.length,"questions");let c={...r,questions:a};return console.log("getQuizByLessonId: Final result structure:",{quizId:c.id,lessonId:c.lesson_id,title:c.title,questionsCount:c.questions?.length||0,questionsSample:c.questions?.slice(0,2).map(e=>({id:e.id,text:e.question_text?.substring(0,50)+"...",optionsCount:e.options?.length||0}))}),c}catch(e){if(console.error("getQuizByLessonId: Unhandled error:",{name:e?.name||"UnknownError",message:e?.message||"Unknown error occurred",stack:e?.stack}),e?.name==="TypeError"&&e?.message?.includes("Failed to fetch"))if("undefined"==typeof navigator||navigator.onLine)throw Error("Network error: Unable to connect to database server");else throw Error("Network error: You appear to be offline");throw e}},m=async(e,r,s)=>{console.log("submitQuizAnswers: Submitting answers for user:",e,"lesson:",r);let t=await u(r);if(!t)throw Error("Quiz not found for this lesson");let{data:o,error:n}=await d.supabase.from("quiz_submissions").insert({user_id:e,lesson_id:r,score:0,total_questions:t.questions.length}).select("id").single();if(n)throw console.error("submitQuizAnswers: Error creating submission:",n),n;let i=0;for(let e of s){let r=t.questions.find(r=>r.id===e.question_id);if(!r)continue;let s=!1;if("multiple_choice"===r.question_type){if(e.selected_option_id){let t=r.options?.find(r=>r.id===e.selected_option_id);t?.is_correct&&(s=!0,i++)}}else"short_answer"===r.question_type&&e.answer_text&&e.answer_text.trim().length>0&&(s=!0,i++);let{error:n}=await d.supabase.from("quiz_answers").insert({submission_id:o.id,question_id:e.question_id,selected_option_id:e.selected_option_id,answer_text:e.answer_text,is_correct:s});if(n)throw console.error("submitQuizAnswers: Error saving answer:",n),n}let l=Math.round(i/t.questions.length*100),{error:a}=await d.supabase.from("quiz_submissions").update({score:l,completed_at:new Date().toISOString()}).eq("id",o.id);if(a)throw console.error("submitQuizAnswers: Error updating score:",a),a;return console.log("submitQuizAnswers: Successfully submitted answers for user:",e,"lesson:",r,"score:",l),{score:l,total:t.questions.length}},g=async(e,r)=>{console.log("getUserQuizSubmission: Fetching submission for user:",e,"lesson:",r);let{data:s,error:t}=await d.supabase.from("quiz_submissions").select("*").eq("user_id",e).eq("lesson_id",r).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(t)throw console.error("getUserQuizSubmission: Error fetching submission:",t),t;return s},f=async(e,r)=>{console.log("getQuizSubmissionByLessonId: Fetching submission for user:",e,"lesson:",r);let{data:s,error:t}=await d.supabase.from("quiz_submissions").select("*").eq("user_id",e).eq("lesson_id",r).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(t)throw console.error("getQuizSubmissionByLessonId: Error fetching submission:",t),t;return s},p=({question:e,onAnswer:t,selectedAnswer:o,isSubmitted:n})=>{let[i,l]=(0,s.useState)("string"==typeof o?o:"");return(0,r.jsxs)("div",{className:"mb-8 p-6 bg-card-bg rounded-lg border border-card-border",children:[(0,r.jsxs)("div",{className:"flex items-start gap-3 mb-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0 mt-1",children:(0,r.jsx)("div",{className:"w-6 h-6 rounded-full bg-accent-primary/20 flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-xs font-bold text-accent-primary",children:e.order_index+1})})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"font-medium text-white text-lg mb-3",children:e.question_text}),"multiple_choice"===e.question_type?(0,r.jsx)("div",{className:"space-y-3",children:e.options?.map(s=>(0,r.jsx)("div",{className:`p-3 rounded-lg border cursor-pointer transition-all ${n?s.is_correct?"border-green-500 bg-green-900/20":o===s.id&&!s.is_correct?"border-red-500 bg-red-900/20":"border-card-border":o===s.id?"border-accent-primary bg-accent-primary/10":"border-card-border hover:border-accent-primary/50"}`,onClick:()=>{var r;return r=s.id,void(!n&&t(e.id,r))},children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("div",{className:`w-4 h-4 rounded-full border mr-3 flex items-center justify-center ${n?s.is_correct?"border-green-500 bg-green-500":o===s.id&&!s.is_correct?"border-red-500 bg-red-500":"border-gray-500":o===s.id?"border-accent-primary bg-accent-primary":"border-gray-500"}`,children:[n&&s.is_correct&&(0,r.jsx)("svg",{className:"w-2 h-2 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),n&&o===s.id&&!s.is_correct&&(0,r.jsx)("svg",{className:"w-2 h-2 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),(0,r.jsx)("span",{className:n&&s.is_correct?"text-green-400":n&&o===s.id&&!s.is_correct?"text-red-400":"text-gray-300",children:s.option_text})]})},s.id))}):(0,r.jsxs)("div",{children:[(0,r.jsx)("textarea",{value:n?o??"":i,onChange:r=>{if(!n){let s=r.target.value;l(s),t(e.id,s)}},disabled:n,placeholder:"Type your answer here...",className:`w-full p-3 rounded-lg border bg-card-bg text-white ${n?"border-gray-600 bg-gray-800/50":"border-card-border focus:border-accent-primary focus:ring-1 focus:ring-accent-primary"}`,rows:4}),n&&o&&(0,r.jsx)("div",{className:"mt-2 text-sm text-green-400",children:"✓ Your answer has been recorded"})]})]})]}),n&&"multiple_choice"===e.question_type&&(0,r.jsx)("div",{className:"mt-3 text-sm",children:o&&"string"==typeof o&&!e.options?.some(e=>e.id===o)&&(0,r.jsx)("div",{className:"text-yellow-400",children:"You didn't select an answer for this question."})})]})},h=({lessonId:e,quiz:t,onComplete:n})=>{let{state:i}=(0,o.useAuthStore)(),l=i.user,[a,c]=(0,s.useState)({}),[d,u]=(0,s.useState)(!1),[f,h]=(0,s.useState)(null),[b,x]=(0,s.useState)(!0);(0,s.useEffect)(()=>{(async()=>{if(l)try{let r=await g(l.id,e);r&&(h(r.score),u(!0))}catch(e){console.error("Error checking existing submission:",e)}finally{x(!1)}})()},[l,e]);let y=(e,r)=>{let s="string"==typeof r?r:r[0]??"";c(r=>({...r,[e]:s}))},_=async()=>{if(!l)return void alert("Please log in to submit the quiz");for(let e of t.questions)if(e.is_required&&!a[e.id])return void alert(`Please answer the required question: "${e.question_text}"`);try{let r=t.questions.map(e=>({question_id:e.id,..."multiple_choice"===e.question_type?{selected_option_id:a[e.id]}:{answer_text:a[e.id]}})),s=await m(l.id,e,r);h(s.score),u(!0);let o=s.score>=70;n&&n(o)}catch(e){console.error("Error submitting quiz:",e),alert("Error submitting quiz. Please try again.")}};return b?(0,r.jsx)("div",{className:"mt-8 p-6 bg-card-bg rounded-lg border border-card-border",children:(0,r.jsx)("div",{className:"text-center py-8",children:(0,r.jsx)("div",{className:"text-lg text-gray-400",children:"Loading quiz..."})})}):d?(0,r.jsxs)("div",{className:"mt-8 p-6 bg-card-bg rounded-lg border border-card-border",children:[(0,r.jsxs)("div",{className:"text-center mb-6",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-white mb-2",children:"Quiz Complete!"}),(0,r.jsxs)("div",{className:"text-3xl font-bold text-accent-primary mb-2",children:["Score: ",f,"%"]}),(0,r.jsx)("div",{className:"text-gray-400",children:"You've completed this lesson's quiz."})]}),(0,r.jsx)("div",{className:"space-y-6",children:t.questions.map(e=>(0,r.jsx)(p,{question:e,onAnswer:y,selectedAnswer:a[e.id]??"",isSubmitted:!0},e.id))})]}):(0,r.jsxs)("div",{className:"mt-8 p-6 bg-card-bg rounded-lg border border-card-border",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-white mb-2",children:t.title}),(0,r.jsx)("p",{className:"text-gray-400",children:t.description})]}),(0,r.jsx)("div",{className:"space-y-6",children:t.questions.map(e=>(0,r.jsx)(p,{question:e,onAnswer:y,selectedAnswer:a[e.id]??"",isSubmitted:!1},e.id))}),(0,r.jsxs)("div",{className:"mt-8 flex flex-col sm:flex-row gap-4 justify-center",children:[(0,r.jsx)("button",{onClick:_,className:"px-8 py-3 bg-accent-primary text-white font-bold rounded-lg hover:bg-accent-primary/90 transition-colors text-lg hover-lift border border-accent-primary",children:"Submit Quiz"}),(0,r.jsx)("button",{onClick:()=>{u(!1),h(null)},className:"px-8 py-3 bg-gray-700 text-white font-bold rounded-lg hover:bg-gray-600 transition-colors text-lg hover-lift",children:"Retake Quiz"})]})]})},b=null,x=e=>{if(e&&"function"==typeof e.destroy)try{console.log("YT: destroying player"),e.destroy()}catch(e){console.warn("YT: Error destroying player:",e)}},y=async(e,r,s)=>{console.log("lessonReviewService.upsertLessonReview: user",e,"lesson",r,"input",s);let{data:t,error:o}=await d.supabase.from("lesson_reviews").upsert({user_id:e,lesson_id:r,rating:s.rating,comment:s.comment??null,is_anonymous:!!s.is_anonymous,updated_at:new Date().toISOString()},{onConflict:"lesson_id,user_id"}).select().single();if(o)throw console.error("lessonReviewService.upsertLessonReview: error",o),o;return console.log("lessonReviewService.upsertLessonReview: ok",t?.id),t},_=async(e,r)=>{console.log("lessonReviewService.getMyLessonReview: user",e,"lesson",r);let{data:s,error:t}=await d.supabase.from("lesson_reviews").select("*").eq("user_id",e).eq("lesson_id",r).maybeSingle();if(t)throw console.error("lessonReviewService.getMyLessonReview: error",t),t;return s},w=({lessonId:e})=>{let{state:t}=(0,o.useAuthStore)(),n=t.user,[i,l]=(0,s.useState)(0),[a,c]=(0,s.useState)(""),[d,u]=(0,s.useState)(!1),[m,g]=(0,s.useState)(!1),[f,p]=(0,s.useState)(null),[h,b]=(0,s.useState)("");(0,s.useEffect)(()=>{(async()=>{if(n)try{g(!0);let r=await _(n.id,e);r&&(p(r),l(r.rating),c(r.comment||""),u(!!r.is_anonymous))}catch(e){console.error("LessonReviewForm: failed to load existing review",e)}finally{g(!1)}})()},[n,e]);let x=async r=>{if(r.preventDefault(),n){if(i<1||i>5)return void b("Please choose a rating between 1 and 5.");try{g(!0),await y(n.id,e,{rating:i,comment:a,is_anonymous:d}),b(f?"Your feedback has been updated. Thank you!":"Thanks for your feedback — it helps us improve!"),p({rating:i,comment:a,is_anonymous:d}),console.log("LessonReviewForm: review submitted",{lessonId:e,rating:i,isAnonymous:d})}catch(e){console.error("LessonReviewForm: submission error",e),b(e?.message||"Something went wrong. Please try again.")}finally{g(!1)}}};return(0,r.jsxs)("div",{className:"mt-8 p-6 bg-card-bg rounded-lg border border-card-border",children:[(0,r.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:"Help us improve this lesson"}),(0,r.jsx)("p",{className:"text-gray-400 mb-4",children:"Your feedback is private and only visible to the VibeSchool team."}),(0,r.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-300 mb-2",children:"Rate this lesson"}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:[1,2,3,4,5].map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>l(e),className:`p-2 rounded ${i>=e?"text-yellow-400":"text-gray-500"} hover:text-yellow-300`,"aria-label":`Rate ${e} star${e>1?"s":""}`,children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:(0,r.jsx)("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.62L12 2 9.19 8.62 2 9.24l5.46 4.73L5.82 21z"})})},e))}),(0,r.jsx)("p",{className:"text-gray-500 text-sm mt-1",children:"Choose between 1 and 5 stars."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-300 mb-2",children:"What did you like or find confusing?"}),(0,r.jsx)("textarea",{value:a,onChange:e=>c(e.target.value),rows:4,placeholder:"Optional",className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-md text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-accent-primary"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{id:"anonymous",type:"checkbox",checked:d,onChange:e=>u(e.target.checked),className:"h-4 w-4 text-accent-primary focus:ring-accent-primary border-gray-700 bg-gray-800"}),(0,r.jsx)("label",{htmlFor:"anonymous",className:"text-gray-300",children:"Submit anonymously"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("button",{type:"submit",disabled:m||0===i,className:`px-4 py-2 rounded font-medium transition-colors hover-lift border ${m||0===i?"bg-gray-700 text-gray-400 border-gray-700":"bg-accent-primary text-white hover:bg-accent-primary/90 border-accent-primary"}`,children:f?"Update Feedback":"Submit Feedback"}),h&&(0,r.jsx)("span",{className:"text-gray-300 text-sm",children:h})]})]})]})};e.s(["default",0,()=>{let{lessonId:e}=(0,t.useParams)(),{state:d}=(0,o.useAuthStore)(),m=d.user,[g,p]=(0,s.useState)(null),[y,_]=(0,s.useState)(!0),[v,j]=(0,s.useState)(null),[N,S]=(0,s.useState)({completed:!1,last_position_seconds:0}),[L,E]=(0,s.useState)(!1),[q,P]=(0,s.useState)(!1),[C,k]=(0,s.useState)(!1),[A,I]=(0,s.useState)(!0),[R,z]=(0,s.useState)(!1),[T,U]=(0,s.useState)(null),[F,O]=(0,s.useState)(!0),[B,$]=(0,s.useState)(null),[M,D]=(0,s.useState)(!1),Q=(0,s.useRef)(null),Y=(0,s.useRef)(null),[V,W]=(0,s.useState)(null),G=(0,s.useCallback)(e=>{console.log("YT DEBUG: playerElRef called with node:",!!e),W(e)},[]);(0,s.useEffect)(()=>{m&&e&&K()},[m,e]);let K=async()=>{try{_(!0);let r=await (0,a.checkLessonAccess)(m.id,e);if(k(r.hasAccess),I(!1),!r.hasAccess)return void j("You do not have access to this lesson. Please upgrade to a membership or access a preview lesson.");let s=await (0,a.getLessonById)(e);p(s);let t=await (0,c.getUserLessonProgress)(m.id,e);S(t);try{let r=await u(e);if(U(r),r){let r=await f(m.id,e);r&&($(r),r.score>=70&&D(!0))}}catch(e){console.error("Error loading quiz:",e)}finally{O(!1)}}catch(e){console.error("Error loading lesson:",e),j(e.message||"Failed to load lesson"),O(!1)}finally{_(!1)}},Z=!!(g&&("youtube"===g.video_provider&&g.youtube_video_id||g.video_url&&(g.video_url.includes("youtube.com")||g.video_url.includes("youtu.be"))));(0,s.useEffect)(()=>{if(console.log("YT DEBUG: useEffect triggered, lesson:",!!g,"hasVideo:",Z,"playerEl:",!!V),!g)return;let e=g.youtube_video_id;if(!e&&g.video_url){let r=g.video_url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&\?\s]{11})/);r&&(e=r[1])}if(!e)return void console.log("YT DEBUG: No video ID found");if(!V)return void console.log("YT DEBUG: No player element, waiting for mount");console.log("YT DEBUG: Initializing player with video:",e);let r=!1;return(async()=>{if(!r)try{if(console.log("YT: loading API for video:",e),await function(e=15e3){return window.YT?.Player?Promise.resolve():b||(b=new Promise((r,s)=>{let t=null,o=()=>{t&&clearTimeout(t),r()};if(window.onYouTubeIframeAPIReady=()=>o(),document.querySelector('script[data-yt-iframe-api="true"]')){let e,r;e=0,r=setInterval(()=>{e++,window.YT?.Player?(clearInterval(r),o()):e>200&&(clearInterval(r),s(Error("YT API loaded but Player not available")))},50)}else{let e=document.createElement("script");e.src="https://www.youtube.com/iframe_api",e.async=!0,e.dataset.ytIframeApi="true",e.onerror=()=>s(Error("Failed to load YouTube IFrame API script")),document.body.appendChild(e)}t=setTimeout(()=>{s(Error(`YT API load timeout after ${e}ms`))},e)}).catch(e=>{throw b=null,e}))}(),r||!V)return;console.log("YT: creating player for video:",e),Q.current&&x(Q.current),Q.current=new window.YT.Player(V,{videoId:e,width:"100%",height:"100%",playerVars:{autoplay:0,playsinline:1,modestbranding:1,rel:0,start:0},events:{onReady:e=>{console.log("YT: onReady fired"),r||(Q.current=e.target,E(!0),setTimeout(()=>{N.last_position_seconds>0&&!r&&e.target.seekTo(N.last_position_seconds,!0)},1e3))},onStateChange:e=>{!r&&(e.data===window.YT.PlayerState.PLAYING?P(!0):(e.data===window.YT.PlayerState.PAUSED||e.data===window.YT.PlayerState.ENDED)&&(P(!1),e.data!==window.YT.PlayerState.ENDED||N.completed||H()))},onError:e=>{console.error("YT: Player error:",e),r||j(`Video player error: ${e?.data||"Unknown error"}`)}}})}catch(e){console.error("YT: Failed to initialize player:",e),r||(j(`Failed to load video player: ${e?.message||"Unknown error"}`),E(!1))}})(),()=>{r=!0,Q.current&&(x(Q.current),Q.current=null),E(!1)}},[g?.id,g?.youtube_video_id,V,N.last_position_seconds]),(0,s.useEffect)(()=>(q&&Q.current&&(Y.current&&clearInterval(Y.current),Y.current=setInterval(async()=>{try{let r=Q.current?.getCurrentTime();void 0!==r&&await (0,c.updateUserLessonProgress)(m.id,e,{last_position_seconds:Math.floor(r)})}catch(e){console.error("Error updating progress:",e)}},5e3)),()=>{Y.current&&clearInterval(Y.current)}),[q,m,e]);let H=async()=>{try{await (0,c.updateUserLessonProgress)(m.id,e,{completed:!0,completed_at:new Date().toISOString()}),S(e=>({...e,completed:!0}))}catch(e){console.error("Error marking lesson as complete:",e)}},X=async()=>{if(g&&m)try{let e=g.modules?.course_id;if(!e)return void console.error("Could not find course ID for lesson");let r=await (0,c.getNextLesson)(m.id,e);r?window.location.href=`/learn/${r.id}`:(alert("Congratulations! You have completed all lessons in this course."),window.location.href=`/courses/${e}`)}catch(r){console.error("Error getting next lesson:",r);let e=g.modules?.course_id;e&&(window.location.href=`/courses/${e}`)}};return y||A?(0,r.jsx)(i.default,{children:(0,r.jsx)(l.default,{children:(0,r.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsx)("p",{className:"text-gray-400",children:"Loading lesson..."})})})}):v?(0,r.jsx)(i.default,{children:(0,r.jsx)(l.default,{children:(0,r.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"bg-red-900/20 border border-red-700 rounded-lg p-4",children:[(0,r.jsx)("h2",{className:"text-red-300 font-bold mb-2",children:"Error Loading Lesson"}),(0,r.jsx)("p",{className:"text-red-400",children:v}),(0,r.jsx)("button",{onClick:()=>window.history.back(),className:"mt-4 px-4 py-2 bg-red-700 text-white rounded hover:bg-red-600 hover-lift",children:"Go Back"})]})})})}):C?(0,r.jsx)(i.default,{children:(0,r.jsx)(l.default,{children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-white",children:g?.title}),(0,r.jsxs)("p",{className:"text-gray-400",children:[g?.modules?.courses?.title," • ",g?.modules?.title]})]}),(0,r.jsx)("div",{className:"mb-6 bg-blue-900/20 border border-blue-700 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-blue-300 font-medium",children:"Video Loading Tip"}),(0,r.jsx)("p",{className:"text-blue-400 text-sm mt-1",children:"If the video doesn't load, please refresh the page. Some videos may take a moment to load or require a page refresh to display properly."})]})]})}),(0,r.jsxs)("div",{className:"bg-black rounded-lg overflow-hidden mb-6 relative",children:[(0,r.jsx)("div",{ref:G,"data-yt-container":!0,className:"w-full aspect-video rounded-lg overflow-hidden bg-black"}),!L&&Z&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-primary mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-white",children:"Loading video player..."})]})}),!Z&&(0,r.jsx)("div",{className:"absolute inset-0 w-full aspect-video bg-gray-900 flex items-center justify-center text-gray-400",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{children:"Video not configured"}),(0,r.jsxs)("p",{className:"text-sm mt-2",children:["Lesson ID: ",g?.id]}),(0,r.jsxs)("p",{className:"text-xs mt-1",children:["Video provider: ",g?.video_provider]}),(0,r.jsxs)("p",{className:"text-xs mt-1",children:["YouTube ID: ",g?.youtube_video_id]}),(0,r.jsxs)("p",{className:"text-xs mt-1",children:["Video URL: ",g?.video_url]})]})}),!1,(0,r.jsxs)("div",{className:"p-4 bg-gray-900 flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("button",{onClick:()=>{Q.current&&(Q.current.seekTo(0,!0),Q.current.playVideo())},className:"flex items-center gap-2 px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-600 hover-lift",children:[(0,r.jsx)(n,{size:16}),"Restart"]}),(0,r.jsx)("div",{className:"text-sm text-gray-300",children:N.completed?(0,r.jsx)("span",{className:"text-green-500",children:"✓ Completed"}):(0,r.jsxs)("span",{children:["Resume from ",Math.floor(N.last_position_seconds/60),":",String(Math.floor(N.last_position_seconds%60)).padStart(2,"0")]})})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:H,disabled:N.completed,className:`px-4 py-2 rounded hover-lift ${N.completed?"bg-green-800 text-green-300":"bg-accent-primary text-white hover:bg-accent-primary/90 border border-accent-primary"}`,children:N.completed?"✓ Completed":"Mark as Complete"}),T&&!M&&(0,r.jsx)("button",{onClick:()=>{let e=document.querySelector("#quiz-section");e&&e.scrollIntoView({behavior:"smooth"})},className:"px-4 py-2 rounded hover-lift bg-purple-600 text-white hover:bg-purple-500",children:"Take Quiz"}),M&&(0,r.jsx)("button",{onClick:X,className:"px-4 py-2 rounded hover-lift bg-blue-600 text-white hover:bg-blue-500",children:"Next Lesson →"})]})]})]}),(0,r.jsx)("div",{className:"prose prose-invert max-w-none",children:(0,r.jsx)("p",{className:"text-gray-300",children:g?.description})}),(0,r.jsx)(w,{lessonId:e}),!F&&T&&(0,r.jsxs)("div",{id:"quiz-section",children:[(0,r.jsx)(h,{lessonId:e,quiz:T,onComplete:e=>{D(e),e&&H()}}),!M&&(0,r.jsx)("div",{className:"mt-4 p-4 bg-yellow-900/20 border border-yellow-700 rounded-lg",children:(0,r.jsx)("p",{className:"text-yellow-300",children:"⚠️ Complete the quiz to unlock the next lesson."})})]}),F&&(0,r.jsx)("div",{className:"mt-8 p-6 bg-card-bg rounded-lg border border-card-border",children:(0,r.jsx)("div",{className:"text-center py-8",children:(0,r.jsx)("div",{className:"text-lg text-gray-400",children:"Loading quiz..."})})})]})})}):(0,r.jsx)(i.default,{children:(0,r.jsx)(l.default,{children:(0,r.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"bg-yellow-900/20 border border-yellow-700 rounded-lg p-4",children:[(0,r.jsx)("h2",{className:"text-yellow-300 font-bold mb-2",children:"Access Restricted"}),(0,r.jsx)("p",{className:"text-yellow-400",children:"You need a membership to access this lesson."}),(0,r.jsx)("p",{className:"text-yellow-400 mt-2",children:"Preview lessons are available for free, but full content requires a membership."}),(0,r.jsx)("button",{onClick:()=>window.location.href="/courses",className:"mt-4 px-4 py-2 bg-accent-primary text-white rounded hover:bg-accent-primary/90 hover-lift border border-accent-primary",children:"Browse Courses"})]})})})})}],51876)}]);