{"version":3,"sources":["../../../../src/services/quizService.ts","../../../../src/components/quiz/QuizComponent.tsx","../../../../src/components/reviews/LessonReviewForm.tsx","../../../../src/app/learn/%5BlessonId%5D/page.tsx","../../../../node_modules/lucide-react/src/icons/rotate-ccw.ts","../../../../src/components/quiz/QuizQuestion.tsx","../../../../src/lib/youtube.ts","../../../../src/services/lessonReviewService.ts"],"sourcesContent":["import { supabase } from '@/lib/supabase';\r\nimport { QuizWithQuestions, QuizQuestion, QuizOption } from '@/types/quiz';\r\n\r\nfunction isUuid(value: string | undefined | null) {\r\n  if (!value) return false\r\n  return /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(value)\r\n}\r\n\r\n// Get quiz for a lesson\r\nexport const getQuizByLessonId = async (lessonId: string): Promise<QuizWithQuestions | null> => {\r\n  console.log('getQuizByLessonId: Fetching quiz for lesson:', lessonId);\r\n  \r\n  try {\r\n    // First, get the quiz itself\r\n    const { data: quizData, error: quizError } = await supabase\r\n      .from('quizzes')\r\n      .select('*')\r\n      .eq('lesson_id', lessonId)\r\n      .eq('is_active', true)\r\n      .maybeSingle();\r\n\r\n    if (quizError) {\r\n      console.error('getQuizByLessonId: Error fetching quiz:', {\r\n        name: quizError.name,\r\n        message: quizError.message,\r\n        details: quizError.details\r\n      });\r\n      throw quizError;\r\n    }\r\n\r\n  // If no quiz found for this lesson, return null\r\n  if (!quizData) {\r\n    return null;\r\n  }\r\n\r\n  // Then get the questions for this quiz\r\n  console.log('getQuizByLessonId: Fetching questions for lesson:', lessonId);\r\n  \r\n  // First, let's check what's actually in the database for this lesson\r\n  const { data: allQuestions, error: allQuestionsError } = await supabase\r\n    .from('quiz_questions')\r\n    .select('*')\r\n    .limit(10);\r\n  \r\n  if (allQuestions) {\r\n    console.log('getQuizByLessonId: All questions in DB:', allQuestions.map((q: any) => ({\r\n      id: q.id,\r\n      lesson_id: q.lesson_id,\r\n      text: q.question_text?.substring(0, 30) + '...'\r\n    })));\r\n  }\r\n  \r\n  const { data: questionsData, error: questionsError } = await supabase\r\n    .from('quiz_questions')\r\n    .select('*')\r\n    .eq('lesson_id', lessonId)\r\n    .order('order_index', { ascending: true });\r\n\r\n  if (questionsError) {\r\n    console.error('getQuizByLessonId: Error fetching questions:', questionsError);\r\n    throw questionsError;\r\n  }\r\n\r\n  console.log('getQuizByLessonId: Raw questions data:', questionsData?.length || 0, 'questions found');\r\n  if (questionsData) {\r\n    console.log('getQuizByLessonId: Questions sample:', questionsData.slice(0, 2).map((q: any) => ({\r\n      id: q.id,\r\n      text: q.question_text?.substring(0, 50) + '...'\r\n    })));\r\n  }\r\n\r\n  // Sort questions by order_index\r\n  const sortedQuestions = [...(questionsData || [])].sort((a, b) => a.order_index - b.order_index);\r\n  console.log('getQuizByLessonId: Sorted questions count:', sortedQuestions.length);\r\n\r\n  // Get options for each question\r\n  const questionsWithOptions = [];\r\n  console.log('getQuizByLessonId: Processing', sortedQuestions.length, 'questions');\r\n  \r\n  for (const [index, question] of sortedQuestions.entries()) {\r\n    console.log(`getQuizByLessonId: Processing question ${index + 1}/${sortedQuestions.length}:`, {\r\n      id: question.id,\r\n      text: question.question_text?.substring(0, 50) + '...'\r\n    });\r\n    \r\n    const { data: optionsData, error: optionsError } = await supabase\r\n      .from('quiz_options')\r\n      .select('*')\r\n      .eq('question_id', question.id)\r\n      .order('order_index', { ascending: true });\r\n    \r\n    if (optionsError) {\r\n      console.error('getQuizByLessonId: Error fetching options for question:', question.id, optionsError);\r\n      throw optionsError;\r\n    }\r\n    \r\n    console.log(`getQuizByLessonId: Question ${question.id} has ${optionsData?.length || 0} options`);\r\n    \r\n    questionsWithOptions.push({\r\n      ...question,\r\n      options: optionsData || []\r\n    });\r\n  }\r\n  \r\n  console.log('getQuizByLessonId: Built questionsWithOptions array with', questionsWithOptions.length, 'questions');\r\n\r\n  const quizWithQuestions: QuizWithQuestions = {\r\n    ...quizData,\r\n    questions: questionsWithOptions\r\n  };\r\n\r\n  console.log('getQuizByLessonId: Final result structure:', {\r\n    quizId: quizWithQuestions.id,\r\n    lessonId: quizWithQuestions.lesson_id,\r\n    title: quizWithQuestions.title,\r\n    questionsCount: quizWithQuestions.questions?.length || 0,\r\n    questionsSample: quizWithQuestions.questions?.slice(0, 2).map(q => ({\r\n      id: q.id,\r\n      text: q.question_text?.substring(0, 50) + '...',\r\n      optionsCount: q.options?.length || 0\r\n    }))\r\n  });\r\n  \r\n  return quizWithQuestions;\r\n  } catch (error: any) {\r\n    console.error('getQuizByLessonId: Unhandled error:', {\r\n      name: error?.name || 'UnknownError',\r\n      message: error?.message || 'Unknown error occurred',\r\n      stack: error?.stack\r\n    });\r\n    \r\n    // Enhanced error categorization\r\n    if (error?.name === 'TypeError' && error?.message?.includes('Failed to fetch')) {\r\n      if (typeof navigator !== 'undefined' && !navigator.onLine) {\r\n        throw new Error('Network error: You appear to be offline');\r\n      } else {\r\n        throw new Error('Network error: Unable to connect to database server');\r\n      }\r\n    }\r\n    \r\n    throw error;\r\n  }\r\n};\r\n\r\n// Create or update quiz for a lesson\r\nexport const upsertQuiz = async (lessonId: string, quizData: {\r\n  title: string;\r\n  description: string;\r\n  is_active: boolean;\r\n  questions: {\r\n    id?: string;\r\n    question_text: string;\r\n    question_type: 'multiple_choice' | 'short_answer';\r\n    is_required: boolean;\r\n    order_index: number;\r\n    options?: {\r\n      id?: string;\r\n      option_text: string;\r\n      is_correct: boolean;\r\n      order_index: number;\r\n    }[];\r\n  }[];\r\n}): Promise<void> => {\r\n  console.log('upsertQuiz: Upserting quiz for lesson:', lessonId, 'data:', quizData);\r\n\r\n  // Start a transaction-like approach\r\n  // First, check if quiz already exists\r\n  const { data: existingQuiz, error: fetchQuizError } = await supabase\r\n    .from('quizzes')\r\n    .select('id')\r\n    .eq('lesson_id', lessonId)\r\n    .maybeSingle();\r\n\r\n  if (fetchQuizError) {\r\n    console.error('upsertQuiz: Error checking existing quiz:', fetchQuizError);\r\n    throw fetchQuizError;\r\n  }\r\n\r\n  let quizId: string;\r\n\r\n  if (existingQuiz) {\r\n    // Update existing quiz\r\n    const { error: updateQuizError } = await supabase\r\n      .from('quizzes')\r\n      .update({\r\n        title: quizData.title,\r\n        description: quizData.description,\r\n        is_active: quizData.is_active,\r\n        updated_at: new Date().toISOString()\r\n      })\r\n      .eq('id', existingQuiz.id);\r\n\r\n    if (updateQuizError) {\r\n      console.error('upsertQuiz: Error updating quiz:', updateQuizError);\r\n      throw updateQuizError;\r\n    }\r\n    quizId = existingQuiz.id;\r\n  } else {\r\n    // Insert new quiz\r\n    const { data: newQuiz, error: insertQuizError } = await supabase\r\n      .from('quizzes')\r\n      .insert({\r\n        lesson_id: lessonId,\r\n        title: quizData.title,\r\n        description: quizData.description,\r\n        is_active: quizData.is_active\r\n      })\r\n      .select('id')\r\n      .single();\r\n\r\n    if (insertQuizError) {\r\n      console.error('upsertQuiz: Error inserting quiz:', insertQuizError);\r\n      throw insertQuizError;\r\n    }\r\n    quizId = newQuiz.id;\r\n  }\r\n\r\n  // Process questions\r\n  const questionIdMap: Record<string, string> = {};\r\n  for (const question of quizData.questions) {\r\n    let questionId: string;\r\n    const shouldUpdate = isUuid(question.id);\r\n\r\n    if (shouldUpdate && question.id) {\r\n      // Update existing question\r\n      console.log(`upsertQuiz: updating question (uuid ${question.id})`);\r\n      const { error: updateQuestionError } = await supabase\r\n        .from('quiz_questions')\r\n        .update({\r\n          question_text: question.question_text,\r\n          question_type: question.question_type,\r\n          is_required: question.is_required,\r\n          order_index: question.order_index,\r\n          updated_at: new Date().toISOString()\r\n        })\r\n        .eq('id', question.id);\r\n\r\n      if (updateQuestionError) {\r\n        console.error('upsertQuiz: update quiz_questions failed:', updateQuestionError);\r\n        throw updateQuestionError;\r\n      }\r\n      questionId = question.id;\r\n    } else {\r\n      // Insert new question\r\n      console.log(`upsertQuiz: inserting question (temp id ${question.id || 'undefined'})`);\r\n      const { data: newQuestion, error: insertQuestionError } = await supabase\r\n        .from('quiz_questions')\r\n        .insert({\r\n          lesson_id: lessonId,\r\n          question_text: question.question_text,\r\n          question_type: question.question_type,\r\n          is_required: question.is_required,\r\n          order_index: question.order_index\r\n        })\r\n        .select('id')\r\n        .single();\r\n\r\n      if (insertQuestionError) {\r\n        console.error('upsertQuiz: insert quiz_questions failed:', insertQuestionError);\r\n        throw insertQuestionError;\r\n      }\r\n      questionId = newQuestion.id;\r\n    }\r\n\r\n    // Map the temporary question ID to the real question ID\r\n    if (question.id && !shouldUpdate) {\r\n      questionIdMap[question.id] = questionId;\r\n    }\r\n\r\n    // Process options for this question (only for multiple choice)\r\n    if (question.question_type === 'multiple_choice' && question.options) {\r\n      // Replace all options strategy: delete all existing options first\r\n      console.log(`upsertQuiz: replacing options for question ${questionId}`);\r\n      const { error: deleteOptionsError } = await supabase\r\n        .from('quiz_options')\r\n        .delete()\r\n        .eq('question_id', questionId);\r\n\r\n      if (deleteOptionsError) {\r\n        console.error('upsertQuiz: delete quiz_options failed:', deleteOptionsError);\r\n        throw deleteOptionsError;\r\n      }\r\n\r\n      // Insert all current options fresh\r\n      for (const [index, option] of question.options.entries()) {\r\n        console.log(`upsertQuiz: inserting option ${index + 1} for question ${questionId}`);\r\n        const { error: insertOptionError } = await supabase\r\n          .from('quiz_options')\r\n          .insert({\r\n            question_id: questionId,\r\n            option_text: option.option_text,\r\n            is_correct: option.is_correct,\r\n            order_index: index\r\n          });\r\n\r\n        if (insertOptionError) {\r\n          console.error('upsertQuiz: insert quiz_options failed:', insertOptionError);\r\n          throw insertOptionError;\r\n        }\r\n      }\r\n    } else if (question.question_type === 'multiple_choice') {\r\n      // If it's multiple choice but no options provided, delete existing options\r\n      console.log(`upsertQuiz: deleting all options for question ${questionId} (no options provided)`);\r\n      const { error: deleteAllOptionsError } = await supabase\r\n        .from('quiz_options')\r\n        .delete()\r\n        .eq('question_id', questionId);\r\n\r\n      if (deleteAllOptionsError) {\r\n        console.error('upsertQuiz: delete all quiz_options failed:', deleteAllOptionsError);\r\n        throw deleteAllOptionsError;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Clean up deleted questions (if any)\r\n  console.log('upsertQuiz: Cleaning up questions for lesson:', lessonId);\r\n  console.log('upsertQuiz: Quiz data questions:', quizData.questions.map(q => ({\r\n    id: q.id,\r\n    isUuid: isUuid(q.id),\r\n    text: q.question_text?.substring(0, 30) + '...'\r\n  })));\r\n  \r\n  // Only clean up if there are existing questions to preserve\r\n  if (quizData.questions.length > 0) {\r\n    const existingQuestionIds = quizData.questions\r\n      .filter(q => isUuid(q.id)) // Only include real UUIDs, not temporary IDs\r\n      .map(q => q.id as string);\r\n    \r\n    console.log('upsertQuiz: Existing question IDs to preserve:', existingQuestionIds);\r\n    \r\n    if (existingQuestionIds.length > 0) {\r\n      console.log('upsertQuiz: Deleting questions NOT in:', existingQuestionIds);\r\n      const { error: deleteQuestionsError } = await supabase\r\n        .from('quiz_questions')\r\n        .delete()\r\n        .eq('lesson_id', lessonId)\r\n        .not('id', 'in', `(${existingQuestionIds.join(',')})`);\r\n\r\n      if (deleteQuestionsError) {\r\n        console.error('upsertQuiz: Error deleting questions:', deleteQuestionsError);\r\n      }\r\n    } else {\r\n      // If no existing questions to preserve, this means ALL questions are new\r\n      // So we should NOT delete anything - all questions are meant to be kept\r\n      console.log('upsertQuiz: All questions are new (temporary IDs), preserving all');\r\n    }\r\n  } else {\r\n    // If no questions remain, delete all questions for this lesson\r\n    console.log('upsertQuiz: No questions in quiz data, deleting all questions for lesson');\r\n    const { error: deleteAllQuestionsError } = await supabase\r\n      .from('quiz_questions')\r\n      .delete()\r\n      .eq('lesson_id', lessonId);\r\n\r\n    if (deleteAllQuestionsError) {\r\n      console.error('upsertQuiz: Error deleting all questions:', deleteAllQuestionsError);\r\n    }\r\n  }\r\n\r\n  console.log('upsertQuiz: Successfully upserted quiz for lesson:', lessonId);\r\n};\r\n\r\n// Submit quiz answers\r\nexport const submitQuizAnswers = async (\r\n  userId: string,\r\n  lessonId: string,\r\n  answers: {\r\n    question_id: string;\r\n    selected_option_id?: string; // For multiple choice\r\n    answer_text?: string; // For short answer\r\n  }[]\r\n): Promise<{ score: number; total: number }> => {\r\n  console.log('submitQuizAnswers: Submitting answers for user:', userId, 'lesson:', lessonId);\r\n\r\n  // First, get the quiz questions with correct answers\r\n  const quiz = await getQuizByLessonId(lessonId);\r\n  if (!quiz) {\r\n    throw new Error('Quiz not found for this lesson');\r\n  }\r\n\r\n  // Create a new submission\r\n  const { data: submission, error: submissionError } = await supabase\r\n    .from('quiz_submissions')\r\n    .insert({\r\n      user_id: userId,\r\n      lesson_id: lessonId,\r\n      score: 0, // Will update after grading\r\n      total_questions: quiz.questions.length\r\n    })\r\n    .select('id')\r\n    .single();\r\n\r\n  if (submissionError) {\r\n    console.error('submitQuizAnswers: Error creating submission:', submissionError);\r\n    throw submissionError;\r\n  }\r\n\r\n  let correctAnswers = 0;\r\n\r\n  // Process each answer\r\n  for (const answer of answers) {\r\n    const question = quiz.questions.find(q => q.id === answer.question_id);\r\n    if (!question) {\r\n      continue; // Skip if question doesn't exist\r\n    }\r\n\r\n    let isCorrect = false;\r\n\r\n    if (question.question_type === 'multiple_choice') {\r\n      // For multiple choice, check if the selected option is correct\r\n      if (answer.selected_option_id) {\r\n        const selectedOption = question.options?.find(opt => opt.id === answer.selected_option_id);\r\n        if (selectedOption?.is_correct) {\r\n          isCorrect = true;\r\n          correctAnswers++;\r\n        }\r\n      }\r\n    } else if (question.question_type === 'short_answer') {\r\n      // For short answer, we'll just save the answer and let instructors grade manually\r\n      // For now, we'll mark it as correct if an answer was provided\r\n      if (answer.answer_text && answer.answer_text.trim().length > 0) {\r\n        isCorrect = true;\r\n        correctAnswers++;\r\n      }\r\n    }\r\n\r\n    // Save the answer\r\n    const { error: answerError } = await supabase\r\n      .from('quiz_answers')\r\n      .insert({\r\n        submission_id: submission.id,\r\n        question_id: answer.question_id,\r\n        selected_option_id: answer.selected_option_id,\r\n        answer_text: answer.answer_text,\r\n        is_correct: isCorrect\r\n      });\r\n\r\n    if (answerError) {\r\n      console.error('submitQuizAnswers: Error saving answer:', answerError);\r\n      throw answerError;\r\n    }\r\n  }\r\n\r\n  // Update the submission with the final score\r\n  const finalScore = Math.round((correctAnswers / quiz.questions.length) * 100);\r\n  const { error: updateScoreError } = await supabase\r\n    .from('quiz_submissions')\r\n    .update({\r\n      score: finalScore,\r\n      completed_at: new Date().toISOString()\r\n    })\r\n    .eq('id', submission.id);\r\n\r\n  if (updateScoreError) {\r\n    console.error('submitQuizAnswers: Error updating score:', updateScoreError);\r\n    throw updateScoreError;\r\n  }\r\n\r\n  console.log('submitQuizAnswers: Successfully submitted answers for user:', userId, 'lesson:', lessonId, 'score:', finalScore);\r\n\r\n  return {\r\n    score: finalScore,\r\n    total: quiz.questions.length\r\n  };\r\n};\r\n\r\n// Get user's quiz submission for a lesson\r\nexport const getUserQuizSubmission = async (userId: string, lessonId: string) => {\r\n  console.log('getUserQuizSubmission: Fetching submission for user:', userId, 'lesson:', lessonId);\r\n\r\n  const { data, error } = await supabase\r\n    .from('quiz_submissions')\r\n    .select('*')\r\n    .eq('user_id', userId)\r\n    .eq('lesson_id', lessonId)\r\n    .order('created_at', { ascending: false })\r\n    .limit(1)\r\n    .maybeSingle();\r\n\r\n  if (error) {\r\n    console.error('getUserQuizSubmission: Error fetching submission:', error);\r\n    throw error;\r\n  }\r\n\r\n  return data;\r\n};\r\n\r\n// Get quiz submission by lesson ID for a user\r\nexport const getQuizSubmissionByLessonId = async (userId: string, lessonId: string) => {\r\n  console.log('getQuizSubmissionByLessonId: Fetching submission for user:', userId, 'lesson:', lessonId);\r\n\r\n  const { data, error } = await supabase\r\n    .from('quiz_submissions')\r\n    .select('*')\r\n    .eq('user_id', userId)\r\n    .eq('lesson_id', lessonId)\r\n    .order('created_at', { ascending: false })\r\n    .limit(1)\r\n    .maybeSingle();\r\n\r\n  if (error) {\r\n    console.error('getQuizSubmissionByLessonId: Error fetching submission:', error);\r\n    throw error;\r\n  }\r\n\r\n  return data;\r\n};","'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useAuthStore } from '@/context/AuthContext';\r\nimport { QuizWithQuestions } from '@/types/quiz';\r\nimport { submitQuizAnswers, getUserQuizSubmission } from '@/services/quizService';\r\nimport { QuizQuestion } from './QuizQuestion';\r\n\r\ninterface QuizComponentProps {\r\n  lessonId: string;\r\n  quiz: QuizWithQuestions;\r\n  onComplete?: (passed: boolean) => void;\r\n}\r\n\r\nexport const QuizComponent = ({ lessonId, quiz, onComplete }: QuizComponentProps) => {\r\n  const { state } = useAuthStore();\r\n  const user = state.user;\r\n  \r\n  const [answers, setAnswers] = useState<Record<string, string>>({});\r\n  const [isSubmitted, setIsSubmitted] = useState(false);\r\n  const [score, setScore] = useState<number | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n\r\n  // Check if user has already submitted this quiz\r\n  useEffect(() => {\r\n    const checkExistingSubmission = async () => {\r\n      if (!user) return;\r\n      \r\n      try {\r\n        const existingSubmission = await getUserQuizSubmission(user.id, lessonId);\r\n        if (existingSubmission) {\r\n          setScore(existingSubmission.score);\r\n          setIsSubmitted(true);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error checking existing submission:', error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    checkExistingSubmission();\r\n  }, [user, lessonId]);\r\n\r\n  const handleAnswer = (questionId: string, answer: string | string[]) => {\r\n    // Normalize answer to always be a string\r\n    const normalizedAnswer = typeof answer === 'string' ? answer : (answer[0] ?? '');\r\n    setAnswers(prev => ({\r\n      ...prev,\r\n      [questionId]: normalizedAnswer\r\n    }));\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    if (!user) {\r\n      alert('Please log in to submit the quiz');\r\n      return;\r\n    }\r\n\r\n    // Validate that all required questions are answered\r\n    for (const question of quiz.questions) {\r\n      if (question.is_required && !answers[question.id]) {\r\n        alert(`Please answer the required question: \"${question.question_text}\"`);\r\n        return;\r\n      }\r\n    }\r\n\r\n    try {\r\n      const answerArray = quiz.questions.map(question => ({\r\n        question_id: question.id,\r\n        ...(question.question_type === 'multiple_choice'\r\n          ? { selected_option_id: answers[question.id] as string }\r\n          : { answer_text: answers[question.id] as string })\r\n      }));\r\n\r\n      const result = await submitQuizAnswers(user.id, lessonId, answerArray);\r\n      \r\n      setScore(result.score);\r\n      setIsSubmitted(true);\r\n      \r\n      // Check if user passed the quiz (assuming 70% is passing)\r\n      const quizPassed = result.score >= 70;\r\n      if (onComplete) {\r\n        onComplete(quizPassed);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error submitting quiz:', error);\r\n      alert('Error submitting quiz. Please try again.');\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"mt-8 p-6 bg-card-bg rounded-lg border border-card-border\">\r\n        <div className=\"text-center py-8\">\r\n          <div className=\"text-lg text-gray-400\">Loading quiz...</div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (isSubmitted) {\r\n    return (\r\n      <div className=\"mt-8 p-6 bg-card-bg rounded-lg border border-card-border\">\r\n        <div className=\"text-center mb-6\">\r\n          <div className=\"text-2xl font-bold text-white mb-2\">\r\n            Quiz Complete!\r\n          </div>\r\n          <div className=\"text-3xl font-bold text-accent-primary mb-2\">\r\n            Score: {score}%\r\n          </div>\r\n          <div className=\"text-gray-400\">\r\n            You've completed this lesson's quiz.\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"space-y-6\">\r\n          {quiz.questions.map((question) => (\r\n            <QuizQuestion\r\n              key={question.id}\r\n              question={question}\r\n              onAnswer={handleAnswer}\r\n              selectedAnswer={answers[question.id] ?? ''}\r\n              isSubmitted={true}\r\n            />\r\n          ))}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"mt-8 p-6 bg-card-bg rounded-lg border border-card-border\">\r\n      <div className=\"mb-6\">\r\n        <h3 className=\"text-xl font-bold text-white mb-2\">{quiz.title}</h3>\r\n        <p className=\"text-gray-400\">{quiz.description}</p>\r\n      </div>\r\n      \r\n      <div className=\"space-y-6\">\r\n        {quiz.questions.map((question) => (\r\n          <QuizQuestion\r\n            key={question.id}\r\n            question={question}\r\n            onAnswer={handleAnswer}\r\n            selectedAnswer={answers[question.id] ?? ''}\r\n            isSubmitted={false}\r\n          />\r\n        ))}\r\n      </div>\r\n      \r\n      <div className=\"mt-8 flex flex-col sm:flex-row gap-4 justify-center\">\r\n        <button\r\n          onClick={handleSubmit}\r\n          className=\"px-8 py-3 bg-accent-primary text-white font-bold rounded-lg hover:bg-accent-primary/90 transition-colors text-lg hover-lift border border-accent-primary\"\r\n        >\r\n          Submit Quiz\r\n        </button>\r\n        <button\r\n          onClick={() => {\r\n            // Allow user to retake the quiz\r\n            setIsSubmitted(false);\r\n            setScore(null);\r\n          }}\r\n          className=\"px-8 py-3 bg-gray-700 text-white font-bold rounded-lg hover:bg-gray-600 transition-colors text-lg hover-lift\"\r\n        >\r\n          Retake Quiz\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};","\"use client\";\n\nimport { useState, useEffect } from 'react';\nimport { useAuthStore } from '@/context/AuthContext';\nimport { upsertLessonReview, getMyLessonReview } from '@/services/lessonReviewService';\n\nexport const LessonReviewForm = ({ lessonId }: { lessonId: string }) => {\n  const { state } = useAuthStore();\n  const user = state.user;\n  const [rating, setRating] = useState<number>(0);\n  const [comment, setComment] = useState<string>('');\n  const [isAnonymous, setIsAnonymous] = useState<boolean>(false);\n  const [loading, setLoading] = useState<boolean>(false);\n  const [existingReview, setExistingReview] = useState<any>(null);\n  const [message, setMessage] = useState<string>('');\n\n  useEffect(() => {\n    const init = async () => {\n      if (!user) return;\n      try {\n        setLoading(true);\n        const myReview = await getMyLessonReview(user.id, lessonId);\n        if (myReview) {\n          setExistingReview(myReview);\n          setRating(myReview.rating);\n          setComment(myReview.comment || '');\n          setIsAnonymous(!!myReview.is_anonymous);\n        }\n      } catch (err) {\n        console.error('LessonReviewForm: failed to load existing review', err);\n      } finally {\n        setLoading(false);\n      }\n    };\n    init();\n  }, [user, lessonId]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!user) return;\n    if (rating < 1 || rating > 5) {\n      setMessage('Please choose a rating between 1 and 5.');\n      return;\n    }\n    try {\n      setLoading(true);\n      await upsertLessonReview(user.id, lessonId, { rating, comment, is_anonymous: isAnonymous });\n      setMessage(existingReview ? 'Your feedback has been updated. Thank you!' : 'Thanks for your feedback — it helps us improve!');\n      setExistingReview({ rating, comment, is_anonymous: isAnonymous });\n      console.log('LessonReviewForm: review submitted', { lessonId, rating, isAnonymous });\n    } catch (err: any) {\n      console.error('LessonReviewForm: submission error', err);\n      setMessage(err?.message || 'Something went wrong. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"mt-8 p-6 bg-card-bg rounded-lg border border-card-border\">\n      <h3 className=\"text-xl font-semibold text-white mb-2\">Help us improve this lesson</h3>\n      <p className=\"text-gray-400 mb-4\">Your feedback is private and only visible to the VibeSchool team.</p>\n\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\n        <div>\n          <label className=\"block text-gray-300 mb-2\">Rate this lesson</label>\n          <div className=\"flex items-center gap-2\">\n            {[1,2,3,4,5].map((star) => (\n              <button\n                key={star}\n                type=\"button\"\n                onClick={() => setRating(star)}\n                className={`p-2 rounded ${rating >= star ? 'text-yellow-400' : 'text-gray-500'} hover:text-yellow-300`}\n                aria-label={`Rate ${star} star${star>1?'s':''}`}\n              >\n                {/* Simple star using SVG to avoid extra deps */}\n                <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" className=\"w-6 h-6\">\n                  <path d=\"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.62L12 2 9.19 8.62 2 9.24l5.46 4.73L5.82 21z\" />\n                </svg>\n              </button>\n            ))}\n          </div>\n          <p className=\"text-gray-500 text-sm mt-1\">Choose between 1 and 5 stars.</p>\n        </div>\n\n        <div>\n          <label className=\"block text-gray-300 mb-2\">What did you like or find confusing?</label>\n          <textarea\n            value={comment}\n            onChange={(e) => setComment(e.target.value)}\n            rows={4}\n            placeholder=\"Optional\"\n            className=\"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-md text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-accent-primary\"\n          />\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <input\n            id=\"anonymous\"\n            type=\"checkbox\"\n            checked={isAnonymous}\n            onChange={(e) => setIsAnonymous(e.target.checked)}\n            className=\"h-4 w-4 text-accent-primary focus:ring-accent-primary border-gray-700 bg-gray-800\"\n          />\n          <label htmlFor=\"anonymous\" className=\"text-gray-300\">Submit anonymously</label>\n        </div>\n\n        <div className=\"flex items-center gap-3\">\n          <button\n            type=\"submit\"\n            disabled={loading || rating === 0}\n            className={`px-4 py-2 rounded font-medium transition-colors hover-lift border ${loading || rating===0 ? 'bg-gray-700 text-gray-400 border-gray-700' : 'bg-accent-primary text-white hover:bg-accent-primary/90 border-accent-primary'}`}\n          >\n            {existingReview ? 'Update Feedback' : 'Submit Feedback'}\n          </button>\n          {message && <span className=\"text-gray-300 text-sm\">{message}</span>}\n        </div>\n      </form>\n    </div>\n  );\n};\n\nexport default LessonReviewForm;","'use client';\r\n\r\nimport { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { useParams } from 'next/navigation';\r\nimport { useAuthStore } from '@/context/AuthContext';\r\nimport { supabase } from '@/lib/supabase';\r\nimport { Play, Pause, RotateCcw } from 'lucide-react';\r\nimport ProtectedRoute from '@/components/auth/ProtectedRoute';\r\nimport AppShell from '@/components/layout/AppShell';\r\nimport { getLessonById, checkLessonAccess } from '@/services/courseService';\r\nimport { updateUserLessonProgress, markLessonCompleted, getUserLessonProgress, getNextLesson } from '@/services/courseNavigationService';\r\nimport { getQuizByLessonId, getQuizSubmissionByLessonId } from '@/services/quizService';\r\nimport { QuizComponent } from '@/components/quiz/QuizComponent';\r\nimport { loadYouTubeIFrameAPI, destroyPlayer } from '@/lib/youtube';\r\nimport LessonReviewForm from '@/components/reviews/LessonReviewForm';\r\n\r\ndeclare global {\r\n  interface Window {\r\n    YT: any;\r\n    onYouTubeIframeAPIReady: () => void;\r\n  }\r\n}\r\n\r\nconst LessonPlayer = () => {\r\n  const { lessonId } = useParams<{ lessonId: string }>();\r\n  const { state } = useAuthStore();\r\n  const user = state.user;\r\n  const [lesson, setLesson] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [progress, setProgress] = useState({\r\n    completed: false,\r\n    last_position_seconds: 0\r\n  });\r\n  const [playerReady, setPlayerReady] = useState(false);\r\n  const [isPlaying, setIsPlaying] = useState(false);\r\n  const [canAccess, setCanAccess] = useState(false);\r\n  const [isCheckingAccess, setIsCheckingAccess] = useState(true);\r\n  const [devLogsShown, setDevLogsShown] = useState(false); // For dev diagnostics\r\n  const [quiz, setQuiz] = useState<any>(null);\r\n  const [quizLoading, setQuizLoading] = useState(true);\r\n  const [quizSubmission, setQuizSubmission] = useState<any>(null);\r\n  const [quizPassed, setQuizPassed] = useState(false);\r\n  \r\n  const playerRef = useRef<any>(null);\r\n  const timerRef = useRef<NodeJS.Timeout | null>(null);\r\n  const [playerEl, setPlayerEl] = useState<HTMLDivElement | null>(null);\r\n  const playerElRef = useCallback((node: HTMLDivElement | null) => { \r\n    console.log('YT DEBUG: playerElRef called with node:', !!node);\r\n    setPlayerEl(node);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (user && lessonId) {\r\n      loadLessonData();\r\n    }\r\n  }, [user, lessonId]);\r\n\r\n  const loadLessonData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      \r\n      // Check access first\r\n      const accessResult = await checkLessonAccess(user!.id, lessonId);\r\n      setCanAccess(accessResult.hasAccess);\r\n      setIsCheckingAccess(false);\r\n      \r\n      if (!accessResult.hasAccess) {\r\n        setError('You do not have access to this lesson. Please upgrade to a membership or access a preview lesson.');\r\n        return;\r\n      }\r\n      \r\n      // Get lesson details\r\n      const lessonData = await getLessonById(lessonId);\r\n      setLesson(lessonData);\r\n      \r\n      // Get user progress\r\n      const progressData = await getUserLessonProgress(user!.id, lessonId);\r\n      setProgress(progressData);\r\n      \r\n      // Get quiz for this lesson\r\n      try {\r\n        const lessonQuiz = await getQuizByLessonId(lessonId);\r\n        setQuiz(lessonQuiz);\r\n        \r\n        // Check if user has passed the quiz\r\n        if (lessonQuiz) {\r\n          const submission = await getQuizSubmissionByLessonId(user!.id, lessonId);\r\n          if (submission) {\r\n            setQuizSubmission(submission);\r\n            // Check if the submission meets passing criteria (you can adjust this)\r\n            if (submission.score >= 70) { // Assuming 70% is the passing grade\r\n              setQuizPassed(true);\r\n            }\r\n          }\r\n        }\r\n      } catch (quizErr) {\r\n        console.error('Error loading quiz:', quizErr);\r\n        // Quiz is optional, so we don't set an error\r\n      } finally {\r\n        setQuizLoading(false);\r\n      }\r\n    } catch (err: any) {\r\n      console.error('Error loading lesson:', err);\r\n      setError(err.message || 'Failed to load lesson');\r\n      setQuizLoading(false);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Calculate hasVideo outside useEffect for proper dependency tracking\r\n  const hasVideo = !!(lesson && (\r\n    (lesson.video_provider === 'youtube' && lesson.youtube_video_id) ||\r\n    (lesson.video_url && (lesson.video_url.includes('youtube.com') || lesson.video_url.includes('youtu.be')))\r\n  ));\r\n  \r\n  // Load YouTube API and initialize player when lesson changes\r\n  useEffect(() => {\r\n    console.log('YT DEBUG: useEffect triggered, lesson:', !!lesson, 'hasVideo:', hasVideo, 'playerEl:', !!playerEl);\r\n      \r\n    if (!lesson) return;\r\n      \r\n    // Extract YouTube video ID from URL if needed\r\n    let videoId = lesson.youtube_video_id;\r\n    if (!videoId && lesson.video_url) {\r\n      // Extract video ID from YouTube URL\r\n      const regExp = /(?:youtube\\.com\\/(?:[^\\/]+\\/.+\\/|(?:v|e(?:mbed)?)\\/|.*[?&]v=)|youtu\\.be\\/)([^\"&\\?\\s]{11})/;\r\n      const urlMatch = lesson.video_url.match(regExp);\r\n      if (urlMatch) {\r\n        videoId = urlMatch[1];\r\n      }\r\n    }\r\n  \r\n    if (!videoId) {\r\n      console.log('YT DEBUG: No video ID found');\r\n      return;\r\n    }\r\n  \r\n    if (!playerEl) {\r\n      console.log('YT DEBUG: No player element, waiting for mount');\r\n      return;\r\n    }\r\n  \r\n    console.log('YT DEBUG: Initializing player with video:', videoId);\r\n      \r\n    let cancelled = false;\r\n      \r\n    const initializePlayer = async () => {\r\n      if (cancelled) return;\r\n        \r\n      try {\r\n        console.log('YT: loading API for video:', videoId);\r\n        await loadYouTubeIFrameAPI();\r\n          \r\n        if (cancelled || !playerEl) return;\r\n          \r\n        console.log('YT: creating player for video:', videoId);\r\n          \r\n        // Clean up existing player if any\r\n        if (playerRef.current) {\r\n          destroyPlayer(playerRef.current);\r\n        }\r\n          \r\n        // Create new player\r\n        playerRef.current = new window.YT.Player(playerEl, {\r\n          videoId: videoId,\r\n          width: \"100%\",\r\n          height: \"100%\",\r\n          playerVars: {\r\n            autoplay: 0,\r\n            playsinline: 1,\r\n            modestbranding: 1,\r\n            rel: 0,\r\n            start: 0,\r\n          },\r\n          events: {\r\n            onReady: (event: any) => {\r\n              console.log('YT: onReady fired');\r\n              if (!cancelled) {\r\n                playerRef.current = event.target;\r\n                setPlayerReady(true);\r\n                  \r\n                // Seek to last position after player is ready\r\n                setTimeout(() => {\r\n                  if (progress.last_position_seconds > 0 && !cancelled) {\r\n                    event.target.seekTo(progress.last_position_seconds, true);\r\n                  }\r\n                }, 1000);\r\n              }\r\n            },\r\n            onStateChange: (event: any) => {\r\n              if (cancelled) return;\r\n                \r\n              if (event.data === window.YT.PlayerState.PLAYING) {\r\n                setIsPlaying(true);\r\n              } else if (event.data === window.YT.PlayerState.PAUSED || event.data === window.YT.PlayerState.ENDED) {\r\n                setIsPlaying(false);\r\n                  \r\n                // If video ended, mark as completed\r\n                if (event.data === window.YT.PlayerState.ENDED && !progress.completed) {\r\n                  handleMarkComplete();\r\n                }\r\n              }\r\n            },\r\n            onError: (error: any) => {\r\n              console.error('YT: Player error:', error);\r\n              if (!cancelled) {\r\n                setError(`Video player error: ${error?.data || 'Unknown error'}`);\r\n              }\r\n            }\r\n          },\r\n        });\r\n          \r\n      } catch (error) {\r\n        console.error('YT: Failed to initialize player:', error);\r\n        if (!cancelled) {\r\n          setError(`Failed to load video player: ${(error as Error)?.message || 'Unknown error'}`);\r\n          setPlayerReady(false);\r\n        }\r\n      }\r\n    };\r\n      \r\n    initializePlayer();\r\n      \r\n    // Cleanup function\r\n    return () => {\r\n      cancelled = true;\r\n      if (playerRef.current) {\r\n        destroyPlayer(playerRef.current);\r\n        playerRef.current = null;\r\n      }\r\n      setPlayerReady(false);\r\n    };\r\n  }, [lesson?.id, lesson?.youtube_video_id, playerEl, progress.last_position_seconds]);\r\n\r\n\r\n\r\n  // Handle player ready event\r\n  const onPlayerReady = (event: any) => {\r\n    // Store reference to player\r\n    playerRef.current = event.target;\r\n    setPlayerReady(true);\r\n    \r\n    // Seek to last position after player is ready and has loaded\r\n    setTimeout(() => {\r\n      if (progress.last_position_seconds > 0) {\r\n        event.target.seekTo(progress.last_position_seconds, true);\r\n      }\r\n    }, 1000); // Wait a bit for player to be fully ready\r\n  };\r\n\r\n  // Handle player state change event\r\n  const onPlayerStateChange = (event: any) => {\r\n    if (event.data === window.YT.PlayerState.PLAYING) { // PLAYING\r\n      setIsPlaying(true);\r\n    } else if (event.data === window.YT.PlayerState.PAUSED || event.data === window.YT.PlayerState.ENDED) { // PAUSED or ENDED\r\n      setIsPlaying(false);\r\n      \r\n      // If video ended, mark as completed\r\n      if (event.data === window.YT.PlayerState.ENDED && !progress.completed) {\r\n        handleMarkComplete();\r\n      }\r\n    }\r\n  };\r\n\r\n  // Handle video progress updates\r\n  useEffect(() => {\r\n    // Update progress every 5 seconds while playing\r\n    if (isPlaying && playerRef.current) {\r\n      if (timerRef.current) {\r\n        clearInterval(timerRef.current);\r\n      }\r\n      \r\n      timerRef.current = setInterval(async () => {\r\n        try {\r\n          const currentTime = playerRef.current?.getCurrentTime();\r\n          if (currentTime !== undefined) {\r\n            await updateUserLessonProgress(user!.id, lessonId, {\r\n              last_position_seconds: Math.floor(currentTime)\r\n            });\r\n          }\r\n        } catch (err) {\r\n          console.error('Error updating progress:', err);\r\n        }\r\n      }, 5000); // Update every 5 seconds\r\n    }\r\n    \r\n    return () => {\r\n      if (timerRef.current) {\r\n        clearInterval(timerRef.current);\r\n      }\r\n    };\r\n  }, [isPlaying, user, lessonId]);\r\n\r\n  const handleMarkComplete = async () => {\r\n    try {\r\n      await updateUserLessonProgress(user!.id, lessonId, {\r\n        completed: true,\r\n        completed_at: new Date().toISOString()\r\n      });\r\n      \r\n      setProgress(prev => ({ ...prev, completed: true }));\r\n    } catch (err) {\r\n      console.error('Error marking lesson as complete:', err);\r\n    }\r\n  };\r\n\r\n  const handleRestart = () => {\r\n    if (playerRef.current) {\r\n      playerRef.current.seekTo(0, true);\r\n      playerRef.current.playVideo();\r\n    }\r\n  };\r\n\r\n  const handleNextLesson = async () => {\r\n    if (!lesson || !user) return;\r\n    \r\n    try {\r\n      // Find the course ID from the lesson data\r\n      const courseId = lesson.modules?.course_id;\r\n      if (!courseId) {\r\n        console.error('Could not find course ID for lesson');\r\n        return;\r\n      }\r\n      \r\n      // Get the next lesson in the course\r\n      const nextLesson = await getNextLesson(user.id, courseId);\r\n      \r\n      if (nextLesson) {\r\n        // Navigate to the next lesson\r\n        window.location.href = `/learn/${nextLesson.id}`;\r\n      } else {\r\n        // If no next lesson, show a message or navigate back to course\r\n        alert('Congratulations! You have completed all lessons in this course.');\r\n        window.location.href = `/courses/${courseId}`;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error getting next lesson:', error);\r\n      // Fallback to course page\r\n      const courseId = lesson.modules?.course_id;\r\n      if (courseId) {\r\n        window.location.href = `/courses/${courseId}`;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (loading || isCheckingAccess) {\r\n    return (\r\n      <ProtectedRoute>\r\n        <AppShell>\r\n          <div className=\"container mx-auto px-4 py-8\">\r\n            <p className=\"text-gray-400\">Loading lesson...</p>\r\n          </div>\r\n        </AppShell>\r\n      </ProtectedRoute>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <ProtectedRoute>\r\n        <AppShell>\r\n          <div className=\"container mx-auto px-4 py-8\">\r\n            <div className=\"bg-red-900/20 border border-red-700 rounded-lg p-4\">\r\n              <h2 className=\"text-red-300 font-bold mb-2\">Error Loading Lesson</h2>\r\n              <p className=\"text-red-400\">{error}</p>\r\n              <button \r\n                onClick={() => window.history.back()} \r\n                className=\"mt-4 px-4 py-2 bg-red-700 text-white rounded hover:bg-red-600 hover-lift\"\r\n              >\r\n                Go Back\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </AppShell>\r\n      </ProtectedRoute>\r\n    );\r\n  }\r\n\r\n  if (!canAccess) {\r\n    return (\r\n      <ProtectedRoute>\r\n        <AppShell>\r\n          <div className=\"container mx-auto px-4 py-8\">\r\n            <div className=\"bg-yellow-900/20 border border-yellow-700 rounded-lg p-4\">\r\n              <h2 className=\"text-yellow-300 font-bold mb-2\">Access Restricted</h2>\r\n              <p className=\"text-yellow-400\">You need a membership to access this lesson.</p>\r\n              <p className=\"text-yellow-400 mt-2\">Preview lessons are available for free, but full content requires a membership.</p>\r\n              <button \r\n                onClick={() => window.location.href = '/courses'}\r\n                className=\"mt-4 px-4 py-2 bg-accent-primary text-white rounded hover:bg-accent-primary/90 hover-lift border border-accent-primary\"\r\n              >\r\n                Browse Courses\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </AppShell>\r\n      </ProtectedRoute>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <ProtectedRoute>\r\n      <AppShell>\r\n        <div className=\"container mx-auto px-4 py-8\">\r\n          <div className=\"mb-6\">\r\n            <h1 className=\"text-2xl font-bold text-white\">{lesson?.title}</h1>\r\n            <p className=\"text-gray-400\">{lesson?.modules?.courses?.title} • {lesson?.modules?.title}</p>\r\n          </div>\r\n          \r\n          {/* Refresh notification for video loading issues */}\r\n          <div className=\"mb-6 bg-blue-900/20 border border-blue-700 rounded-lg p-4\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <div className=\"flex-shrink-0 mt-0.5\">\r\n                <svg className=\"w-5 h-5 text-blue-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                  <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\r\n                </svg>\r\n              </div>\r\n              <div>\r\n                <h3 className=\"text-blue-300 font-medium\">Video Loading Tip</h3>\r\n                <p className=\"text-blue-400 text-sm mt-1\">\r\n                  If the video doesn't load, please refresh the page. Some videos may take a moment to load or require a page refresh to display properly.\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"bg-black rounded-lg overflow-hidden mb-6 relative\">\r\n            <div \r\n              ref={playerElRef}\r\n              data-yt-container\r\n              className=\"w-full aspect-video rounded-lg overflow-hidden bg-black\"\r\n            />\r\n            \r\n            {/* Loading overlay */}\r\n            {!playerReady && hasVideo && (\r\n              <div className=\"absolute inset-0 bg-black/80 flex items-center justify-center\">\r\n                <div className=\"text-center\">\r\n                  <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-primary mx-auto mb-4\"></div>\r\n                  <p className=\"text-white\">Loading video player...</p>\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {/* Video not configured placeholder */}\r\n            {!hasVideo && (\r\n              <div className=\"absolute inset-0 w-full aspect-video bg-gray-900 flex items-center justify-center text-gray-400\">\r\n                <div className=\"text-center\">\r\n                  <p>Video not configured</p>\r\n                  <p className=\"text-sm mt-2\">Lesson ID: {lesson?.id}</p>\r\n                  <p className=\"text-xs mt-1\">Video provider: {lesson?.video_provider}</p>\r\n                  <p className=\"text-xs mt-1\">YouTube ID: {lesson?.youtube_video_id}</p>\r\n                  <p className=\"text-xs mt-1\">Video URL: {lesson?.video_url}</p>\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {/* Debug info in development */}\r\n            {process.env.NODE_ENV === 'development' && !playerEl && (\r\n              <div className=\"absolute top-2 left-2 bg-red-500 text-white text-xs p-1 rounded\">\r\n                YT container not mounted\r\n              </div>\r\n            )}\r\n            \r\n            <div className=\"p-4 bg-gray-900 flex justify-between items-center\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <button \r\n                  onClick={handleRestart}\r\n                  className=\"flex items-center gap-2 px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-600 hover-lift\"\r\n                >\r\n                  <RotateCcw size={16} />\r\n                  Restart\r\n                </button>\r\n                \r\n                <div className=\"text-sm text-gray-300\">\r\n                  {progress.completed ? (\r\n                    <span className=\"text-green-500\">✓ Completed</span>\r\n                  ) : (\r\n                    <span>Resume from {Math.floor(progress.last_position_seconds / 60)}:{String(Math.floor(progress.last_position_seconds % 60)).padStart(2, '0')}</span>\r\n                  )}\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"flex gap-2\">\r\n                <button\r\n                  onClick={handleMarkComplete}\r\n                  disabled={progress.completed}\r\n                  className={`px-4 py-2 rounded hover-lift ${\r\n                    progress.completed \r\n                      ? 'bg-green-800 text-green-300' \r\n                      : 'bg-accent-primary text-white hover:bg-accent-primary/90 border border-accent-primary'\r\n                  }`}\r\n                >\r\n                  {progress.completed ? '✓ Completed' : 'Mark as Complete'}\r\n                </button>\r\n                {quiz && !quizPassed && (\r\n                  <button\r\n                    onClick={() => {\r\n                      // Scroll to the quiz section\r\n                      const quizSection = document.querySelector('#quiz-section');\r\n                      if (quizSection) {\r\n                        quizSection.scrollIntoView({ behavior: 'smooth' });\r\n                      }\r\n                    }}\r\n                    className=\"px-4 py-2 rounded hover-lift bg-purple-600 text-white hover:bg-purple-500\"\r\n                  >\r\n                    Take Quiz\r\n                  </button>\r\n                )}\r\n                {quizPassed && (\r\n                  <button\r\n                    onClick={handleNextLesson}\r\n                    className=\"px-4 py-2 rounded hover-lift bg-blue-600 text-white hover:bg-blue-500\"\r\n                  >\r\n                    Next Lesson →\r\n                  </button>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"prose prose-invert max-w-none\">\r\n            <p className=\"text-gray-300\">{lesson?.description}</p>\r\n          </div>\r\n\r\n          {/* Lesson Review Form: under description, above quiz */}\r\n          <LessonReviewForm lessonId={lessonId} />\r\n\r\n          {/* Quiz section */}\r\n          {!quizLoading && quiz && (\r\n            <div id=\"quiz-section\">\r\n              <QuizComponent \r\n                lessonId={lessonId} \r\n                quiz={quiz} \r\n                onComplete={(passed) => {\r\n                  setQuizPassed(passed);\r\n                  if (passed) {\r\n                    // Mark lesson as completed when quiz is passed\r\n                    handleMarkComplete();\r\n                  }\r\n                }}\r\n              />\r\n              {!quizPassed && (\r\n                <div className=\"mt-4 p-4 bg-yellow-900/20 border border-yellow-700 rounded-lg\">\r\n                  <p className=\"text-yellow-300\">⚠️ Complete the quiz to unlock the next lesson.</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n          \r\n          {quizLoading && (\r\n            <div className=\"mt-8 p-6 bg-card-bg rounded-lg border border-card-border\">\r\n              <div className=\"text-center py-8\">\r\n                <div className=\"text-lg text-gray-400\">Loading quiz...</div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </AppShell>\r\n    </ProtectedRoute>\r\n  );\r\n};\r\n\r\nexport default LessonPlayer;","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8', key: '1357e3' }],\n  ['path', { d: 'M3 3v5h5', key: '1xhq8a' }],\n];\n\n/**\n * @component @name RotateCcw\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMyAxMmE5IDkgMCAxIDAgOS05IDkuNzUgOS43NSAwIDAgMC02Ljc0IDIuNzRMMyA4IiAvPgogIDxwYXRoIGQ9Ik0zIDN2NWg1IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/rotate-ccw\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst RotateCcw = createLucideIcon('rotate-ccw', __iconNode);\n\nexport default RotateCcw;\n","import { useState } from 'react';\r\nimport { QuizQuestion as QuizQuestionType, QuizOption } from '@/types/quiz';\r\n\r\ninterface QuizQuestionProps {\r\n  question: QuizQuestionType & {\r\n    options?: QuizOption[];\r\n  };\r\n  onAnswer: (questionId: string, answer: string | string[]) => void;\r\n  selectedAnswer?: string | string[];\r\n  isSubmitted?: boolean;\r\n}\r\n\r\nexport const QuizQuestion = ({ \r\n  question, \r\n  onAnswer, \r\n  selectedAnswer, \r\n  isSubmitted \r\n}: QuizQuestionProps) => {\r\n  const [shortAnswer, setShortAnswer] = useState<string>(\r\n    typeof selectedAnswer === 'string' ? selectedAnswer : ''\r\n  );\r\n\r\n  const handleMultipleChoiceChange = (optionId: string) => {\r\n    if (!isSubmitted) {\r\n      onAnswer(question.id, optionId);\r\n    }\r\n  };\r\n\r\n  const handleShortAnswerChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n    if (!isSubmitted) {\r\n      const value = e.target.value;\r\n      setShortAnswer(value);\r\n      onAnswer(question.id, value);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"mb-8 p-6 bg-card-bg rounded-lg border border-card-border\">\r\n      <div className=\"flex items-start gap-3 mb-4\">\r\n        <div className=\"flex-shrink-0 mt-1\">\r\n          <div className=\"w-6 h-6 rounded-full bg-accent-primary/20 flex items-center justify-center\">\r\n            <span className=\"text-xs font-bold text-accent-primary\">{question.order_index + 1}</span>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex-1\">\r\n          <h3 className=\"font-medium text-white text-lg mb-3\">{question.question_text}</h3>\r\n          \r\n          {question.question_type === 'multiple_choice' ? (\r\n            <div className=\"space-y-3\">\r\n              {question.options?.map((option) => (\r\n                <div \r\n                  key={option.id}\r\n                  className={`p-3 rounded-lg border cursor-pointer transition-all ${\r\n                    isSubmitted \r\n                      ? option.is_correct \r\n                        ? 'border-green-500 bg-green-900/20' \r\n                        : selectedAnswer === option.id && !option.is_correct\r\n                          ? 'border-red-500 bg-red-900/20'\r\n                          : 'border-card-border'\r\n                      : selectedAnswer === option.id\r\n                        ? 'border-accent-primary bg-accent-primary/10'\r\n                        : 'border-card-border hover:border-accent-primary/50'\r\n                  }`}\r\n                  onClick={() => handleMultipleChoiceChange(option.id)}\r\n                >\r\n                  <div className=\"flex items-center\">\r\n                    <div className={`w-4 h-4 rounded-full border mr-3 flex items-center justify-center ${\r\n                      isSubmitted \r\n                        ? option.is_correct \r\n                          ? 'border-green-500 bg-green-500' \r\n                          : selectedAnswer === option.id && !option.is_correct\r\n                            ? 'border-red-500 bg-red-500'\r\n                            : 'border-gray-500'\r\n                        : selectedAnswer === option.id\r\n                          ? 'border-accent-primary bg-accent-primary'\r\n                          : 'border-gray-500'\r\n                    }`}>\r\n                      {isSubmitted && option.is_correct && (\r\n                        <svg className=\"w-2 h-2 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                          <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\r\n                        </svg>\r\n                      )}\r\n                      {isSubmitted && selectedAnswer === option.id && !option.is_correct && (\r\n                        <svg className=\"w-2 h-2 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                          <path fillRule=\"evenodd\" d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\r\n                        </svg>\r\n                      )}\r\n                    </div>\r\n                    <span className={\r\n                      isSubmitted && option.is_correct \r\n                        ? 'text-green-400' \r\n                        : isSubmitted && selectedAnswer === option.id && !option.is_correct\r\n                          ? 'text-red-400'\r\n                          : 'text-gray-300'\r\n                    }>\r\n                      {option.option_text}\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <div>\r\n              <textarea\r\n                value={isSubmitted ? (selectedAnswer ?? '') : shortAnswer}\r\n                onChange={handleShortAnswerChange}\r\n                disabled={isSubmitted}\r\n                placeholder=\"Type your answer here...\"\r\n                className={`w-full p-3 rounded-lg border bg-card-bg text-white ${\r\n                  isSubmitted \r\n                    ? 'border-gray-600 bg-gray-800/50' \r\n                    : 'border-card-border focus:border-accent-primary focus:ring-1 focus:ring-accent-primary'\r\n                }`}\r\n                rows={4}\r\n              />\r\n              {isSubmitted && selectedAnswer && (\r\n                <div className=\"mt-2 text-sm text-green-400\">\r\n                  ✓ Your answer has been recorded\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n      \r\n      {isSubmitted && question.question_type === 'multiple_choice' && (\r\n        <div className=\"mt-3 text-sm\">\r\n          {selectedAnswer && typeof selectedAnswer === 'string' && !question.options?.some(o => o.id === selectedAnswer) && (\r\n            <div className=\"text-yellow-400\">You didn't select an answer for this question.</div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};","/**\r\n * YouTube IFrame API Loader Utility\r\n * Ensures safe, single-load initialization of YouTube's iframe API\r\n */\r\n\r\n// Extend window interface\r\ndeclare global {\r\n  interface Window {\r\n    YT: any;\r\n    onYouTubeIframeAPIReady: () => void;\r\n    __ytPromise?: Promise<void>;\r\n  }\r\n}\r\n\r\n// Global promise to prevent duplicate API loading\r\nlet ytApiPromise: Promise<void> | null = null;\r\n\r\n/**\r\n * Load the YouTube IFrame API safely\r\n * @returns Promise<void> that resolves when the API is ready\r\n */\r\nexport function loadYouTubeIFrameAPI(timeoutMs = 15000): Promise<void> {\r\n  if (typeof window === \"undefined\") return Promise.resolve();\r\n\r\n  // already ready\r\n  if (window.YT?.Player) return Promise.resolve();\r\n\r\n  // already loading (return same promise)\r\n  if (ytApiPromise) return ytApiPromise;\r\n\r\n  ytApiPromise = new Promise<void>((resolve, reject) => {\r\n    let timeout: any = null;\r\n\r\n    const done = () => {\r\n      if (timeout) clearTimeout(timeout);\r\n      resolve();\r\n    };\r\n\r\n    // if script already loaded but YT not ready yet, poll briefly\r\n    const quickPoll = () => {\r\n      let tries = 0;\r\n      const t = setInterval(() => {\r\n        tries++;\r\n        if (window.YT?.Player) {\r\n          clearInterval(t);\r\n          done();\r\n        } else if (tries > 200) { // ~10s if 50ms interval\r\n          clearInterval(t);\r\n          reject(new Error(\"YT API loaded but Player not available\"));\r\n        }\r\n      }, 50);\r\n    };\r\n\r\n    // set callback BEFORE injecting script\r\n    window.onYouTubeIframeAPIReady = () => done();\r\n\r\n    // inject only once\r\n    const existing = document.querySelector('script[data-yt-iframe-api=\"true\"]') as HTMLScriptElement | null;\r\n    if (!existing) {\r\n      const s = document.createElement(\"script\");\r\n      s.src = \"https://www.youtube.com/iframe_api\";\r\n      s.async = true;\r\n      s.dataset.ytIframeApi = \"true\";\r\n      s.onerror = () => reject(new Error(\"Failed to load YouTube IFrame API script\"));\r\n      document.body.appendChild(s);\r\n    } else {\r\n      // script tag exists already, just wait for Player\r\n      quickPoll();\r\n    }\r\n\r\n    // hard timeout\r\n    timeout = setTimeout(() => {\r\n      reject(new Error(`YT API load timeout after ${timeoutMs}ms`));\r\n    }, timeoutMs);\r\n  }).catch((err) => {\r\n    // allow retries if it failed\r\n    ytApiPromise = null;\r\n    throw err;\r\n  });\r\n\r\n  return ytApiPromise;\r\n}\r\n\r\n/**\r\n * Destroy a YouTube player instance safely\r\n * @param player - YouTube player instance\r\n */\r\nexport const destroyPlayer = (player: any): void => {\r\n  if (player && typeof player.destroy === 'function') {\r\n    try {\r\n      console.log('YT: destroying player');\r\n      player.destroy();\r\n    } catch (error) {\r\n      console.warn('YT: Error destroying player:', error);\r\n    }\r\n  }\r\n};","import { supabase } from '@/lib/supabase';\n\nexport type LessonReview = {\n  id: string;\n  lesson_id: string;\n  user_id: string;\n  rating: number; // 1-5\n  comment: string | null;\n  is_anonymous: boolean;\n  created_at: string;\n  updated_at: string;\n};\n\n// Upsert a lesson review (one per user per lesson)\nexport const upsertLessonReview = async (\n  userId: string,\n  lessonId: string,\n  input: { rating: number; comment?: string; is_anonymous?: boolean }\n): Promise<LessonReview> => {\n  console.log('lessonReviewService.upsertLessonReview: user', userId, 'lesson', lessonId, 'input', input);\n  const { data, error } = await supabase\n    .from('lesson_reviews')\n    .upsert({\n      user_id: userId,\n      lesson_id: lessonId,\n      rating: input.rating,\n      comment: input.comment ?? null,\n      is_anonymous: !!input.is_anonymous,\n      updated_at: new Date().toISOString(),\n    }, { onConflict: 'lesson_id,user_id' })\n    .select()\n    .single();\n\n  if (error) {\n    console.error('lessonReviewService.upsertLessonReview: error', error);\n    throw error;\n  }\n  console.log('lessonReviewService.upsertLessonReview: ok', data?.id);\n  return data as LessonReview;\n};\n\n// Get current user's review for a lesson (students cannot see others' reviews)\nexport const getMyLessonReview = async (userId: string, lessonId: string): Promise<LessonReview | null> => {\n  console.log('lessonReviewService.getMyLessonReview: user', userId, 'lesson', lessonId);\n  const { data, error } = await supabase\n    .from('lesson_reviews')\n    .select('*')\n    .eq('user_id', userId)\n    .eq('lesson_id', lessonId)\n    .maybeSingle();\n\n  if (error) {\n    console.error('lessonReviewService.getMyLessonReview: error', error);\n    throw error;\n  }\n  return data as LessonReview | null;\n};\n\n// Admin-only: fetch lesson reviews with filters\nexport const getLessonReviewsAdmin = async (filters: {\n  lessonId?: string;\n  minRating?: number;\n  maxRating?: number;\n  isAnonymous?: boolean;\n  sort?: 'newest' | 'lowest';\n}) => {\n  console.log('lessonReviewService.getLessonReviewsAdmin: filters', filters);\n  let query = supabase\n    .from('lesson_reviews')\n    .select(`\n      id,\n      lesson_id,\n      rating,\n      comment,\n      is_anonymous,\n      created_at,\n      updated_at,\n      lessons!lesson_reviews_lesson_id_fkey (\n        id,\n        title\n      ),\n      user:profiles!lesson_reviews_user_id_fkey (\n        id,\n        username\n      )\n    `);\n\n  if (filters.lessonId) query = query.eq('lesson_id', filters.lessonId);\n  if (filters.minRating) query = query.gte('rating', filters.minRating);\n  if (filters.maxRating) query = query.lte('rating', filters.maxRating);\n  if (typeof filters.isAnonymous === 'boolean') query = query.eq('is_anonymous', filters.isAnonymous);\n\n  if (filters.sort === 'lowest') {\n    query = query.order('rating', { ascending: true }).order('created_at', { ascending: false });\n  } else {\n    query = query.order('created_at', { ascending: false });\n  }\n\n  const { data, error } = await query;\n  if (error) {\n    console.error('lessonReviewService.getLessonReviewsAdmin: error', error);\n    throw error;\n  }\n\n  // Hide username in result if is_anonymous = true\n  const mapped = (data || []).map((r: any) => ({\n    id: r.id,\n    lesson_id: r.lesson_id,\n    rating: r.rating,\n    comment: r.comment,\n    is_anonymous: r.is_anonymous,\n    created_at: r.created_at,\n    updated_at: r.updated_at,\n    lesson: r.lessons ? { id: r.lessons.id, title: r.lessons.title } : null,\n    user: r.is_anonymous ? null : (r.user ? { id: r.user.id, username: r.user.username } : null),\n  }));\n\n  console.log('lessonReviewService.getLessonReviewsAdmin: returned', mapped.length);\n  return mapped;\n};"],"names":[],"mappings":"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","ignoreList":[4]}