module.exports=[33876,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(56025),e=a.i(10849);let f=async()=>{console.log("getOrCreateGlobalHelpConversation: Starting...");try{let{data:{session:a},error:b}=await e.supabase.auth.getSession();if(b)throw console.error("getOrCreateGlobalHelpConversation: Error getting session:",b),b;if(!a)throw console.error("getOrCreateGlobalHelpConversation: No session found"),Error("No session found");console.log("getOrCreateGlobalHelpConversation: Session token available, calling API...");let c=await fetch("/api/conversations/global-help",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.access_token}`}});if(console.log("getOrCreateGlobalHelpConversation: API response status:",c.status),console.log("getOrCreateGlobalHelpConversation: API response ok:",c.ok),!c.ok){let a,b=await c.text();console.error("getOrCreateGlobalHelpConversation: API response error text:",b);try{a=JSON.parse(b)}catch{a={error:b}}throw Error(a.error||`Failed to get or create global help conversation. Status: ${c.status}`)}let{conversation:d,membershipCreated:f}=await c.json();return console.log("getOrCreateGlobalHelpConversation: Returning conversation:",d),console.log("getOrCreateGlobalHelpConversation: Membership created flag:",f),d}catch(a){throw console.error("getOrCreateGlobalHelpConversation: Error:",a),console.error("getOrCreateGlobalHelpConversation: Error details:",{message:a.message,stack:a.stack}),a}},g=async a=>{console.log("getUserConversations: Fetching conversations for user:",a);let{data:b,error:c}=await e.supabase.from("conversation_members").select("conversation_id").eq("user_id",a);if(c)throw console.error("getUserConversations: Error fetching member data:",c),c;if(!b||0===b.length)return[];let d=b.map(a=>a.conversation_id),{data:f,error:g}=await e.supabase.from("conversations").select("*").in("id",d);if(console.log("getUserConversations: Result",{data:f,error:g}),g)throw console.error("getUserConversations: Error fetching conversations:",g),g;return f},h=async(a,b)=>{console.log("getConversationMessages: Fetching messages for conversation:",a,"since:",b?.since);let c=e.supabase.from("messages").select(`
      id,
      content,
      created_at,
      sender_id,
      conversation_id,
      client_generated_id,
      profiles:sender_id (
        id,
        username,
        avatar_url
      )
    `).eq("conversation_id",a);b?.since&&(c=c.gt("created_at",b.since));let{data:d,error:f}=await c.order("created_at",{ascending:!0}).limit(b?.limit??50);if(console.log("getConversationMessages: Raw result",{data:d,error:f}),f)throw console.error("getConversationMessages: Error fetching messages:",f),f;let g=d?.map(a=>({id:a.id,content:a.content,created_at:a.created_at,sender_id:a.sender_id,conversation_id:a.conversation_id,client_generated_id:a.client_generated_id,username:a.profiles?.username??"Unknown User",avatar_url:a.profiles?.avatar_url??null}))??[];return console.log("getConversationMessages: Normalized messages",g),g},i=async(a,b,c,d)=>{console.log("sendMessage: Attempting to send message",{userId:a,conversationId:b,content:c,clientGeneratedId:d});let f={conversation_id:b,sender_id:a,content:c};d&&(f.client_generated_id=d);let{data:g,error:h}=await e.supabase.from("messages").insert(f).select("*").single();if(console.log("sendMessage: Result",{data:g,error:h}),h)throw console.error("sendMessage: Error sending message:",h),h;return g},j=async(a,b)=>{console.log("createDirectMessageConversation: Creating DM between users:",{userId:a,otherUserId:b});let{data:c,error:d}=await e.supabase.from("conversations").select(`
      id
    `).eq("type","dm");if(d)throw console.error("createDirectMessageConversation: Error fetching user DMs:",d),d;let f=null;for(let d of c){let{data:c,error:g}=await e.supabase.from("conversation_members").select("user_id").eq("conversation_id",d.id);if(!g&&c){let e=c.map(a=>a.user_id);if(e.includes(a)&&e.includes(b)&&2===e.length){f=d;break}}}if(console.log("createDirectMessageConversation: Check existing result:",{existingConversation:f}),f)return console.log("createDirectMessageConversation: Found existing conversation, returning:",f),f;let{data:g,error:h}=await e.supabase.from("conversations").insert([{type:"dm"}]).select().maybeSingle();if(console.log("createDirectMessageConversation: Created new conversation:",{conversation:g,convError:h}),h)throw console.error("createDirectMessageConversation: Error creating conversation:",h),h;let{error:i}=await e.supabase.from("conversation_members").insert([{conversation_id:g.id,user_id:a},{conversation_id:g.id,user_id:b}]);if(console.log("createDirectMessageConversation: Added members:",{membersError:i}),i)throw console.error("createDirectMessageConversation: Error adding members:",i),i;return console.log("createDirectMessageConversation: Successfully created DM conversation:",g),g},k=async a=>{console.log("getUserByUsername: Fetching user with username:",a);let{data:b,error:c}=await e.supabase.from("profiles").select("id, username, avatar_url").eq("username",a).maybeSingle();if(console.log("getUserByUsername: Result:",{data:b,error:c}),c)throw console.error("getUserByUsername: Error fetching user:",c),c;return b},l=async(a,b)=>{console.log("checkConversationMembership: Checking if user is member of conversation:",{conversationId:a,userId:b});let{data:c,error:d}=await e.supabase.from("conversation_members").select("user_id").eq("conversation_id",a).eq("user_id",b).maybeSingle();if(console.log("checkConversationMembership: Result:",{data:c,error:d}),d)throw console.error("checkConversationMembership: Error checking membership:",d),d;return!!c};var m=a.i(2159),n=a.i(45222),o=a.i(1304),o=o,p=a.i(60246),q=a.i(87532),r=a.i(70106);let s=(0,r.default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var t=a.i(46842);let u=(0,r.default)("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);var v=a.i(87055),v=v,w=a.i(34437),w=w,x=a.i(86351),x=x;let y=(0,r.default)("user-search",[["circle",{cx:"10",cy:"7",r:"4",key:"e45bow"}],["path",{d:"M10.3 15H7a4 4 0 0 0-4 4v2",key:"3bnktk"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["path",{d:"m21 21-1.9-1.9",key:"1g2n9r"}]]);var z=a.i(84218),z=z;let A=(0,r.default)("file",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]]);var B=a.i(82826),B=B,C=a.i(90925),D=a.i(48441);let E=({message:a,isVisible:c,onClose:d,onReload:e})=>c?(0,b.jsx)("div",{className:"fixed top-4 right-4 z-50",children:(0,b.jsxs)("div",{className:"bg-gray-800 border border-gray-700 rounded-lg shadow-lg p-4 max-w-sm flex items-start",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsx)("p",{className:"text-white text-sm",children:a})}),(0,b.jsxs)("div",{className:"ml-4 flex gap-2",children:[e&&(0,b.jsx)("button",{onClick:e,className:"px-3 py-1 bg-accent-primary text-white text-xs rounded hover:bg-accent-primary/90 transition-colors hover-lift",children:"Reload"}),(0,b.jsx)("button",{onClick:d,className:"px-3 py-1 bg-gray-700 text-white text-xs rounded hover:bg-gray-600 transition-colors hover-lift",children:"Close"})]})]})}):null;var F=a.i(86299);a.s(["default",0,()=>{let{state:a,dispatch:r}=(0,d.useAuthStore)(),{user:G}=a,[H,I]=(0,c.useState)([]),[J,K]=(0,c.useState)([]),[L,M]=(0,c.useState)([]),[N,O]=(0,c.useState)(null),[P,Q]=(0,c.useState)(""),[R,S]=(0,c.useState)(!0),[T,U]=(0,c.useState)(!1),[V,W]=(0,c.useState)(null),[X,Y]=(0,c.useState)(null),[Z,$]=(0,c.useState)(!1),[_,aa]=(0,c.useState)(""),[ab,ac]=(0,c.useState)("idle"),ad=(0,c.useRef)(null),ae=(0,c.useRef)(null),af=(0,c.useRef)(null),ag=(0,c.useRef)(null),ah=(0,c.useRef)(null),[ai,aj]=(0,c.useState)([]),[ak,al]=(0,c.useState)([]),[am,an]=(0,c.useState)({}),[ao,ap]=(0,c.useState)(null),[aq,ar]=(0,c.useState)(!1),[as,at]=(0,c.useState)("chat"),[au,av]=(0,c.useState)(""),[aw,ax]=(0,c.useState)([]),[ay,az]=(0,c.useState)(!1),[aA,aB]=(0,c.useState)({}),aC=(0,c.useRef)(null),aD=(0,c.useRef)(!1);(0,c.useEffect)(()=>{!G||aD.current||(aD.current=!0,(async()=>{try{let{data:a,error:b}=await e.supabase.auth.getSession(),c=a?.session;if(!c?.access_token){console.warn("No session yet, skipping profile ensure for now"),aI();return}await (0,m.ensureProfile)(e.supabase,G),console.log("SocialPage: Profile ensured, now loading conversations"),aI()}catch(a){console.error("Failed to ensure profile",a),aI()}})())},[G,e.supabase]),(0,c.useEffect)(()=>{let a=N?.id??null;console.log("SocialPage useEffect: Active conversation changed:",a),a&&ah.current!==a&&(ah.current=a,aJ())},[N?.id]),(0,c.useEffect)(()=>{aK()},[J]),(0,c.useEffect)(()=>{G&&aI()},[G?.id]),(0,c.useEffect)(()=>{let a=a=>{let{type:b,email:c}=a.detail;"AUTH_STATE_CHANGED"===b&&c?(aa(`Account switched to user: ${c}`),$(!0)):"SIGNED_OUT"===b&&(aa("Account signed out from another tab"),$(!0))};return window.addEventListener("authStateChangeFromOtherTab",a),()=>{window.removeEventListener("authStateChangeFromOtherTab",a)}},[]),(0,c.useEffect)(()=>()=>{af.current&&(af.current(),af.current=null),ag.current&&(clearInterval(ag.current),ag.current=null),aC.current&&(clearTimeout(aC.current),aC.current=null)},[]),(0,c.useEffect)(()=>{if(!ao||!N||!G)return;let a=()=>{ao&&N&&G&&(ao.setTypingStatus(N.id,G.id,!0),aC.current&&clearTimeout(aC.current),aC.current=setTimeout(()=>{ao.setTypingStatus(N.id,G.id,!1)},2e3))},b=document.querySelector('textarea[placeholder="Type your message here..."]');if(b)return b.addEventListener("input",a),()=>{b.removeEventListener("input",a),aC.current&&(clearTimeout(aC.current),aC.current=null),ao&&N&&G&&ao.setTypingStatus(N.id,G.id,!1)}},[ao,N,G]),(0,c.useEffect)(()=>{if(!ao||!N||!G)return;let a=async()=>{try{let a=await ao.getTypingUsers(N.id),b={};a.forEach(a=>{b[a]=!0}),aB(b)}catch(a){console.error("Error getting typing users:",a)}},b=setInterval(a,2e3);return a(),()=>{clearInterval(b)}},[ao,N,G]);let[aE,aF]=(0,c.useState)(!1);(0,c.useEffect)(()=>{G&&console.log("SocialPage: User changed, user ID:",G.id)},[G?.id]);let aG=(0,c.useCallback)((a,b)=>{let c=new Set(a.map(a=>a.id)),d=b.filter(a=>!c.has(a.id));return 0===d.length?a:[...a,...d].sort((a,b)=>new Date(a.created_at).getTime()-new Date(b.created_at).getTime())},[]),aH=(0,c.useCallback)(async a=>{try{let b=e.supabase.from("messages").select("id, conversation_id, sender_id, content, created_at, client_generated_id").eq("conversation_id",a).order("created_at",{ascending:!0});ae.current&&(b=b.gt("created_at",ae.current));let{data:c,error:d}=await b;if(d)return console.error("fetchLatestMessages: Error fetching messages:",d),[];return c&&c.length>0&&(ae.current=c[c.length-1].created_at),c||[]}catch(a){return console.error("fetchLatestMessages: Error in catch block:",a),[]}},[]);(0,c.useEffect)(()=>{if(!N?.id||!G){ag.current&&(clearInterval(ag.current),ag.current=null);return}return ag.current&&clearInterval(ag.current),ag.current=setInterval(async()=>{if(N?.id)try{let a=await aH(N.id);a.length>0&&K(b=>aG(b,a))}catch(a){console.error("Polling error:",a)}},3e3),()=>{ag.current&&(clearInterval(ag.current),ag.current=null)}},[N?.id,G?.id,aH,aG]),(0,c.useEffect)(()=>{var a,b;let c,d,f=N?.id;return(console.log("SocialPage useEffect: Active conversation changed:",f,"User ID:",G?.id),G&&f)?(af.current&&(console.log("SocialPage: Removing previous subscription for conversation:",f),af.current(),af.current=null),console.log("SocialPage: Setting up new subscription for conversation:",f),ac("idle"),a=a=>{console.log("SocialPage: Received message via realtime:",a),K(b=>aG(b,[a]))},b=(a,b)=>{console.log("SocialPage: Channel status:",a,"Error:",b),"SUBSCRIBED"===a?(ac("subscribed"),console.log("SocialPage: Realtime subscription ready")):"CHANNEL_ERROR"===a||"TIMED_OUT"===a?(ac("error"),console.log("SocialPage: Realtime subscription error, status:",a)):"CLOSED"===a&&(ac("closed"),console.log("SocialPage: Realtime subscription closed"))},c=!1,console.log("subscribeToMessages: Setting up subscription for conversation:",f),d=e.supabase.channel(`messages:${f}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`conversation_id=eq.${f}`},async b=>{console.log("subscribeToMessages: Received new message via realtime:",b);let c=b.new;try{let{data:b,error:d}=await e.supabase.from("profiles").select("username, avatar_url").eq("id",c.sender_id).single();d&&console.error("subscribeToMessages: Error fetching profile for sender:",d);let f={...c,username:b?.username??"Unknown User",avatar_url:b?.avatar_url??null};a(f)}catch(b){console.error("subscribeToMessages: Error processing profile data:",b),a({...c,username:"Unknown User",avatar_url:null})}}).subscribe((a,d)=>{console.log("subscribeToMessages: Subscription status:",a),"CLOSED"===a&&c||("CHANNEL_ERROR"===a||"TIMED_OUT"===a?b?.("CHANNEL_ERROR",d):"SUBSCRIBED"===a?b?.("SUBSCRIBED"):"CLOSED"===a&&b?.("CLOSED"))}),af.current=()=>{c=!0,console.log("subscribeToMessages: Removing subscription intentionally"),e.supabase.removeChannel(d)},()=>{console.log("SocialPage: Cleaning up subscription for conversation:",f),af.current&&(af.current(),af.current=null)}):void console.log("SocialPage: Missing user or conversation, returning")},[G?.id,N?.id,aG]);let aI=async()=>{try{let a;console.log("loadConversations: Starting to load conversations..."),S(!0),console.log("loadConversations: Fetching global help conversation");try{a=await f(),console.log("loadConversations: Got global help conversation:",a)}catch(b){console.error("loadConversations: Error getting global help conversation:",b),a=null}if(!G)return void console.log("loadConversations: No user found, returning");console.log("loadConversations: Fetching user conversations for user:",G.id);let b=await g(G.id);console.log("loadConversations: Got user conversations:",b);let c=[];a?(c=[a,...b],console.log("loadConversations: Setting conversations with global help:",c)):(c=b,console.log("loadConversations: Setting conversations without global help:",c)),I(c),a?(console.log("loadConversations: Setting active conversation to global help:",a),O(a)):c.length>0?(console.log("loadConversations: Setting active conversation to first available:",c[0]),O(c[0])):console.log("loadConversations: No conversations available");let d=await (0,F.getCommunityDB)();if(ap(d),d){let a=await d.getFriends(G.id);aj(a);let b=(await d.getFriendRequests(G.id)).filter(a=>"pending"===a.status);al(b);let c={};for(let b of a){let a=b.friend_id,e=await d.getProfile(a);e&&(c[a]=e)}for(let a of b){let b=a.requester_id===G?.id?a.addressee_id:a.requester_id,e=await d.getProfile(b);e&&!c[b]&&(c[b]=e)}an(c)}}catch(a){console.error("Failed to load conversations:",a)}finally{S(!1)}},aJ=async()=>{if(!N?.id){console.log("loadMessages: No active conversation, returning"),K([]);return}console.log("loadMessages: Loading messages for conversation:",N.id);try{let a=await h(N.id);if(console.log("loadMessages: Got messages:",a.length,"messages"),K(a),a.length>0){let b=a[a.length-1];ae.current=b.created_at,console.log("loadMessages: Set lastCreatedAtRef to:",b.created_at)}console.log("loadMessages: Loading members for conversation:",N.id);let b=await e.supabase.from("conversation_members").select(`
          user_id,
          role,
          profiles:user_id (
            username,
            email,
            avatar_url
          )
        `).eq("conversation_id",N.id);b.error?console.error("loadMessages: Error loading members:",b.error):(console.log("loadMessages: Got members:",b.data.length,"members",b.data),M(b.data))}catch(a){console.error("loadMessages: Error loading messages:",a)}};(0,c.useEffect)(()=>{aJ();let a=setInterval(()=>{aM()},3e4);return()=>{clearInterval(a)}},[N?.id]);let aK=()=>{ad.current?.scrollIntoView({behavior:"smooth"})},aL=async()=>{if(!P.trim()&&!X||!N||!G)return void console.log("handleSendMessage: Message not sent, validation failed:",{hasMessage:!!P.trim(),hasAttachment:!!X,hasActiveConversation:!!N,hasUser:!!G});try{if(ao&&N&&G&&ao.setTypingStatus(N.id,G.id,!1),X){let a=new FormData;a.append("file",X),a.append("conversationId",N.id);let b=await fetch("/api/upload",{method:"POST",body:a});if(!b.ok)throw Error("Upload failed");let c=await b.json();ao&&await ao.createMessage({conversation_id:N.id,sender_id:G.id,body:P||`Shared a file: ${X.name}`,attachment_url:c.url,attachment_type:X.type}),Y(null);let d=document.getElementById("attachment-input");d&&(d.value="")}else{let a=crypto.randomUUID();console.log("handleSendMessage: Attempting to send message:",{userId:G.id,conversationId:N.id,content:P});let b={id:"optimistic-"+a,conversation_id:N.id,sender_id:G.id,content:P,created_at:new Date().toISOString(),client_generated_id:a,pending:!0};K(a=>{console.log("handleSendMessage: Adding optimistic message to UI, previous count:",a.length);let c=[...a,b];return console.log("handleSendMessage: Optimistic message added, new count:",c.length),c}),Q(""),U(!0);let c=await l(N.id,G.id);console.log("handleSendMessage: User membership check result:",c),c||(console.log("handleSendMessage: User not a member, ensuring membership via global help API"),await f());let d=await i(G.id,N.id,P,a);console.log("handleSendMessage: Message sent to Supabase, replacing optimistic message with server response:",d),K(b=>{console.log("handleSendMessage: Replacing optimistic message in UI, previous count:",b.length);let c=b.map(b=>b.client_generated_id===a?(console.log("handleSendMessage: Found optimistic message to replace with server response"),{...d,pending:!1}):b);return console.log("handleSendMessage: Optimistic message replaced, new count:",c.length),c})}}catch(a){console.error("Failed to send message:",a),W("Message failed to send. Please try again."),setTimeout(()=>W(null),3e3)}finally{U(!1)}},aM=async()=>{if(N?.id)try{console.log("refreshMembers: Refreshing member data for conversation:",N.id);let a=await e.supabase.from("conversation_members").select(`
          user_id,
          role,
          profiles:user_id (
            username,
            email,
            avatar_url
          )
        `).eq("conversation_id",N.id);a.error?console.error("refreshMembers: Error refreshing members:",a.error):(console.log("refreshMembers: Refreshed members:",a.data.length,"members"),M(a.data))}catch(a){console.error("refreshMembers: Unexpected error:",a)}};return((0,c.useEffect)(()=>{console.log("Setting up profile change listener");let a=new BroadcastChannel("profile_changes");return a.onmessage=a=>{console.log("handleProfileChange: Received message from broadcast channel:",a.data),"USERNAME_CHANGED"===a.data.type&&a.data.userId&&(console.log("handleProfileChange: Processing username change:",a.data),M(b=>{console.log("handleProfileChange: Updating members with new username",{userId:a.data.userId,newUsername:a.data.newUsername,oldMembers:b});let c=b.map(b=>b.user_id===a.data.userId?(console.log("handleProfileChange: Found matching member to update",{oldUsername:b.profiles?.username,newUsername:a.data.newUsername}),{...b,profiles:{...b.profiles,username:a.data.newUsername}}):b);return console.log("handleProfileChange: Updated members result",c),c}),K(b=>b.map(b=>b.sender_id===a.data.userId?(console.log("handleProfileChange: Updating message username",{oldUsername:b.username,newUsername:a.data.newUsername}),{...b,username:a.data.newUsername}):b)),console.log("handleProfileChange: Updated both members and messages"))},()=>{console.log("Cleaning up profile change listener"),a.close()}},[L]),(0,c.useEffect)(()=>{console.log("Setting up real-time profile updates subscription");let a=e.supabase.channel("profile-updates").on("postgres_changes",{event:"UPDATE",schema:"public",table:"profiles"},a=>{console.log("Real-time profile update received:",a),M(b=>b.map(b=>b.user_id===a.new.id?(console.log("Updating member profile with new data:",{oldUsername:b.profiles?.username,newUsername:a.new.username}),{...b,profiles:{...b.profiles,username:a.new.username,avatar_url:a.new.avatar_url}}):b)),K(b=>b.map(b=>b.sender_id===a.new.id?(console.log("Updating message username from real-time profile update",{oldUsername:b.username,newUsername:a.new.username}),{...b,username:a.new.username,avatar_url:a.new.avatar_url}):b))}).subscribe();return()=>{console.log("Cleaning up real-time profile updates subscription"),e.supabase.removeChannel(a)}},[]),R)?(0,b.jsx)(C.default,{children:(0,b.jsx)(D.default,{children:(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsx)("div",{className:"text-2xl font-bold text-accent-primary",children:"Loading chat..."})})})}):G?(0,b.jsx)(C.default,{children:(0,b.jsxs)(D.default,{children:[aE&&(0,b.jsx)("div",{className:"fixed top-16 left-0 right-0 z-50 bg-yellow-900 border-b border-yellow-700 p-2 text-center",children:(0,b.jsx)("p",{className:"text-yellow-200 text-sm",children:"Multiple accounts in same browser profile share one session. Use different profiles for isolation."})}),(0,b.jsxs)("div",{className:"flex h-full bg-background",children:[(0,b.jsxs)("div",{className:"w-80 bg-card-bg border-r border-card-border flex flex-col",children:[(0,b.jsx)("div",{className:"p-4 border-b border-card-border",children:(0,b.jsxs)("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[(0,b.jsx)(n.MessageCircle,{className:"text-accent-primary",size:20}),"Conversations"]})}),(0,b.jsxs)("div",{className:"p-3",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(q.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",size:16}),(0,b.jsx)("input",{type:"text",placeholder:"Search conversations...",className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-accent-primary focus:border-transparent"})]}),(0,b.jsxs)("button",{className:"w-full mt-3 flex items-center justify-center gap-2 py-2 bg-accent-primary text-white rounded-lg hover:bg-accent-primary/90 transition-colors hover-lift border border-accent-primary",children:[(0,b.jsx)(s,{size:16}),"New Conversation"]})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[(0,b.jsxs)("div",{className:"p-2",children:[(0,b.jsx)("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider px-2 py-1",children:"Channels"}),(0,b.jsxs)("div",{className:`p-3 rounded-lg cursor-pointer mb-1 flex items-center gap-3 ${N?.name==="Global Help"?"bg-accent-primary/10 border border-accent-primary":"hover:bg-gray-800"}`,onClick:()=>{O(H.find(a=>"Global Help"===a.name))},children:[(0,b.jsx)(u,{className:"text-accent-primary",size:18}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-white",children:"Global Help"}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"General help channel"})]})]})]}),(0,b.jsxs)("div",{className:"p-2 border-t border-gray-800",children:[(0,b.jsx)("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider px-2 py-1",children:"Direct Messages"}),(0,b.jsxs)("div",{className:"space-y-1",children:[H.filter(a=>"dm"===a.type).map(a=>(0,b.jsxs)("div",{className:`p-3 rounded-lg cursor-pointer mb-1 flex items-center gap-3 ${N?.id===a.id?"bg-accent-primary/10 border border-accent-primary":"hover:bg-gray-800"}`,onClick:()=>O(a),children:[(0,b.jsx)(t.User,{className:"text-gray-400",size:18}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-white",children:"DM"}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Direct message"})]})]},a.id)),(0,b.jsxs)("button",{className:"w-full p-3 rounded-lg cursor-pointer flex items-center gap-3 hover:bg-gray-800 hover-lift",onClick:async()=>{let a=prompt("Enter username to start a DM with:");if(a&&G)try{let b=await k(a);if(b&&b.id!==G.id){let a=await j(G.id,b.id);I(b=>[...b,a]),O(a)}else alert("User not found or cannot message yourself")}catch(a){console.error("Failed to create DM:",a),alert("Failed to create DM: "+a.message)}},children:[(0,b.jsx)(s,{className:"text-gray-400",size:18}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-white",children:"New DM"}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Start a new conversation"})]})]})]})]})]})]}),(0,b.jsxs)("div",{className:"flex-1 flex",children:[aq&&(0,b.jsxs)("div",{className:"w-80 bg-card-bg border-r border-card-border flex flex-col",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-card-border flex justify-between items-center",children:[(0,b.jsxs)("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[(0,b.jsx)(p.Users,{className:"text-accent-primary",size:20}),"Community"]}),(0,b.jsx)("button",{onClick:()=>ar(!1),className:"text-gray-400 hover:text-white",children:(0,b.jsx)(x.default,{size:20})})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,b.jsxs)("h3",{className:"text-md font-semibold text-white flex items-center gap-2",children:[(0,b.jsx)(w.default,{className:"text-accent-primary",size:16}),"Friends (",ai.length,")"]}),(0,b.jsx)("button",{onClick:async()=>{if(ao&&G)try{let a=await ao.createConversation(!0,G.id,"My Group Chat",[]);I(b=>[...b,a]),O(a),ar(!1)}catch(a){console.error("Failed to create group chat:",a)}},className:"text-xs bg-accent-primary/20 hover:bg-accent-primary/30 text-accent-primary px-2 py-1 rounded",children:"Create Group"})]}),(0,b.jsx)("div",{className:"space-y-2",children:ai.length>0?ai.map(a=>{let c=a.friend_id,d=am[c],e=d?.username||`User ${c.substring(0,8)}`,f=d?.avatar_url||e.charAt(0).toUpperCase();return(0,b.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-gray-800",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-accent-primary to-purple-600 flex items-center justify-center text-white text-xs font-bold",children:"string"==typeof f&&f.startsWith("http")?(0,b.jsx)("img",{src:f,alt:e,className:"w-full h-full rounded-full object-cover"}):(0,b.jsx)("span",{children:f})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium text-white text-sm",children:e}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:d?.display_name||"Online"})]}),(0,b.jsx)("button",{onClick:async()=>{if(ao&&G)try{let a=await j(G.id,c);I(b=>[...b,a]),O(a),ar(!1)}catch(a){console.error("Failed to create DM:",a)}},className:"p-1 rounded hover:bg-gray-700",children:(0,b.jsx)(n.MessageCircle,{size:16})})]},c)}):(0,b.jsx)("p",{className:"text-gray-500 text-sm py-2",children:"No friends yet"})})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-md font-semibold text-white mb-3 flex items-center gap-2",children:[(0,b.jsx)(v.default,{className:"text-accent-primary",size:16}),"Requests (",ak.length,")"]}),(0,b.jsx)("div",{className:"space-y-2",children:ak.length>0?ak.map(a=>{let c=a.requester_id===G?.id,d=c?a.addressee_id:a.requester_id,e=am[d],f=e?.username||`User ${d.substring(0,8)}`,g=e?.avatar_url||f.charAt(0).toUpperCase();return(0,b.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-gray-800",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-accent-primary to-purple-600 flex items-center justify-center text-white text-xs font-bold",children:"string"==typeof g&&g.startsWith("http")?(0,b.jsx)("img",{src:g,alt:f,className:"w-full h-full rounded-full object-cover"}):(0,b.jsx)("span",{children:g})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium text-white text-sm",children:f}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:c?"Sent":"Received"})]}),!c&&(0,b.jsxs)("div",{className:"flex gap-1",children:[(0,b.jsx)("button",{onClick:async()=>{if(ao){await ao.updateFriendRequest(a.id,"accepted"),al((await ao.getFriendRequests(G.id)).filter(a=>"pending"===a.status));let b={user_id:G.id,friend_id:d,created_at:new Date().toISOString()};aj(a=>[...a,b]),e&&an(a=>({...a,[d]:e}))}},className:"p-1 rounded bg-green-600 hover:bg-green-500",children:(0,b.jsx)(w.default,{size:14})}),(0,b.jsx)("button",{onClick:async()=>{ao&&(await ao.updateFriendRequest(a.id,"declined"),al((await ao.getFriendRequests(G.id)).filter(a=>"pending"===a.status)))},className:"p-1 rounded bg-red-600 hover:bg-red-500",children:(0,b.jsx)(x.default,{size:14})})]})]},a.id)}):(0,b.jsx)("p",{className:"text-gray-500 text-sm py-2",children:"No pending requests"})})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-md font-semibold text-white mb-3 flex items-center gap-2",children:[(0,b.jsx)(y,{className:"text-accent-primary",size:16}),"Add Friend"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("input",{type:"text",placeholder:"Username",value:au,onChange:a=>av(a.target.value),className:"flex-1 bg-gray-800 text-white rounded px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-accent-primary",onKeyPress:async a=>{if("Enter"===a.key&&ao&&au.trim()){az(!0);try{let a=await ao.searchProfiles(au.trim());ax(a)}catch(a){console.error("Error searching profiles:",a)}finally{az(!1)}}}}),(0,b.jsx)("button",{className:"px-3 py-2 bg-accent-primary text-white rounded text-sm hover:bg-accent-primary/90 border border-accent-primary",onClick:async()=>{if(ao&&au.trim()){az(!0);try{let a=await ao.searchProfiles(au.trim());ax(a)}catch(a){console.error("Error searching profiles:",a)}finally{az(!1)}}},children:ay?"Searching...":"Search"})]}),aw.length>0&&(0,b.jsx)("div",{className:"mt-3 space-y-2 max-h-40 overflow-y-auto",children:aw.map(a=>{let c=ai.some(b=>b.friend_id===a.id),d=a.id===G?.id,e=ak.some(b=>b.requester_id===G?.id&&b.addressee_id===a.id);return(0,b.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-gray-800",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-accent-primary to-purple-600 flex items-center justify-center text-white text-xs font-bold",children:"string"==typeof a.avatar_url&&a.avatar_url.startsWith("http")?(0,b.jsx)("img",{src:a.avatar_url,alt:a.username,className:"w-full h-full rounded-full object-cover"}):(0,b.jsx)("span",{children:a.username.charAt(0).toUpperCase()})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium text-white text-sm",children:a.username}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:a.display_name})]}),!c&&!d&&!e&&(0,b.jsx)("button",{onClick:async()=>{if(ao&&G)try{await ao.createFriendRequest(G.id,a.id),aa("Friend request sent!"),$(!0),setTimeout(()=>$(!1),3e3)}catch(a){console.error("Error sending friend request:",a),aa("Failed to send friend request"),$(!0),setTimeout(()=>$(!1),3e3)}},className:"p-1 rounded bg-accent-primary hover:bg-accent-primary/90 mr-1",children:(0,b.jsx)(v.default,{size:14})}),(c||d)&&(0,b.jsx)("span",{className:"text-xs text-gray-500",children:d?"You":"Friend"}),e&&(0,b.jsx)("span",{className:"text-xs text-yellow-500",children:"Sent"}),c&&(0,b.jsx)("button",{onClick:async()=>{if(ao&&G)try{let b=await j(G.id,a.id);I(a=>[...a,b]),O(b),ar(!1)}catch(a){console.error("Failed to create DM:",a)}},className:"p-1 rounded hover:bg-gray-700",children:(0,b.jsx)(n.MessageCircle,{size:14})})]},a.id)})})]})]})})]}),(0,b.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,b.jsxs)("div",{className:"h-16 bg-card-bg border-b border-card-border flex items-center px-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("button",{onClick:()=>ar(!aq),className:"mr-2 p-2 rounded hover:bg-gray-800",title:"Community",children:(0,b.jsx)(p.Users,{size:20})}),(0,b.jsxs)("div",{className:"flex space-x-1",children:[(0,b.jsx)("button",{className:`px-3 py-1 rounded-md text-sm ${"chat"===as?"bg-accent-primary text-white border border-accent-primary":"text-gray-400 hover:text-white"}`,onClick:()=>at("chat"),children:"Chat"}),(0,b.jsx)("button",{className:`px-3 py-1 rounded-md text-sm ${"discover"===as?"bg-accent-primary text-white border border-accent-primary":"text-gray-400 hover:text-white"}`,onClick:()=>at("discover"),children:"Discover"}),(0,b.jsx)("button",{className:`px-3 py-1 rounded-md text-sm ${"friends"===as?"bg-accent-primary text-white border border-accent-primary":"text-gray-400 hover:text-white"}`,onClick:()=>at("friends"),children:"Friends"}),(0,b.jsx)("button",{className:`px-3 py-1 rounded-md text-sm ${"requests"===as?"bg-accent-primary text-white border border-accent-primary":"text-gray-400 hover:text-white"}`,onClick:()=>at("requests"),children:"Requests"})]})]}),(0,b.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,b.jsx)("div",{className:`w-2 h-2 rounded-full ${"subscribed"===ab?"bg-green-500":"error"===ab||"closed"===ab?"bg-red-500":"bg-yellow-500"}`}),(0,b.jsx)("span",{className:"text-xs text-gray-400",children:"subscribed"===ab?"Connected":"error"===ab||"closed"===ab?"Reconnecting...":"Connecting..."})]})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:["chat"===as&&(0,b.jsxs)(b.Fragment,{children:[J.map((a,c)=>{let d=a.sender_id===G?.id,e=L.find(b=>b.user_id===a.sender_id)?.profiles,f=d?"You":a.username||e?.username||e?.email?.split("@")[0]||"Unknown User",g=a.avatar_url||e?.avatar_url||a.username?.charAt(0).toUpperCase()||e?.username?.charAt(0).toUpperCase()||"M";return console.log("SocialPage: Rendering message",c,"ID:",a.id,"Content:",a.content,"Sender:",a.sender_id,"IsMe:",d),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center flex-shrink-0",children:"string"==typeof g&&g.startsWith("http")?(0,b.jsx)("img",{src:g,alt:f,className:"w-full h-full rounded-full object-cover"}):(0,b.jsx)("span",{className:"text-accent-primary font-bold",children:g})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,b.jsx)("span",{className:"font-medium text-white",children:f}),(0,b.jsx)("span",{className:"text-xs text-gray-500",children:new Date(a.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),a.read_at&&(0,b.jsx)("span",{className:"text-xs text-blue-400",children:"✓✓"})]}),(0,b.jsx)("div",{className:`mt-1 text-gray-300 bg-gray-800 p-3 rounded-lg max-w-3xl ${a.pending?"opacity-60 italic":""}`,children:a.is_attachment_upload?(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-accent-primary"}),(0,b.jsx)("span",{children:a.content})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{children:a.content}),a.attachment_url&&(0,b.jsx)("div",{className:"mt-2",children:a.attachment_type?.startsWith("image/")?(0,b.jsx)("img",{src:a.attachment_url,alt:"Attachment",className:"max-w-xs max-h-48 rounded-lg border border-gray-700",onError:a=>{let b=a.target;b.onerror=null,b.style.display="none",b.previousElementSibling?.classList.add("text-red-500")}}):(0,b.jsxs)("a",{href:a.attachment_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-blue-400 hover:text-blue-300",children:[(0,b.jsx)(A,{size:16}),"Download File"]})}),a.pending&&(0,b.jsx)("span",{className:"ml-2 text-xs text-gray-400",children:"Sending..."})]})})]})]},a.id)}),(0,b.jsx)("div",{ref:ad}),Object.entries(aA).length>0&&(0,b.jsxs)("div",{className:"px-4 py-2 text-sm text-gray-400 flex items-center",children:[(0,b.jsx)("div",{className:"flex space-x-1",children:[void 0,void 0,void 0].map((a,c)=>(0,b.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:`${.1*c}s`}},c))}),(0,b.jsx)("span",{className:"ml-2",children:1===Object.keys(aA).length?"Someone is typing...":`${Object.keys(aA).length} people are typing...`})]})]}),"discover"===as&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,b.jsx)(q.Search,{className:"h-5 w-5 text-gray-400"})}),(0,b.jsx)("input",{type:"text",placeholder:"Search users by username or display name...",value:au,onChange:a=>av(a.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-700 rounded-lg bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent-primary focus:border-transparent",onKeyPress:async a=>{if("Enter"===a.key&&ao&&au.trim()){az(!0);try{let a=await ao.searchProfiles(au.trim());ax(a)}catch(a){console.error("Error searching profiles:",a)}finally{az(!1)}}}})]}),(0,b.jsx)("button",{className:"px-4 py-2 bg-accent-primary text-white rounded-lg hover:bg-accent-primary/90 border border-accent-primary",onClick:async()=>{if(ao&&au.trim()){az(!0);try{let a=await ao.searchProfiles(au.trim());ax(a)}catch(a){console.error("Error searching profiles:",a)}finally{az(!1)}}},children:ay?"Searching...":"Search Users"}),(0,b.jsx)("div",{className:"space-y-3",children:aw.length>0?aw.map(a=>{let c=ai.some(b=>b.friend_id===a.id),d=a.id===G?.id,e=ak.some(b=>b.requester_id===G?.id&&b.addressee_id===a.id);return(0,b.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-gray-800",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-accent-primary to-purple-600 flex items-center justify-center text-white font-bold",children:"string"==typeof a.avatar_url&&a.avatar_url.startsWith("http")?(0,b.jsx)("img",{src:a.avatar_url,alt:a.username,className:"w-full h-full rounded-full object-cover"}):(0,b.jsx)("span",{children:a.username.charAt(0).toUpperCase()})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"font-medium text-white truncate",children:a.username}),(0,b.jsx)("p",{className:"text-xs text-gray-400 truncate",children:a.display_name})]}),!c&&!d&&!e&&(0,b.jsx)("button",{onClick:async()=>{if(ao&&G)try{await ao.createFriendRequest(G.id,a.id),aa("Friend request sent!"),$(!0),setTimeout(()=>$(!1),3e3)}catch(a){console.error("Error sending friend request:",a),aa("Failed to send friend request"),$(!0),setTimeout(()=>$(!1),3e3)}},className:"px-3 py-1 bg-accent-primary text-white rounded text-sm hover:bg-accent-primary/90 border border-accent-primary",children:"Add Friend"}),c&&(0,b.jsx)("button",{onClick:async()=>{if(ao&&G)try{let b=await j(G.id,a.id);I(a=>[...a,b]),O(b)}catch(a){console.error("Failed to create DM:",a)}},className:"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-500",children:"Message"}),d&&(0,b.jsx)("span",{className:"px-3 py-1 bg-gray-600 text-gray-300 rounded text-sm",children:"You"}),e&&(0,b.jsx)("span",{className:"px-3 py-1 bg-yellow-600 text-yellow-100 rounded text-sm",children:"Pending"})]},a.id)}):(0,b.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,b.jsx)("p",{children:"Search for users to connect with them"})})})]}),"friends"===as&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("h2",{className:"text-xl font-semibold",children:["Friends (",ai.length,")"]}),(0,b.jsx)("button",{onClick:async()=>{if(ao&&G)try{let a=await ao.createConversation(!0,G.id,"My Group Chat",[]);I(b=>[...b,a]),O(a)}catch(a){console.error("Failed to create group chat:",a)}},className:"px-4 py-2 bg-accent-primary text-white rounded-lg hover:bg-accent-primary/90 text-sm border border-accent-primary",children:"Create Group"})]}),(0,b.jsx)("div",{className:"space-y-3",children:ai.length>0?ai.map(a=>{let c=a.friend_id,d=am[c],e=d?.username||`User ${c.substring(0,8)}`,f=d?.avatar_url||e.charAt(0).toUpperCase();return(0,b.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-gray-800",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-accent-primary to-purple-600 flex items-center justify-center text-white font-bold",children:"string"==typeof f&&f.startsWith("http")?(0,b.jsx)("img",{src:f,alt:e,className:"w-full h-full rounded-full object-cover"}):(0,b.jsx)("span",{children:f})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"font-medium text-white truncate",children:e}),(0,b.jsx)("p",{className:"text-xs text-gray-400 truncate",children:d?.display_name||"Online"})]}),(0,b.jsx)("button",{onClick:async()=>{if(ao&&G)try{let a=await j(G.id,c);I(b=>[...b,a]),O(a)}catch(a){console.error("Failed to create DM:",a)}},className:"px-3 py-1 bg-accent-primary text-white rounded text-sm hover:bg-accent-primary/90 border border-accent-primary",children:"Message"})]},c)}):(0,b.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,b.jsx)(p.Users,{className:"w-12 h-12 mx-auto text-gray-600 mb-4"}),(0,b.jsx)("p",{children:"You don't have any friends yet"}),(0,b.jsx)("p",{className:"text-sm mt-2",children:"Search for users to add friends"})]})})]}),"requests"===as&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsx)("h2",{className:"text-xl font-semibold",children:"Friend Requests"})}),(0,b.jsx)("div",{className:"space-y-3",children:ak.length>0?ak.map(a=>{let c=a.requester_id===G?.id,d=c?a.addressee_id:a.requester_id,e=am[d],f=e?.username||`User ${d.substring(0,8)}`,g=e?.avatar_url||f.charAt(0).toUpperCase();return(0,b.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-gray-800",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-accent-primary to-purple-600 flex items-center justify-center text-white font-bold",children:"string"==typeof g&&g.startsWith("http")?(0,b.jsx)("img",{src:g,alt:f,className:"w-full h-full rounded-full object-cover"}):(0,b.jsx)("span",{children:g})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"font-medium text-white truncate",children:f}),(0,b.jsx)("p",{className:"text-xs text-gray-400 truncate",children:c?"Sent":"Received"})]}),c?(0,b.jsx)("span",{className:"px-3 py-1 bg-yellow-600 text-yellow-100 rounded text-sm",children:"Pending"}):(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:async()=>{if(ao){await ao.updateFriendRequest(a.id,"accepted"),al((await ao.getFriendRequests(G.id)).filter(a=>"pending"===a.status));let b={user_id:G.id,friend_id:d,created_at:new Date().toISOString()};aj(a=>[...a,b]),e&&an(a=>({...a,[d]:e}))}},className:"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-500",children:"Accept"}),(0,b.jsx)("button",{onClick:async()=>{ao&&(await ao.updateFriendRequest(a.id,"declined"),al((await ao.getFriendRequests(G.id)).filter(a=>"pending"===a.status)))},className:"px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-500",children:"Decline"})]})]},a.id)}):(0,b.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,b.jsx)(v.default,{className:"w-12 h-12 mx-auto text-gray-600 mb-4"}),(0,b.jsx)("p",{children:"No pending friend requests"}),(0,b.jsx)("p",{className:"text-sm mt-2",children:"Friend requests will appear here"})]})})]})]}),"chat"===as&&(0,b.jsxs)("div",{className:"p-4 border-t border-card-border",children:[V&&(0,b.jsx)("div",{className:"mb-2 p-2 bg-red-900/50 border border-red-700 rounded text-red-200 text-sm",children:V}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("div",{className:"flex-1 relative",children:(0,b.jsx)("textarea",{value:P,onChange:a=>{Q(a.target.value),ao&&N&&G&&""!==a.target.value.trim()&&(ao.setTypingStatus(N.id,G.id,!0),aC.current&&clearTimeout(aC.current),aC.current=setTimeout(()=>{ao.setTypingStatus(N.id,G.id,!1)},2e3))},onKeyPress:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),aL())},placeholder:"Type your message here...",className:"w-full min-h-12 max-h-32 p-3 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-accent-primary focus:border-transparent resize-none",rows:1})}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("button",{type:"button",className:"self-end p-2 rounded-lg bg-gray-700 text-gray-300 hover:bg-gray-600",onClick:()=>{document.getElementById("attachment-input")?.click()},children:[(0,b.jsx)(B.default,{size:18}),(0,b.jsx)("input",{id:"attachment-input",type:"file",className:"hidden",onChange:a=>{let b=a.target.files?.[0];if(b&&(Y(b),b&&N&&G)){let a={id:"temp-"+Date.now(),conversation_id:N.id,sender_id:G.id,content:`Uploading: ${b.name}`,created_at:new Date().toISOString(),is_attachment_upload:!0};K(b=>[...b,a])}}})]}),(0,b.jsx)("button",{onClick:aL,disabled:T||!P.trim()&&!X,className:`self-end px-4 py-2 rounded-lg flex items-center gap-2 hover-lift ${T||!P.trim()&&!X?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-accent-primary text-white hover:bg-accent-primary/90"}`,children:(0,b.jsx)(o.default,{size:18})})]})]}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Press Enter to send, Shift+Enter for new line"})]})]}),(0,b.jsxs)("div",{className:"w-80 bg-card-bg border-l border-card-border flex flex-col",children:[(0,b.jsx)("div",{className:"p-4 border-b border-card-border",children:(0,b.jsxs)("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[(0,b.jsx)(p.Users,{className:"text-accent-primary",size:20}),"Members (",L.length,")"]})}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:(0,b.jsx)("div",{className:"space-y-3",children:L.map(a=>{let c=a.user_id===G?.id,d=c?`${a.profiles?.username} (You)`:a.profiles?.username,e=a.profiles?.avatar_url||a.profiles?.username?.charAt(0).toUpperCase()||"M";return(0,b.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-gray-800",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center flex-shrink-0",children:"string"==typeof e&&e.startsWith("http")?(0,b.jsx)("img",{src:e,alt:d,className:"w-full h-full rounded-full object-cover"}):(0,b.jsx)("span",{className:"text-accent-primary font-bold",children:e})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"font-medium text-white truncate",children:d}),(0,b.jsx)("p",{className:"text-xs text-gray-500 truncate",children:a.profiles?.email})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-700 text-gray-300",children:a.role}),!c&&(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("button",{className:"p-1 rounded hover:bg-gray-700",onClick:()=>{let b=document.getElementById(`dropdown-${a.user_id}`);b&&b.classList.toggle("hidden")},children:(0,b.jsx)(z.default,{size:14})}),(0,b.jsx)("div",{id:`dropdown-${a.user_id}`,className:"hidden absolute right-0 mt-1 w-40 bg-gray-800 border border-gray-700 rounded-lg shadow-lg z-10",children:(0,b.jsxs)("div",{className:"py-1",children:[(0,b.jsx)("button",{className:"block w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-red-900/50 hover:text-red-400",onClick:async()=>{if(ao&&G)try{await ao.blockUser(G.id,a.user_id),aa("User blocked successfully"),$(!0),setTimeout(()=>$(!1),3e3)}catch(a){console.error("Error blocking user:",a),aa("Failed to block user"),$(!0),setTimeout(()=>$(!1),3e3)}},children:"Block User"}),(0,b.jsx)("button",{className:"block w-full text-left px-4 py-2 text-sm text-orange-500 hover:bg-orange-900/50 hover:text-orange-400",onClick:async()=>{let b=prompt("Enter reason for reporting this user:");if(b&&ao&&G)try{await ao.reportUser(G.id,a.user_id,b),aa("User reported successfully"),$(!0),setTimeout(()=>$(!1),3e3)}catch(a){console.error("Error reporting user:",a),aa("Failed to report user"),$(!0),setTimeout(()=>$(!1),3e3)}},children:"Report User"})]})})]})]})]},a.user_id)})})})]})]})]}),(0,b.jsx)(E,{message:_,isVisible:Z,onClose:()=>$(!1),onReload:()=>{window.location.reload()}})]})}):(0,b.jsx)(C.default,{children:(0,b.jsx)("div",{children:"Redirecting..."})})}],33876)}];

//# sourceMappingURL=src_app_social_page_tsx_5fc2d164._.js.map