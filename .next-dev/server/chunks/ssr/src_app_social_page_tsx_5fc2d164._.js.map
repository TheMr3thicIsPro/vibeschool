{"version":3,"sources":["../../../../src/services/chat/chatService.ts","../../../../src/app/social/page.tsx","../../../../src/components/ui/ToastNotification.tsx","../../../../node_modules/lucide-react/src/icons/user-search.ts","../../../../node_modules/lucide-react/src/icons/plus.ts","../../../../node_modules/lucide-react/src/icons/hash.ts","../../../../node_modules/lucide-react/src/icons/file.ts"],"sourcesContent":["import { supabase } from '@/lib/supabase';\r\n\r\n// Get or create global help conversation via API route\r\nexport const getOrCreateGlobalHelpConversation = async () => {\r\n  console.log('getOrCreateGlobalHelpConversation: Starting...');\r\n  \r\n  try {\r\n    // Get the session token\r\n    const { data: { session }, error: sessionError } = await supabase.auth.getSession();\r\n    \r\n    if (sessionError) {\r\n      console.error('getOrCreateGlobalHelpConversation: Error getting session:', sessionError);\r\n      throw sessionError;\r\n    }\r\n    \r\n    if (!session) {\r\n      console.error('getOrCreateGlobalHelpConversation: No session found');\r\n      throw new Error('No session found');\r\n    }\r\n    \r\n    console.log('getOrCreateGlobalHelpConversation: Session token available, calling API...');\r\n    \r\n    // Call the server action to get or create the global help conversation\r\n    const response = await fetch('/api/conversations/global-help', {\r\n      method: 'GET',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${session.access_token}`\r\n      }\r\n    });\r\n\r\n    console.log('getOrCreateGlobalHelpConversation: API response status:', response.status);\r\n    console.log('getOrCreateGlobalHelpConversation: API response ok:', response.ok);\r\n    \r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      console.error('getOrCreateGlobalHelpConversation: API response error text:', errorText);\r\n      \r\n      let errorData;\r\n      try {\r\n        errorData = JSON.parse(errorText);\r\n      } catch {\r\n        errorData = { error: errorText };\r\n      }\r\n      \r\n      throw new Error(errorData.error || `Failed to get or create global help conversation. Status: ${response.status}`);\r\n    }\r\n\r\n    const { conversation, membershipCreated } = await response.json();\r\n    console.log('getOrCreateGlobalHelpConversation: Returning conversation:', conversation);\r\n    console.log('getOrCreateGlobalHelpConversation: Membership created flag:', membershipCreated);\r\n    return conversation;\r\n  } catch (error) {\r\n    console.error('getOrCreateGlobalHelpConversation: Error:', error);\r\n    console.error('getOrCreateGlobalHelpConversation: Error details:', {\r\n      message: (error as any).message,\r\n      stack: (error as any).stack\r\n    });\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Get user's conversations (DMs and groups they're part of)\r\nexport const getUserConversations = async (userId: string) => {\r\n  console.log('getUserConversations: Fetching conversations for user:', userId);\r\n  \r\n  // First, get the conversation IDs the user is part of\r\n  const { data: memberData, error: memberError } = await supabase\r\n    .from('conversation_members')\r\n    .select('conversation_id')\r\n    .eq('user_id', userId);\r\n\r\n  if (memberError) {\r\n    console.error('getUserConversations: Error fetching member data:', memberError);\r\n    throw memberError;\r\n  }\r\n\r\n  if (!memberData || memberData.length === 0) {\r\n    return [];\r\n  }\r\n\r\n  // Get the conversation IDs\r\n  const conversationIds = memberData.map((m: any) => m.conversation_id);\r\n\r\n  // Now fetch the conversations\r\n  const { data, error } = await supabase\r\n    .from('conversations')\r\n    .select('*')\r\n    .in('id', conversationIds);\r\n\r\n  console.log('getUserConversations: Result', { data, error });\r\n  if (error) {\r\n    console.error('getUserConversations: Error fetching conversations:', error);\r\n    throw error;\r\n  }\r\n  return data;\r\n};\r\n\r\n// Get messages for a conversation\r\nexport const getConversationMessages = async (conversationId: string, opts?: { since?: string, limit?: number }) => {\r\n  console.log('getConversationMessages: Fetching messages for conversation:', conversationId, 'since:', opts?.since);\r\n  let query = supabase\r\n    .from('messages')\r\n    .select(`\r\n      id,\r\n      content,\r\n      created_at,\r\n      sender_id,\r\n      conversation_id,\r\n      client_generated_id,\r\n      profiles:sender_id (\r\n        id,\r\n        username,\r\n        avatar_url\r\n      )\r\n    `)\r\n    .eq('conversation_id', conversationId);\r\n    \r\n  if (opts?.since) {\r\n    query = query.gt('created_at', opts.since);\r\n  }\r\n  \r\n  const { data, error } = await query\r\n    .order('created_at', { ascending: true })\r\n    .limit(opts?.limit ?? 50);\r\n\r\n  console.log('getConversationMessages: Raw result', { data, error });\r\n  if (error) {\r\n    console.error('getConversationMessages: Error fetching messages:', error);\r\n    throw error;\r\n  }\r\n  \r\n  // Normalize messages to include profile data\r\n  const normalizedMessages = (data as any[])?.map((msg: any) => ({\r\n    id: msg.id,\r\n    content: msg.content,\r\n    created_at: msg.created_at,\r\n    sender_id: msg.sender_id,\r\n    conversation_id: msg.conversation_id,\r\n    client_generated_id: msg.client_generated_id,\r\n    username: msg.profiles?.username ?? 'Unknown User',\r\n    avatar_url: msg.profiles?.avatar_url ?? null\r\n  })) ?? [];\r\n  \r\n  console.log('getConversationMessages: Normalized messages', normalizedMessages);\r\n  return normalizedMessages;\r\n};\r\n\r\n// Send a message\r\nexport const sendMessage = async (userId: string, conversationId: string, content: string, clientGeneratedId?: string) => {\r\n  console.log('sendMessage: Attempting to send message', { userId, conversationId, content, clientGeneratedId });\r\n  \r\n  const messageData: any = {\r\n    conversation_id: conversationId,\r\n    sender_id: userId,\r\n    content,\r\n  };\r\n  \r\n  // Only add client_generated_id if provided\r\n  if (clientGeneratedId) {\r\n    messageData.client_generated_id = clientGeneratedId;\r\n  }\r\n  \r\n  const { data, error } = await supabase\r\n    .from('messages')\r\n    .insert(messageData)\r\n    .select('*')\r\n    .single();\r\n\r\n  console.log('sendMessage: Result', { data, error });\r\n  if (error) {\r\n    console.error('sendMessage: Error sending message:', error);\r\n    throw error;\r\n  }\r\n  return data;\r\n};\r\n\r\n// Create a direct message conversation\r\nexport const createDirectMessageConversation = async (userId: string, otherUserId: string) => {\r\n  console.log('createDirectMessageConversation: Creating DM between users:', { userId, otherUserId });\r\n  \r\n  // Check if a DM conversation already exists between these users\r\n  // First get all DM conversations for the current user\r\n  const { data: userDms, error: userDmsError } = await supabase\r\n    .from('conversations')\r\n    .select(`\r\n      id\r\n    `)\r\n    .eq('type', 'dm');\r\n\r\n  if (userDmsError) {\r\n    console.error('createDirectMessageConversation: Error fetching user DMs:', userDmsError);\r\n    throw userDmsError;\r\n  }\r\n\r\n  // Then check if any of those DMs has both users as members\r\n  let existingConversation = null;\r\n  for (const dm of userDms) {\r\n    const { data: members, error: membersError } = await supabase\r\n      .from('conversation_members')\r\n      .select('user_id')\r\n      .eq('conversation_id', dm.id);\r\n    \r\n    if (!membersError && members) {\r\n      const memberIds = members.map((m: { user_id: string }) => m.user_id);\r\n      if (memberIds.includes(userId) && memberIds.includes(otherUserId) && memberIds.length === 2) {\r\n        existingConversation = dm;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  console.log('createDirectMessageConversation: Check existing result:', { existingConversation });\r\n\r\n  if (existingConversation) {\r\n    console.log('createDirectMessageConversation: Found existing conversation, returning:', existingConversation);\r\n    return existingConversation;\r\n  }\r\n\r\n  // Create new DM conversation\r\n  const { data: conversation, error: convError } = await supabase\r\n    .from('conversations')\r\n    .insert([{ type: 'dm' }])\r\n    .select()\r\n    .maybeSingle();\r\n\r\n  console.log('createDirectMessageConversation: Created new conversation:', { conversation, convError });\r\n  if (convError) {\r\n    console.error('createDirectMessageConversation: Error creating conversation:', convError);\r\n    throw convError;\r\n  }\r\n\r\n  // Add both users as members\r\n  const { error: membersError } = await supabase\r\n    .from('conversation_members')\r\n    .insert([\r\n      { conversation_id: conversation.id, user_id: userId },\r\n      { conversation_id: conversation.id, user_id: otherUserId }\r\n    ]);\r\n\r\n  console.log('createDirectMessageConversation: Added members:', { membersError });\r\n  if (membersError) {\r\n    console.error('createDirectMessageConversation: Error adding members:', membersError);\r\n    throw membersError;\r\n  }\r\n\r\n  console.log('createDirectMessageConversation: Successfully created DM conversation:', conversation);\r\n  return conversation;\r\n};\r\n\r\n// Get user by username for DM creation\r\nexport const getUserByUsername = async (username: string) => {\r\n  console.log('getUserByUsername: Fetching user with username:', username);\r\n  const { data, error } = await supabase\r\n    .from('profiles')\r\n    .select('id, username, avatar_url')\r\n    .eq('username', username)\r\n    .maybeSingle();\r\n\r\n  console.log('getUserByUsername: Result:', { data, error });\r\n  if (error) {\r\n    console.error('getUserByUsername: Error fetching user:', error);\r\n    throw error;\r\n  }\r\n  return data;\r\n};\r\n\r\n// Check if user is a member of a conversation\r\nexport const checkConversationMembership = async (conversationId: string, userId: string) => {\r\n  console.log('checkConversationMembership: Checking if user is member of conversation:', { conversationId, userId });\r\n  const { data, error } = await supabase\r\n    .from('conversation_members')\r\n    .select('user_id')\r\n    .eq('conversation_id', conversationId)\r\n    .eq('user_id', userId)\r\n    .maybeSingle();\r\n\r\n  console.log('checkConversationMembership: Result:', { data, error });\r\n  if (error) {\r\n    console.error('checkConversationMembership: Error checking membership:', error);\r\n    throw error;\r\n  }\r\n  \r\n  return !!data; // Return true if membership exists, false otherwise\r\n};\r\n\r\n// Add reaction to a message\r\nexport const addReactionToMessage = async (userId: string, messageId: string, reaction: string) => {\r\n  // Add reaction implementation would go here\r\n  console.log('addReactionToMessage: Adding reaction', { userId, messageId, reaction });\r\n  // This would need a message_reactions table which we haven't created yet\r\n};\r\n\r\n// Remove reaction from a message\r\nexport const removeReactionFromMessage = async (userId: string, messageId: string, reaction: string) => {\r\n  // Remove reaction implementation would go here\r\n  console.log('removeReactionFromMessage: Removing reaction', { userId, messageId, reaction });\r\n  // This would need a message_reactions table which we haven't created yet\r\n};\r\n\r\n// Subscribe to real-time messages in a conversation\r\nexport const subscribeToConversation = (\r\n  conversationId: string, \r\n  callback: (payload: any) => void\r\n) => {\r\n  console.log('subscribeToConversation: Setting up subscription for conversation:', conversationId);\r\n  \r\n  // For real-time subscriptions, we'll use the global supabase client\r\n  // since the subscription needs to persist\r\n  const channelName = `conversation-${conversationId}`;\r\n  const subscription = supabase\r\n    .channel(channelName)\r\n    .on(\r\n      'postgres_changes',\r\n      {\r\n        event: 'INSERT',\r\n        schema: 'public',\r\n        table: 'messages',\r\n        filter: `conversation_id=eq.${conversationId}`,\r\n      },\r\n      (payload: any) => {\r\n        console.log('subscribeToConversation: Received new message via Realtime:', payload);\r\n        callback(payload);\r\n      }\r\n    )\r\n    .subscribe();\r\n\r\n  console.log('subscribeToConversation: Subscription established:', subscription);\r\n  return () => {\r\n    console.log('subscribeToConversation: Removing subscription');\r\n    supabase.removeChannel(subscription);\r\n  };\r\n};\r\n\r\n// Subscribe to messages in a conversation\r\nexport function subscribeToMessages(\r\n  conversationId: string,\r\n  onInsert: (msg: any) => void,\r\n  onStatus?: (status: 'SUBSCRIBED' | 'CHANNEL_ERROR' | 'TIMED_OUT' | 'CLOSED', err?: unknown) => void\r\n): () => void {\r\n  let intentionalClose = false;\r\n  console.log('subscribeToMessages: Setting up subscription for conversation:', conversationId);\r\n  \r\n  const channel = supabase\r\n    .channel(`messages:${conversationId}`)\r\n    .on(\r\n      'postgres_changes',\r\n      { \r\n        event: 'INSERT', \r\n        schema: 'public', \r\n        table: 'messages', \r\n        filter: `conversation_id=eq.${conversationId}` \r\n      },\r\n      async (payload: any) => {\r\n        console.log('subscribeToMessages: Received new message via realtime:', payload);\r\n        const msg = payload.new;\r\n        \r\n        // Fetch the sender's profile data to include username\r\n        try {\r\n          const { data: profileData, error: profileError } = await supabase\r\n            .from('profiles')\r\n            .select('username, avatar_url')\r\n            .eq('id', msg.sender_id)\r\n            .single();\r\n          \r\n          if (profileError) {\r\n            console.error('subscribeToMessages: Error fetching profile for sender:', profileError);\r\n          }\r\n          \r\n          // Append profile data to the message\r\n          const messageWithProfile = {\r\n            ...msg,\r\n            username: profileData?.username ?? 'Unknown User',\r\n            avatar_url: profileData?.avatar_url ?? null\r\n          };\r\n          \r\n          onInsert(messageWithProfile);\r\n        } catch (error) {\r\n          console.error('subscribeToMessages: Error processing profile data:', error);\r\n          // Fallback to original message if profile fetch fails\r\n          const messageWithFallback = {\r\n            ...msg,\r\n            username: 'Unknown User',\r\n            avatar_url: null\r\n          };\r\n          onInsert(messageWithFallback);\r\n        }\r\n      }\r\n    )\r\n    .subscribe((status: any, err: any) => {\r\n      console.log('subscribeToMessages: Subscription status:', status);\r\n      if (status === 'CLOSED' && intentionalClose) return;\r\n      if (status === 'CHANNEL_ERROR' || status === 'TIMED_OUT') onStatus?.('CHANNEL_ERROR', err);\r\n      else if (status === 'SUBSCRIBED') onStatus?.('SUBSCRIBED');\r\n      else if (status === 'CLOSED') onStatus?.('CLOSED');\r\n    });\r\n\r\n  return () => { \r\n    intentionalClose = true;\r\n    console.log('subscribeToMessages: Removing subscription intentionally');\r\n    supabase.removeChannel(channel); \r\n  };\r\n}\r\n\r\n// Subscribe to real-time reactions on messages\r\nexport const subscribeToReactions = (\r\n  messageId: string, \r\n  callback: (payload: any) => void\r\n) => {\r\n  // Reaction subscription implementation would go here\r\n  console.log('subscribeToReactions: Setting up subscription for message:', messageId);\r\n  // This would need a message_reactions table which we haven't created yet\r\n};","'use client';\r\n\r\nimport { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { useAuthStore } from '@/context/AuthContext';\r\nimport { \r\n  getOrCreateGlobalHelpConversation, \r\n  getUserConversations, \r\n  getConversationMessages, \r\n  sendMessage,\r\n  subscribeToMessages,\r\n  createDirectMessageConversation,\r\n  getUserByUsername,\r\n  checkConversationMembership\r\n} from '@/services/chat/chatService';\r\nimport { getConversationMembers } from '@/lib/chatService';\r\nimport { ensureProfile } from '@/lib/ensureProfile';\r\nimport { supabase } from '@/lib/supabase';\r\nimport { MessageCircle, Send, Users, Search, Plus, User, Hash, UserPlus, UserMinus, UserCheck, UserX, UserSearch, MoreVertical, Image as ImageIcon, File as FileIcon, Mic, Paperclip } from 'lucide-react';\r\nimport ProtectedRoute from '@/components/auth/ProtectedRoute';\r\nimport AppShell from '@/components/layout/AppShell';\r\nimport ToastNotification from '@/components/ui/ToastNotification';\r\nimport { dedupeAndSortMessages, replaceOptimisticMessage } from '@/utils/messageUtils';\r\nimport { getCommunityDB } from '@/community/db';\r\nimport { Friend, FriendRequest, Profile } from '@/community/db';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\nconst SocialPage = () => {\r\n  const { state, dispatch } = useAuthStore();\r\n  const { user } = state;\r\n  const [conversations, setConversations] = useState<any[]>([]);\r\n  const [messages, setMessages] = useState<any[]>([]);\r\n  const [members, setMembers] = useState<any[]>([]);\r\n  const [activeConversation, setActiveConversation] = useState<any>(null);\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n  const [messageLoading, setMessageLoading] = useState(false);\r\n  const [errorMessage, setErrorMessage] = useState<string | null>(null);\r\n  const [attachment, setAttachment] = useState<File | null>(null);\r\n  const [showToast, setShowToast] = useState(false);\r\n  const [toastMessage, setToastMessage] = useState('');\r\n  const [realtimeStatus, setRealtimeStatus] = useState<'idle'|'subscribed'|'error'|'closed'>('idle');\r\n  const messagesEndRef = useRef<null | HTMLDivElement>(null);\r\n  const lastCreatedAtRef = useRef<string | null>(null);\r\n  const unsubscribeRef = useRef<(() => void) | null>(null);\r\n  const pollRef = useRef<NodeJS.Timeout | null>(null);\r\n  const currentConversationIdRef = useRef<string | null>(null);\r\n  \r\n  // Community features\r\n  const [friends, setFriends] = useState<Friend[]>([]);\r\n  const [friendRequests, setFriendRequests] = useState<FriendRequest[]>([]);\r\n  const [profiles, setProfiles] = useState<Record<string, Profile>>({});\r\n  const [communityDb, setCommunityDb] = useState<any>(null);\r\n  const [showFriendsPanel, setShowFriendsPanel] = useState(false); // Toggle for friends panel\r\n  const [activeCommunityTab, setActiveCommunityTab] = useState<'chat' | 'discover' | 'friends' | 'requests'>('chat'); // Community tab state\r\n  const [searchUsername, setSearchUsername] = useState('');\r\n  const [searchResults, setSearchResults] = useState<any[]>([]);\r\n  const [loadingSearch, setLoadingSearch] = useState(false);\r\n  \r\n  // Typing indicators\r\n  const [typingUsers, setTypingUsers] = useState<Record<string, boolean>>({});\r\n  const typingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  const didRun = useRef(false)\r\n\r\n  useEffect(() => {\r\n    if (!user) return\r\n    if (didRun.current) return\r\n    didRun.current = true\r\n\r\n    ;(async () => {\r\n      try {\r\n        // Check for valid session before trying to ensure profile\r\n        const { data: sessionData, error: sessionErr } = await supabase.auth.getSession()\r\n        const session = sessionData?.session\r\n\r\n        if (!session?.access_token) {\r\n          console.warn(\"No session yet, skipping profile ensure for now\")\r\n          loadConversations();\r\n          return\r\n        }\r\n        \r\n        const profile = await ensureProfile(supabase, user)\r\n        console.log('SocialPage: Profile ensured, now loading conversations');\r\n        loadConversations();\r\n      } catch (e) {\r\n        console.error(\"Failed to ensure profile\", e)\r\n        // Still try to load conversations even if profile creation fails\r\n        loadConversations();\r\n      }\r\n    })()\r\n  }, [user, supabase]);\r\n\r\n  useEffect(() => {\r\n    const activeConversationId = activeConversation?.id ?? null;\r\n    console.log('SocialPage useEffect: Active conversation changed:', activeConversationId);\r\n    \r\n    if (!activeConversationId) return;\r\n    \r\n    // Prevent duplicate setup for same conversation id\r\n    if (currentConversationIdRef.current === activeConversationId) return;\r\n    \r\n    // Update the current conversation id ref\r\n    currentConversationIdRef.current = activeConversationId;\r\n    \r\n    // Load messages for the new conversation\r\n    loadMessages();\r\n  }, [activeConversation?.id]);\r\n\r\n  // Scroll to bottom when messages change\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages]);\r\n\r\n  // Listen for user changes to reload conversations and messages\r\n  useEffect(() => {\r\n    if (user) {\r\n      loadConversations();\r\n    }\r\n  }, [user?.id]); // Only reload when user ID changes\r\n\r\n  // Listen for auth state changes from other tabs\r\n  useEffect(() => {\r\n    const handleAuthStateChange = (event: any) => {\r\n      const { type, email } = event.detail;\r\n      \r\n      if (type === 'AUTH_STATE_CHANGED' && email) {\r\n        setToastMessage(`Account switched to user: ${email}`);\r\n        setShowToast(true);\r\n      } else if (type === 'SIGNED_OUT') {\r\n        setToastMessage('Account signed out from another tab');\r\n        setShowToast(true);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('authStateChangeFromOtherTab', handleAuthStateChange);\r\n\r\n    return () => {\r\n      window.removeEventListener('authStateChangeFromOtherTab', handleAuthStateChange);\r\n    };\r\n  }, []);\r\n\r\n  // Clean up on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      // Cleanup realtime subscription\r\n      if (unsubscribeRef.current) {\r\n        unsubscribeRef.current();\r\n        unsubscribeRef.current = null;\r\n      }\r\n      // Cleanup polling\r\n      if (pollRef.current) {\r\n        clearInterval(pollRef.current);\r\n        pollRef.current = null;\r\n      }\r\n      // Cleanup typing timeout\r\n      if (typingTimeoutRef.current) {\r\n        clearTimeout(typingTimeoutRef.current);\r\n        typingTimeoutRef.current = null;\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Handle typing indicators\r\n  useEffect(() => {\r\n    if (!communityDb || !activeConversation || !user) return;\r\n    \r\n    const handleTyping = () => {\r\n      if (!communityDb || !activeConversation || !user) return;\r\n      \r\n      // Send typing indicator\r\n      communityDb.setTypingStatus(activeConversation.id, user.id, true);\r\n      \r\n      // Clear any existing timeout\r\n      if (typingTimeoutRef.current) {\r\n        clearTimeout(typingTimeoutRef.current);\r\n      }\r\n      \r\n      // Set a new timeout to stop typing indicator after 2 seconds\r\n      typingTimeoutRef.current = setTimeout(() => {\r\n        communityDb.setTypingStatus(activeConversation.id, user.id, false);\r\n      }, 2000);\r\n    };\r\n    \r\n    // Monitor typing in the message input\r\n    const textarea = document.querySelector('textarea[placeholder=\"Type your message here...\"]') as HTMLTextAreaElement;\r\n    if (textarea) {\r\n      textarea.addEventListener('input', handleTyping);\r\n      \r\n      return () => {\r\n        textarea.removeEventListener('input', handleTyping);\r\n        // Cleanup typing timeout\r\n        if (typingTimeoutRef.current) {\r\n          clearTimeout(typingTimeoutRef.current);\r\n          typingTimeoutRef.current = null;\r\n        }\r\n        // Make sure to stop typing indicator when leaving\r\n        if (communityDb && activeConversation && user) {\r\n          communityDb.setTypingStatus(activeConversation.id, user.id, false);\r\n        }\r\n      };\r\n    }\r\n  }, [communityDb, activeConversation, user]);\r\n\r\n  // Monitor typing indicators from other users\r\n  useEffect(() => {\r\n    if (!communityDb || !activeConversation || !user) return;\r\n    \r\n    const monitorTyping = async () => {\r\n      try {\r\n        const typingUsersList = await communityDb.getTypingUsers(activeConversation.id);\r\n        \r\n        // Update typing users state\r\n        const newTypingUsers: Record<string, boolean> = {};\r\n        typingUsersList.forEach((userId: string) => {\r\n          newTypingUsers[userId] = true;\r\n        });\r\n        setTypingUsers(newTypingUsers);\r\n      } catch (error) {\r\n        console.error('Error getting typing users:', error);\r\n      }\r\n    };\r\n    \r\n    // Update every 2 seconds\r\n    const typingInterval = setInterval(monitorTyping, 2000);\r\n    \r\n    // Initial load\r\n    monitorTyping();\r\n    \r\n    return () => {\r\n      clearInterval(typingInterval);\r\n    };\r\n  }, [communityDb, activeConversation, user]);\r\n\r\n  // State for session conflict warning\r\n  const [showSessionWarning, setShowSessionWarning] = useState(false);\r\n\r\n  // Effect to detect session conflicts when user changes\r\n  useEffect(() => {\r\n    if (user) {\r\n      console.log('SocialPage: User changed, user ID:', user.id);\r\n      // Show session warning in development mode\r\n      if (process.env.NODE_ENV === 'development') {\r\n        setShowSessionWarning(true);\r\n        setTimeout(() => setShowSessionWarning(false), 5000); // Hide after 5 seconds\r\n      }\r\n    }\r\n  }, [user?.id]);\r\n\r\n  // Helper function to append messages safely with deduplication\r\n  const appendMessagesSafely = useCallback((prevMessages: any[], newMessages: any[]) => {\r\n    // Create a Set of existing message IDs to avoid duplicates\r\n    const existingIds = new Set(prevMessages.map((msg: any) => msg.id));\r\n    \r\n    // Filter out messages that already exist\r\n    const uniqueNewMessages = newMessages.filter((msg: any) => !existingIds.has(msg.id));\r\n    \r\n    if (uniqueNewMessages.length === 0) {\r\n      return prevMessages; // No new messages to add\r\n    }\r\n    \r\n    // Combine and sort by created_at\r\n    const combinedMessages = [...prevMessages, ...uniqueNewMessages];\r\n    return combinedMessages.sort((a, b) => new Date(a.created_at).getTime() - new Date(b.created_at).getTime());\r\n  }, []);\r\n\r\n  // Function to fetch latest messages\r\n  const fetchLatestMessages = useCallback(async (conversationId: string) => {\r\n    try {\r\n      let query = supabase\r\n        .from('messages')\r\n        .select('id, conversation_id, sender_id, content, created_at, client_generated_id')\r\n        .eq('conversation_id', conversationId)\r\n        .order('created_at', { ascending: true });\r\n\r\n      // If we have a last seen timestamp, only get newer messages\r\n      if (lastCreatedAtRef.current) {\r\n        query = query.gt('created_at', lastCreatedAtRef.current);\r\n      }\r\n\r\n      const { data, error } = await query;\r\n\r\n      if (error) {\r\n        console.error('fetchLatestMessages: Error fetching messages:', error);\r\n        return [];\r\n      }\r\n\r\n      if (data && data.length > 0) {\r\n        // Update lastCreatedAtRef to the newest message\r\n        const newestMessage = data[data.length - 1];\r\n        lastCreatedAtRef.current = newestMessage.created_at;\r\n      }\r\n\r\n      return data || [];\r\n    } catch (error) {\r\n      console.error('fetchLatestMessages: Error in catch block:', error);\r\n      return [];\r\n    }\r\n  }, []);\r\n\r\n  // Polling effect\r\n  useEffect(() => {\r\n    if (!activeConversation?.id || !user) {\r\n      // Clear polling if no active conversation or user\r\n      if (pollRef.current) {\r\n        clearInterval(pollRef.current);\r\n        pollRef.current = null;\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Clear any existing polling interval\r\n    if (pollRef.current) {\r\n      clearInterval(pollRef.current);\r\n    }\r\n\r\n    // Start polling every 3 seconds\r\n    pollRef.current = setInterval(async () => {\r\n      if (!activeConversation?.id) return;\r\n      \r\n      try {\r\n        const newMessages = await fetchLatestMessages(activeConversation.id);\r\n        \r\n        if (newMessages.length > 0) {\r\n          setMessages(prev => {\r\n            const updatedMessages = appendMessagesSafely(prev, newMessages);\r\n            return updatedMessages;\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error('Polling error:', error);\r\n      }\r\n    }, 3000); // Every 3 seconds\r\n\r\n    // Cleanup on unmount or conversation change\r\n    return () => {\r\n      if (pollRef.current) {\r\n        clearInterval(pollRef.current);\r\n        pollRef.current = null;\r\n      }\r\n    };\r\n  }, [activeConversation?.id, user?.id, fetchLatestMessages, appendMessagesSafely]);\r\n\r\n  // Update the realtime subscription to use the same appendMessagesSafely function\r\n  useEffect(() => {\r\n    const activeConversationId = activeConversation?.id;\r\n    console.log('SocialPage useEffect: Active conversation changed:', activeConversationId, 'User ID:', user?.id);\r\n    \r\n    if (!user || !activeConversationId) {\r\n      console.log('SocialPage: Missing user or conversation, returning');\r\n      return;\r\n    }\r\n    \r\n    // Clean up any existing subscription\r\n    if (unsubscribeRef.current) {\r\n      console.log('SocialPage: Removing previous subscription for conversation:', activeConversationId);\r\n      unsubscribeRef.current();\r\n      unsubscribeRef.current = null;\r\n    }\r\n    \r\n    console.log('SocialPage: Setting up new subscription for conversation:', activeConversationId);\r\n    \r\n    // Set status to idle initially\r\n    setRealtimeStatus('idle');\r\n    \r\n    // Subscribe to messages\r\n    const unsubscribe = subscribeToMessages(\r\n      activeConversationId,\r\n      (msg) => {\r\n        console.log('SocialPage: Received message via realtime:', msg);\r\n        \r\n        setMessages(prev => {\r\n          // Use the same deduplication logic as polling\r\n          return appendMessagesSafely(prev, [msg]);\r\n        });\r\n      },\r\n      (status, err) => {\r\n        console.log('SocialPage: Channel status:', status, 'Error:', err);\r\n        // Map the actual Supabase status to our UI status\r\n        if (status === 'SUBSCRIBED') {\r\n          setRealtimeStatus('subscribed');\r\n          console.log('SocialPage: Realtime subscription ready');\r\n        } else if (status === 'CHANNEL_ERROR' || status === 'TIMED_OUT') {\r\n          setRealtimeStatus('error');\r\n          console.log('SocialPage: Realtime subscription error, status:', status);\r\n        } else if (status === 'CLOSED') {\r\n          setRealtimeStatus('closed');\r\n          console.log('SocialPage: Realtime subscription closed');\r\n        }\r\n        \r\n        // Even if realtime has issues, polling will continue to work\r\n        // We don't need to restart polling since it's independent\r\n      }\r\n    );\r\n    \r\n    unsubscribeRef.current = unsubscribe;\r\n\r\n    // Cleanup function\r\n    return () => {\r\n      console.log('SocialPage: Cleaning up subscription for conversation:', activeConversationId);\r\n      if (unsubscribeRef.current) {\r\n        unsubscribeRef.current();\r\n        unsubscribeRef.current = null;\r\n      }\r\n    };\r\n  }, [user?.id, activeConversation?.id, appendMessagesSafely]); // Include appendMessagesSafely in dependencies\r\n\r\n  const loadConversations = async () => {\r\n    try {\r\n      console.log('loadConversations: Starting to load conversations...');\r\n      setLoading(true);\r\n      \r\n      // Get global help conversation\r\n      console.log('loadConversations: Fetching global help conversation');\r\n      let globalHelp;\r\n      try {\r\n        globalHelp = await getOrCreateGlobalHelpConversation();\r\n        console.log('loadConversations: Got global help conversation:', globalHelp);\r\n      } catch (err) {\r\n        console.error('loadConversations: Error getting global help conversation:', err);\r\n        // If global help fails, we'll continue with other conversations\r\n        globalHelp = null;\r\n      }\r\n      \r\n      // Get user's other conversations\r\n      if (!user) {\r\n        console.log('loadConversations: No user found, returning');\r\n        return;\r\n      }\r\n      console.log('loadConversations: Fetching user conversations for user:', user.id);\r\n      const userConvos = await getUserConversations(user.id);\r\n      console.log('loadConversations: Got user conversations:', userConvos);\r\n      \r\n      // Combine and set conversations\r\n      let allConversations = [];\r\n      if (globalHelp) {\r\n        allConversations = [globalHelp, ...userConvos];\r\n        console.log('loadConversations: Setting conversations with global help:', allConversations);\r\n      } else {\r\n        allConversations = userConvos;\r\n        console.log('loadConversations: Setting conversations without global help:', allConversations);\r\n      }\r\n      \r\n      setConversations(allConversations);\r\n      \r\n      // Set global help as active by default if available, otherwise use first conversation\r\n      if (globalHelp) {\r\n        console.log('loadConversations: Setting active conversation to global help:', globalHelp);\r\n        setActiveConversation(globalHelp);\r\n      } else if (allConversations.length > 0) {\r\n        console.log('loadConversations: Setting active conversation to first available:', allConversations[0]);\r\n        setActiveConversation(allConversations[0]);\r\n      } else {\r\n        console.log('loadConversations: No conversations available');\r\n      }\r\n      \r\n      // Initialize community features\r\n      const communityDb = await getCommunityDB();\r\n      setCommunityDb(communityDb);\r\n      \r\n      // Load friends and friend requests\r\n      if (communityDb) {\r\n        const userFriends = await communityDb.getFriends(user.id);\r\n        setFriends(userFriends);\r\n        \r\n        const userFriendRequests = await communityDb.getFriendRequests(user.id);\r\n        // Filter to show only pending requests\r\n        const pendingRequests = userFriendRequests.filter((req: any) => req.status === 'pending');\r\n        setFriendRequests(pendingRequests);\r\n        \r\n        // Load profiles for friends\r\n        const friendProfiles: Record<string, Profile> = {};\r\n        for (const friend of userFriends) {\r\n          const friendId = friend.friend_id;\r\n          const profile = await communityDb.getProfile(friendId);\r\n          if (profile) {\r\n            friendProfiles[friendId] = profile;\r\n          }\r\n        }\r\n        \r\n        // Also load profiles for friend request users\r\n        for (const request of pendingRequests) {\r\n          const otherUserId = request.requester_id === user?.id ? request.addressee_id : request.requester_id;\r\n          const profile = await communityDb.getProfile(otherUserId);\r\n          if (profile && !friendProfiles[otherUserId]) {\r\n            friendProfiles[otherUserId] = profile;\r\n          }\r\n        }\r\n        \r\n        setProfiles(friendProfiles);\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to load conversations:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Define loadMessages function outside useEffect\r\n  const loadMessages = async () => {\r\n    if (!activeConversation?.id) {\r\n      console.log('loadMessages: No active conversation, returning');\r\n      setMessages([]);\r\n      return;\r\n    }\r\n    \r\n    console.log('loadMessages: Loading messages for conversation:', activeConversation.id);\r\n    try {\r\n      const messages = await getConversationMessages(activeConversation.id);\r\n      console.log('loadMessages: Got messages:', messages.length, 'messages');\r\n      \r\n      setMessages(messages);\r\n      \r\n      // Update the ref to track the latest message timestamp\r\n      if (messages.length > 0) {\r\n        const latestMessage = messages[messages.length - 1];\r\n        lastCreatedAtRef.current = latestMessage.created_at;\r\n        console.log('loadMessages: Set lastCreatedAtRef to:', latestMessage.created_at);\r\n      }\r\n      \r\n      // Load members for the conversation with proper username sync\r\n      console.log('loadMessages: Loading members for conversation:', activeConversation.id);\r\n      const membersResponse: any = await supabase\r\n        .from('conversation_members')\r\n        .select(`\r\n          user_id,\r\n          role,\r\n          profiles:user_id (\r\n            username,\r\n            email,\r\n            avatar_url\r\n          )\r\n        `)\r\n        .eq('conversation_id', activeConversation.id);\r\n      \r\n      if (membersResponse.error) {\r\n        console.error('loadMessages: Error loading members:', membersResponse.error);\r\n      } else {\r\n        console.log('loadMessages: Got members:', membersResponse.data.length, 'members', membersResponse.data);\r\n        setMembers(membersResponse.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('loadMessages: Error loading messages:', error);\r\n    }\r\n  };\r\n\r\n  // Load messages when active conversation changes\r\n  useEffect(() => {\r\n    loadMessages();\r\n    \r\n    // Set up periodic refresh of member data to ensure latest usernames are shown\r\n    const memberRefreshInterval = setInterval(() => {\r\n      refreshMembers();\r\n    }, 30000); // Refresh every 30 seconds\r\n    \r\n    // Cleanup interval on unmount or conversation change\r\n    return () => {\r\n      clearInterval(memberRefreshInterval);\r\n    };\r\n  }, [activeConversation?.id]);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  };\r\n\r\n  const handleSendMessage = async () => {\r\n    if ((!newMessage.trim() && !attachment) || !activeConversation || !user) {\r\n      console.log('handleSendMessage: Message not sent, validation failed:', { hasMessage: !!newMessage.trim(), hasAttachment: !!attachment, hasActiveConversation: !!activeConversation, hasUser: !!user });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Stop typing indicator\r\n      if (communityDb && activeConversation && user) {\r\n        communityDb.setTypingStatus(activeConversation.id, user.id, false);\r\n      }\r\n      \r\n      // Handle attachment if present\r\n      if (attachment) {\r\n        // Upload file to the attachment API\r\n        const formData = new FormData();\r\n        formData.append('file', attachment);\r\n        formData.append('conversationId', activeConversation.id);\r\n        \r\n        const response = await fetch('/api/upload', {\r\n          method: 'POST',\r\n          body: formData,\r\n        });\r\n        \r\n        if (!response.ok) {\r\n          throw new Error('Upload failed');\r\n        }\r\n        \r\n        const result = await response.json();\r\n        \r\n        // Send a message with the attachment URL\r\n        if (communityDb) {\r\n          await communityDb.createMessage({\r\n            conversation_id: activeConversation.id,\r\n            sender_id: user.id,\r\n            body: newMessage || `Shared a file: ${attachment.name}`,\r\n            attachment_url: result.url,\r\n            attachment_type: attachment.type,\r\n          });\r\n        }\r\n        \r\n        // Reset attachment\r\n        setAttachment(null);\r\n        \r\n        // Clear file input\r\n        const fileInput = document.getElementById('attachment-input') as HTMLInputElement;\r\n        if (fileInput) {\r\n          fileInput.value = '';\r\n        }\r\n      } else {\r\n        // Create a client-generated ID for optimistic update reconciliation\r\n        const clientGeneratedId = crypto.randomUUID();\r\n        \r\n        console.log('handleSendMessage: Attempting to send message:', { userId: user.id, conversationId: activeConversation.id, content: newMessage });\r\n        \r\n        // Create optimistic message\r\n        const optimisticMessage = {\r\n          id: 'optimistic-' + clientGeneratedId,\r\n          conversation_id: activeConversation.id,\r\n          sender_id: user.id,\r\n          content: newMessage,\r\n          created_at: new Date().toISOString(),\r\n          client_generated_id: clientGeneratedId,\r\n          pending: true\r\n        };\r\n        \r\n        // Immediately add optimistic message to UI\r\n        setMessages(prev => {\r\n          console.log('handleSendMessage: Adding optimistic message to UI, previous count:', prev.length);\r\n          const newMessages = [...prev, optimisticMessage];\r\n          console.log('handleSendMessage: Optimistic message added, new count:', newMessages.length);\r\n          return newMessages;\r\n        });\r\n        \r\n        // Clear input immediately\r\n        setNewMessage('');\r\n        \r\n        // Set loading state (only affects button, not message display)\r\n        setMessageLoading(true);\r\n        \r\n        // Check if user is a member of the conversation\r\n        const isMember = await checkConversationMembership(activeConversation.id, user.id);\r\n        console.log('handleSendMessage: User membership check result:', isMember);\r\n        \r\n        if (!isMember) {\r\n          console.log('handleSendMessage: User not a member, ensuring membership via global help API');\r\n          // Ensure membership by calling the global help API again\r\n          await getOrCreateGlobalHelpConversation();\r\n        }\r\n        \r\n        // Send message to Supabase\r\n        const dbMessage = await sendMessage(user.id, activeConversation.id, newMessage, clientGeneratedId);\r\n        console.log('handleSendMessage: Message sent to Supabase, replacing optimistic message with server response:', dbMessage);\r\n        \r\n        // IMMEDIATELY update the UI to replace the optimistic message with the real one\r\n        // This ensures the UI reflects the actual state regardless of real-time delivery\r\n        setMessages(prev => {\r\n          console.log('handleSendMessage: Replacing optimistic message in UI, previous count:', prev.length);\r\n          const updatedMessages = prev.map(msg => {\r\n            if (msg.client_generated_id === clientGeneratedId) {\r\n              console.log('handleSendMessage: Found optimistic message to replace with server response');\r\n              return { ...dbMessage, pending: false };\r\n            }\r\n            return msg;\r\n          });\r\n          console.log('handleSendMessage: Optimistic message replaced, new count:', updatedMessages.length);\r\n          return updatedMessages;\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to send message:', err);\r\n      \r\n      // Show error to user\r\n      setErrorMessage('Message failed to send. Please try again.');\r\n      setTimeout(() => setErrorMessage(null), 3000); // Clear error after 3 seconds\r\n    } finally {\r\n      setMessageLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleKeyPress = (e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault();\r\n      handleSendMessage();\r\n    }\r\n  };\r\n\r\n  const handleReload = () => {\r\n    window.location.reload();\r\n  };\r\n\r\n  // Function to refresh member data to ensure latest usernames are shown\r\n  const refreshMembers = async () => {\r\n    if (!activeConversation?.id) return;\r\n    \r\n    try {\r\n      console.log('refreshMembers: Refreshing member data for conversation:', activeConversation.id);\r\n      const membersResponse = await supabase\r\n        .from('conversation_members')\r\n        .select(`\r\n          user_id,\r\n          role,\r\n          profiles:user_id (\r\n            username,\r\n            email,\r\n            avatar_url\r\n          )\r\n        `)\r\n        .eq('conversation_id', activeConversation.id);\r\n      \r\n      if (membersResponse.error) {\r\n        console.error('refreshMembers: Error refreshing members:', membersResponse.error);\r\n      } else {\r\n        console.log('refreshMembers: Refreshed members:', membersResponse.data.length, 'members');\r\n        setMembers(membersResponse.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('refreshMembers: Unexpected error:', error);\r\n    }\r\n  };\r\n\r\n  // Handle username changes broadcast from other tabs\r\n  useEffect(() => {\r\n    console.log('Setting up profile change listener');\r\n    const profileChannel = new BroadcastChannel('profile_changes');\r\n    \r\n    const handleProfileChange = (event: MessageEvent) => {\r\n      console.log('handleProfileChange: Received message from broadcast channel:', event.data);\r\n      if (event.data.type === 'USERNAME_CHANGED' && event.data.userId) {\r\n        console.log('handleProfileChange: Processing username change:', event.data);\r\n        \r\n        // Update the members state to reflect the new username\r\n        setMembers(prevMembers => {\r\n          console.log('handleProfileChange: Updating members with new username', {\r\n            userId: event.data.userId,\r\n            newUsername: event.data.newUsername,\r\n            oldMembers: prevMembers\r\n          });\r\n          \r\n          const updatedMembers = prevMembers.map(member => {\r\n            if (member.user_id === event.data.userId) {\r\n              console.log('handleProfileChange: Found matching member to update', {\r\n                oldUsername: member.profiles?.username,\r\n                newUsername: event.data.newUsername\r\n              });\r\n              \r\n              return {\r\n                ...member,\r\n                profiles: {\r\n                  ...member.profiles,\r\n                  username: event.data.newUsername\r\n                }\r\n              };\r\n            }\r\n            return member;\r\n          });\r\n          \r\n          console.log('handleProfileChange: Updated members result', updatedMembers);\r\n          return updatedMembers;\r\n        });\r\n        \r\n        // Update messages to reflect the new username\r\n        setMessages(prevMessages => {\r\n          return prevMessages.map(message => {\r\n            if (message.sender_id === event.data.userId) {\r\n              console.log('handleProfileChange: Updating message username', {\r\n                oldUsername: message.username,\r\n                newUsername: event.data.newUsername\r\n              });\r\n              return {\r\n                ...message,\r\n                username: event.data.newUsername\r\n              };\r\n            }\r\n            return message;\r\n          });\r\n        });\r\n        \r\n        console.log('handleProfileChange: Updated both members and messages');\r\n      }\r\n    };\r\n    \r\n    profileChannel.onmessage = handleProfileChange;\r\n    \r\n    // Cleanup\r\n    return () => {\r\n      console.log('Cleaning up profile change listener');\r\n      profileChannel.close();\r\n    };\r\n  }, [members]); // Include members in the dependency array to ensure latest members data\r\n  \r\n  // Subscribe to profile updates in real-time\r\n  useEffect(() => {\r\n    console.log('Setting up real-time profile updates subscription');\r\n    \r\n    const profileUpdatesChannel = supabase\r\n      .channel('profile-updates')\r\n      .on(\r\n        'postgres_changes',\r\n        {\r\n          event: 'UPDATE',\r\n          schema: 'public',\r\n          table: 'profiles'\r\n        },\r\n        (payload: any) => {\r\n          console.log('Real-time profile update received:', payload);\r\n          \r\n          // Update the members state to reflect the new username\r\n          setMembers(prevMembers => {\r\n            return prevMembers.map(member => {\r\n              if (member.user_id === payload.new.id) {\r\n                console.log('Updating member profile with new data:', {\r\n                  oldUsername: member.profiles?.username,\r\n                  newUsername: payload.new.username\r\n                });\r\n                \r\n                return {\r\n                  ...member,\r\n                  profiles: {\r\n                    ...member.profiles,\r\n                    username: payload.new.username,\r\n                    avatar_url: payload.new.avatar_url\r\n                  }\r\n                };\r\n              }\r\n              return member;\r\n            });\r\n          });\r\n          \r\n          // Update messages to reflect the new username\r\n          setMessages(prevMessages => {\r\n            return prevMessages.map(message => {\r\n              if (message.sender_id === payload.new.id) {\r\n                console.log('Updating message username from real-time profile update', {\r\n                  oldUsername: message.username,\r\n                  newUsername: payload.new.username\r\n                });\r\n                return {\r\n                  ...message,\r\n                  username: payload.new.username,\r\n                  avatar_url: payload.new.avatar_url\r\n                };\r\n              }\r\n              return message;\r\n            });\r\n          });\r\n        }\r\n      )\r\n      .subscribe();\r\n    \r\n    // Cleanup\r\n    return () => {\r\n      console.log('Cleaning up real-time profile updates subscription');\r\n      supabase.removeChannel(profileUpdatesChannel);\r\n    };\r\n  }, []); // Empty dependency array since this subscription should only be set up once\r\n\r\n  if (loading) {\r\n    return (\r\n      <ProtectedRoute>\r\n        <AppShell>\r\n          <div className=\"flex items-center justify-center h-full\">\r\n            <div className=\"text-2xl font-bold text-accent-primary\">Loading chat...</div>\r\n          </div>\r\n        </AppShell>\r\n      </ProtectedRoute>\r\n    );\r\n  }\r\n\r\n  if (!user) {\r\n    // Redirect to login if no user\r\n    return <ProtectedRoute><div>Redirecting...</div></ProtectedRoute>;\r\n  }\r\n\r\n  return (\r\n    <ProtectedRoute>\r\n      <AppShell>\r\n        {/* Session conflict warning banner */}\r\n        {showSessionWarning && (\r\n          <div className=\"fixed top-16 left-0 right-0 z-50 bg-yellow-900 border-b border-yellow-700 p-2 text-center\">\r\n            <p className=\"text-yellow-200 text-sm\">\r\n              Multiple accounts in same browser profile share one session. Use different profiles for isolation.\r\n            </p>\r\n          </div>\r\n        )}\r\n        \r\n\r\n        \r\n        <div className=\"flex h-full bg-background\">\r\n          {/* Left sidebar - Conversations list */}\r\n          <div className=\"w-80 bg-card-bg border-r border-card-border flex flex-col\">\r\n            <div className=\"p-4 border-b border-card-border\">\r\n              <h2 className=\"text-lg font-bold text-white flex items-center gap-2\">\r\n                <MessageCircle className=\"text-accent-primary\" size={20} />\r\n                Conversations\r\n              </h2>\r\n            </div>\r\n            \r\n            <div className=\"p-3\">\r\n              <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500\" size={16} />\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Search conversations...\"\r\n                  className=\"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-accent-primary focus:border-transparent\"\r\n                />\r\n              </div>\r\n              \r\n              <button className=\"w-full mt-3 flex items-center justify-center gap-2 py-2 bg-accent-primary text-white rounded-lg hover:bg-accent-primary/90 transition-colors hover-lift border border-accent-primary\">\r\n                <Plus size={16} />\r\n                New Conversation\r\n              </button>\r\n            </div>\r\n            \r\n            <div className=\"flex-1 overflow-y-auto\">\r\n              <div className=\"p-2\">\r\n                <h3 className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider px-2 py-1\">Channels</h3>\r\n                <div\r\n                  className={`p-3 rounded-lg cursor-pointer mb-1 flex items-center gap-3 ${\r\n                    activeConversation?.name === 'Global Help'\r\n                      ? 'bg-accent-primary/10 border border-accent-primary'\r\n                      : 'hover:bg-gray-800'\r\n                  }`}\r\n                  onClick={() => {\r\n                    const globalHelp = conversations.find(c => c.name === 'Global Help');\r\n                    setActiveConversation(globalHelp);\r\n                  }}\r\n                >\r\n                  <Hash className=\"text-accent-primary\" size={18} />\r\n                  <div>\r\n                    <p className=\"font-medium text-white\">Global Help</p>\r\n                    <p className=\"text-xs text-gray-500\">General help channel</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"p-2 border-t border-gray-800\">\r\n                <h3 className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider px-2 py-1\">Direct Messages</h3>\r\n                <div className=\"space-y-1\">\r\n                  {conversations\r\n                    .filter(c => c.type === 'dm')\r\n                    .map(conversation => (\r\n                      <div\r\n                        key={conversation.id}\r\n                        className={`p-3 rounded-lg cursor-pointer mb-1 flex items-center gap-3 ${\r\n                          activeConversation?.id === conversation.id\r\n                            ? 'bg-accent-primary/10 border border-accent-primary'\r\n                            : 'hover:bg-gray-800'\r\n                        }`}\r\n                        onClick={() => setActiveConversation(conversation)}\r\n                      >\r\n                        <User className=\"text-gray-400\" size={18} />\r\n                        <div>\r\n                          <p className=\"font-medium text-white\">DM</p>\r\n                          <p className=\"text-xs text-gray-500\">Direct message</p>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  \r\n                  {/* New DM button */}\r\n                  <button \r\n                    className=\"w-full p-3 rounded-lg cursor-pointer flex items-center gap-3 hover:bg-gray-800 hover-lift\"\r\n                    onClick={async () => {\r\n                      const username = prompt('Enter username to start a DM with:');\r\n                      if (username && user) {\r\n                        try {\r\n                          const targetUser = await getUserByUsername(username);\r\n                          // The targetUser will have id property from the updated query\r\n                          if (targetUser && targetUser.id !== user.id) {\r\n                            const dmConversation = await createDirectMessageConversation(user.id, targetUser.id);\r\n                            setConversations(prev => [...prev, dmConversation]);\r\n                            setActiveConversation(dmConversation);\r\n                          } else {\r\n                            alert('User not found or cannot message yourself');\r\n                          }\r\n                        } catch (err) {\r\n                          console.error('Failed to create DM:', err);\r\n                          alert('Failed to create DM: ' + (err as Error).message);\r\n                        }\r\n                      }\r\n                    }}\r\n                  >\r\n                    <Plus className=\"text-gray-400\" size={18} />\r\n                    <div>\r\n                      <p className=\"font-medium text-white\">New DM</p>\r\n                      <p className=\"text-xs text-gray-500\">Start a new conversation</p>\r\n                    </div>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Main chat area with friends panel and members sidebar */}\r\n          <div className=\"flex-1 flex\">\r\n            {/* Friends Panel - Collapsible */}\r\n            {showFriendsPanel && (\r\n              <div className=\"w-80 bg-card-bg border-r border-card-border flex flex-col\">\r\n                <div className=\"p-4 border-b border-card-border flex justify-between items-center\">\r\n                  <h2 className=\"text-lg font-bold text-white flex items-center gap-2\">\r\n                    <Users className=\"text-accent-primary\" size={20} />\r\n                    Community\r\n                  </h2>\r\n                  <button \r\n                    onClick={() => setShowFriendsPanel(false)}\r\n                    className=\"text-gray-400 hover:text-white\"\r\n                  >\r\n                    <UserX size={20} />\r\n                  </button>\r\n                </div>\r\n                \r\n                <div className=\"flex-1 overflow-y-auto p-4\">\r\n                  <div className=\"space-y-6\">\r\n                    {/* Friends Section */}\r\n                    <div>\r\n                      <div className=\"flex justify-between items-center mb-3\">\r\n                        <h3 className=\"text-md font-semibold text-white flex items-center gap-2\">\r\n                          <UserCheck className=\"text-accent-primary\" size={16} />\r\n                          Friends ({friends.length})\r\n                        </h3>\r\n                        <button \r\n                          onClick={async () => {\r\n                            // Create a group chat with friends\r\n                            if (communityDb && user) {\r\n                              try {\r\n                                // Create a group conversation\r\n                                const groupConversation = await communityDb.createConversation(true, user.id, 'My Group Chat', []);\r\n                                setConversations(prev => [...prev, groupConversation]);\r\n                                setActiveConversation(groupConversation);\r\n                                setShowFriendsPanel(false); // Close panel after selecting\r\n                              } catch (error) {\r\n                                console.error('Failed to create group chat:', error);\r\n                              }\r\n                            }\r\n                          }}\r\n                          className=\"text-xs bg-accent-primary/20 hover:bg-accent-primary/30 text-accent-primary px-2 py-1 rounded\"\r\n                        >\r\n                          Create Group\r\n                        </button>\r\n                      </div>\r\n                      <div className=\"space-y-2\">\r\n                        {friends.length > 0 ? (\r\n                          friends.map((friend: any) => {\r\n                            const friendId = friend.friend_id;\r\n                            const profile = profiles[friendId];\r\n                            const displayName = profile?.username || `User ${friendId.substring(0, 8)}`;\r\n                            const displayAvatar = profile?.avatar_url || displayName.charAt(0).toUpperCase();\r\n                            \r\n                            return (\r\n                              <div key={friendId} className=\"flex items-center gap-3 p-2 rounded-lg hover:bg-gray-800\">\r\n                                <div className=\"w-8 h-8 rounded-full bg-gradient-to-br from-accent-primary to-purple-600 flex items-center justify-center text-white text-xs font-bold\">\r\n                                  {typeof displayAvatar === 'string' && displayAvatar.startsWith('http') ? (\r\n                                    <img src={displayAvatar} alt={displayName} className=\"w-full h-full rounded-full object-cover\" />\r\n                                  ) : (\r\n                                    <span>{displayAvatar}</span>\r\n                                  )}\r\n                                </div>\r\n                                <div className=\"flex-1\">\r\n                                  <p className=\"font-medium text-white text-sm\">{displayName}</p>\r\n                                  <p className=\"text-xs text-gray-500\">{profile?.display_name || 'Online'}</p>\r\n                                </div>\r\n                                <button \r\n                                  onClick={async () => {\r\n                                    // Create DM with friend\r\n                                    if (communityDb && user) {\r\n                                      try {\r\n                                        const dmConversation = await createDirectMessageConversation(user.id, friendId);\r\n                                        setConversations(prev => [...prev, dmConversation]);\r\n                                        setActiveConversation(dmConversation);\r\n                                        setShowFriendsPanel(false); // Close panel after selecting\r\n                                      } catch (error) {\r\n                                        console.error('Failed to create DM:', error);\r\n                                      }\r\n                                    }\r\n                                  }}\r\n                                  className=\"p-1 rounded hover:bg-gray-700\"\r\n                                >\r\n                                  <MessageCircle size={16} />\r\n                                </button>\r\n                              </div>\r\n                            );\r\n                          })\r\n                        ) : (\r\n                          <p className=\"text-gray-500 text-sm py-2\">No friends yet</p>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    {/* Friend Requests Section */}\r\n                    <div>\r\n                      <h3 className=\"text-md font-semibold text-white mb-3 flex items-center gap-2\">\r\n                        <UserPlus className=\"text-accent-primary\" size={16} />\r\n                        Requests ({friendRequests.length})\r\n                      </h3>\r\n                      <div className=\"space-y-2\">\r\n                        {friendRequests.length > 0 ? (\r\n                          friendRequests.map((request: any) => {\r\n                            const isOutgoing = request.requester_id === user?.id;\r\n                            const otherUserId = isOutgoing ? request.addressee_id : request.requester_id;\r\n                            \r\n                            // Get profile from loaded profiles\r\n                            const otherUserProfile = profiles[otherUserId];\r\n                            const displayName = otherUserProfile?.username || `User ${otherUserId.substring(0, 8)}`;\r\n                            const displayAvatar = otherUserProfile?.avatar_url || displayName.charAt(0).toUpperCase();\r\n                            \r\n                            return (\r\n                              <div key={request.id} className=\"flex items-center gap-3 p-2 rounded-lg bg-gray-800\">\r\n                                <div className=\"w-8 h-8 rounded-full bg-gradient-to-br from-accent-primary to-purple-600 flex items-center justify-center text-white text-xs font-bold\">\r\n                                  {typeof displayAvatar === 'string' && displayAvatar.startsWith('http') ? (\r\n                                    <img src={displayAvatar} alt={displayName} className=\"w-full h-full rounded-full object-cover\" />\r\n                                  ) : (\r\n                                    <span>{displayAvatar}</span>\r\n                                  )}\r\n                                </div>\r\n                                <div className=\"flex-1\">\r\n                                  <p className=\"font-medium text-white text-sm\">{displayName}</p>\r\n                                  <p className=\"text-xs text-gray-500\">{isOutgoing ? 'Sent' : 'Received'}</p>\r\n                                </div>\r\n                                {!isOutgoing && (\r\n                                  <div className=\"flex gap-1\">\r\n                                    <button \r\n                                      onClick={async () => {\r\n                                        if (communityDb) {\r\n                                          await communityDb.updateFriendRequest(request.id, 'accepted');\r\n                                          // Refresh requests\r\n                                          const updatedRequests = await communityDb.getFriendRequests(user.id);\r\n                                          setFriendRequests(updatedRequests.filter((req: any) => req.status === 'pending'));\r\n                                          // Add to friends list\r\n                                          const newFriend = { user_id: user.id, friend_id: otherUserId, created_at: new Date().toISOString() };\r\n                                          setFriends(prev => [...prev, newFriend]);\r\n                                          \r\n                                          // Add profile to profiles\r\n                                          if (otherUserProfile) {\r\n                                            setProfiles(prev => ({ ...prev, [otherUserId]: otherUserProfile }));\r\n                                          }\r\n                                        }\r\n                                      }}\r\n                                      className=\"p-1 rounded bg-green-600 hover:bg-green-500\"\r\n                                    >\r\n                                      <UserCheck size={14} />\r\n                                    </button>\r\n                                    <button \r\n                                      onClick={async () => {\r\n                                        if (communityDb) {\r\n                                          await communityDb.updateFriendRequest(request.id, 'declined');\r\n                                          // Refresh requests\r\n                                          const updatedRequests = await communityDb.getFriendRequests(user.id);\r\n                                          setFriendRequests(updatedRequests.filter((req: any) => req.status === 'pending'));\r\n                                        }\r\n                                      }}\r\n                                      className=\"p-1 rounded bg-red-600 hover:bg-red-500\"\r\n                                    >\r\n                                      <UserX size={14} />\r\n                                    </button>\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n                            );\r\n                          })\r\n                        ) : (\r\n                          <p className=\"text-gray-500 text-sm py-2\">No pending requests</p>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    {/* Add Friend Section */}\r\n                    <div>\r\n                      <h3 className=\"text-md font-semibold text-white mb-3 flex items-center gap-2\">\r\n                        <UserSearch className=\"text-accent-primary\" size={16} />\r\n                        Add Friend\r\n                      </h3>\r\n                      <div className=\"flex gap-2\">\r\n                        <input\r\n                          type=\"text\"\r\n                          placeholder=\"Username\"\r\n                          value={searchUsername}\r\n                          onChange={(e) => setSearchUsername(e.target.value)}\r\n                          className=\"flex-1 bg-gray-800 text-white rounded px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-accent-primary\"\r\n                          onKeyPress={async (e) => {\r\n                            if (e.key === 'Enter' && communityDb && searchUsername.trim()) {\r\n                              setLoadingSearch(true);\r\n                              try {\r\n                                const results = await communityDb.searchProfiles(searchUsername.trim());\r\n                                setSearchResults(results);\r\n                              } catch (error) {\r\n                                console.error('Error searching profiles:', error);\r\n                              } finally {\r\n                                setLoadingSearch(false);\r\n                              }\r\n                            }\r\n                          }}\r\n                        />\r\n                        <button \r\n                          className=\"px-3 py-2 bg-accent-primary text-white rounded text-sm hover:bg-accent-primary/90 border border-accent-primary\"\r\n                          onClick={async () => {\r\n                            if (communityDb && searchUsername.trim()) {\r\n                              setLoadingSearch(true);\r\n                              try {\r\n                                const results = await communityDb.searchProfiles(searchUsername.trim());\r\n                                setSearchResults(results);\r\n                              } catch (error) {\r\n                                console.error('Error searching profiles:', error);\r\n                              } finally {\r\n                                setLoadingSearch(false);\r\n                              }\r\n                            }\r\n                          }}\r\n                        >\r\n                          {loadingSearch ? 'Searching...' : 'Search'}\r\n                        </button>\r\n                      </div>\r\n                      \r\n                      {searchResults.length > 0 && (\r\n                        <div className=\"mt-3 space-y-2 max-h-40 overflow-y-auto\">\r\n                          {searchResults.map((result: any) => {\r\n                            const isAlreadyFriend = friends.some(f => f.friend_id === result.id);\r\n                            const isOwnProfile = result.id === user?.id;\r\n                            const hasSentRequest = friendRequests.some(req => \r\n                              req.requester_id === user?.id && req.addressee_id === result.id\r\n                            );\r\n                            \r\n                            return (\r\n                              <div key={result.id} className=\"flex items-center gap-3 p-2 rounded-lg bg-gray-800\">\r\n                                <div className=\"w-8 h-8 rounded-full bg-gradient-to-br from-accent-primary to-purple-600 flex items-center justify-center text-white text-xs font-bold\">\r\n                                  {typeof result.avatar_url === 'string' && result.avatar_url.startsWith('http') ? (\r\n                                    <img src={result.avatar_url} alt={result.username} className=\"w-full h-full rounded-full object-cover\" />\r\n                                  ) : (\r\n                                    <span>{result.username.charAt(0).toUpperCase()}</span>\r\n                                  )}\r\n                                </div>\r\n                                <div className=\"flex-1\">\r\n                                  <p className=\"font-medium text-white text-sm\">{result.username}</p>\r\n                                  <p className=\"text-xs text-gray-500\">{result.display_name}</p>\r\n                                </div>\r\n                                {!isAlreadyFriend && !isOwnProfile && !hasSentRequest && (\r\n                                  <button \r\n                                    onClick={async () => {\r\n                                      if (communityDb && user) {\r\n                                        try {\r\n                                          await communityDb.createFriendRequest(user.id, result.id);\r\n                                          setToastMessage('Friend request sent!');\r\n                                          setShowToast(true);\r\n                                          setTimeout(() => setShowToast(false), 3000);\r\n                                        } catch (error) {\r\n                                          console.error('Error sending friend request:', error);\r\n                                          setToastMessage('Failed to send friend request');\r\n                                          setShowToast(true);\r\n                                          setTimeout(() => setShowToast(false), 3000);\r\n                                        }\r\n                                      }\r\n                                    }}\r\n                                    className=\"p-1 rounded bg-accent-primary hover:bg-accent-primary/90 mr-1\"\r\n                                  >\r\n                                    <UserPlus size={14} />\r\n                                  </button>\r\n                                )}\r\n                                {(isAlreadyFriend || isOwnProfile) && (\r\n                                  <span className=\"text-xs text-gray-500\">\r\n                                    {isOwnProfile ? 'You' : 'Friend'}\r\n                                  </span>\r\n                                )}\r\n                                {hasSentRequest && (\r\n                                  <span className=\"text-xs text-yellow-500\">\r\n                                    Sent\r\n                                  </span>\r\n                                )}\r\n                                {isAlreadyFriend && (\r\n                                  <button \r\n                                    onClick={async () => {\r\n                                      // Create DM with friend\r\n                                      if (communityDb && user) {\r\n                                        try {\r\n                                          const dmConversation = await createDirectMessageConversation(user.id, result.id);\r\n                                          setConversations(prev => [...prev, dmConversation]);\r\n                                          setActiveConversation(dmConversation);\r\n                                          setShowFriendsPanel(false); // Close panel after selecting\r\n                                        } catch (error) {\r\n                                          console.error('Failed to create DM:', error);\r\n                                        }\r\n                                      }\r\n                                    }}\r\n                                    className=\"p-1 rounded hover:bg-gray-700\"\r\n                                  >\r\n                                    <MessageCircle size={14} />\r\n                                  </button>\r\n                                )}\r\n                              </div>\r\n                            );\r\n                          })}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            <div className=\"flex-1 flex flex-col\">\r\n              {/* Community Tab Navigation */}\r\n              <div className=\"h-16 bg-card-bg border-b border-card-border flex items-center px-6\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  {/* Toggle Friends Panel Button */}\r\n                  <button \r\n                    onClick={() => setShowFriendsPanel(!showFriendsPanel)}\r\n                    className=\"mr-2 p-2 rounded hover:bg-gray-800\"\r\n                    title=\"Community\"\r\n                  >\r\n                    <Users size={20} />\r\n                  </button>\r\n                  \r\n                  {/* Community Tabs */}\r\n                  <div className=\"flex space-x-1\">\r\n                    <button\r\n                      className={`px-3 py-1 rounded-md text-sm ${activeCommunityTab === 'chat' ? 'bg-accent-primary text-white border border-accent-primary' : 'text-gray-400 hover:text-white'}`}\r\n                      onClick={() => setActiveCommunityTab('chat')}\r\n                    >\r\n                      Chat\r\n                    </button>\r\n                    <button\r\n                      className={`px-3 py-1 rounded-md text-sm ${activeCommunityTab === 'discover' ? 'bg-accent-primary text-white border border-accent-primary' : 'text-gray-400 hover:text-white'}`}\r\n                      onClick={() => setActiveCommunityTab('discover')}\r\n                    >\r\n                      Discover\r\n                    </button>\r\n                    <button\r\n                      className={`px-3 py-1 rounded-md text-sm ${activeCommunityTab === 'friends' ? 'bg-accent-primary text-white border border-accent-primary' : 'text-gray-400 hover:text-white'}`}\r\n                      onClick={() => setActiveCommunityTab('friends')}\r\n                    >\r\n                      Friends\r\n                    </button>\r\n                    <button\r\n                      className={`px-3 py-1 rounded-md text-sm ${activeCommunityTab === 'requests' ? 'bg-accent-primary text-white border border-accent-primary' : 'text-gray-400 hover:text-white'}`}\r\n                      onClick={() => setActiveCommunityTab('requests')}\r\n                    >\r\n                      Requests\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n                \r\n                {/* Realtime status indicator */}\r\n                <div className=\"ml-auto flex items-center gap-2\">\r\n                  <div className={`w-2 h-2 rounded-full ${\r\n                    realtimeStatus === 'subscribed' ? 'bg-green-500' : \r\n                    realtimeStatus === 'error' || realtimeStatus === 'closed' ? 'bg-red-500' : 'bg-yellow-500'\r\n                  }`}></div>\r\n                  <span className=\"text-xs text-gray-400\">\r\n                    {realtimeStatus === 'subscribed' ? 'Connected' : \r\n                     realtimeStatus === 'error' || realtimeStatus === 'closed' ? 'Reconnecting...' : 'Connecting...'}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Tab Content Area */}\r\n              <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\r\n                {activeCommunityTab === 'chat' && (\r\n                  <>\r\n                    {messages.map((message, index) => {\r\n                      const isMe = message.sender_id === user?.id;\r\n                      const senderProfile = members.find(member => member.user_id === message.sender_id)?.profiles;\r\n                      const displayName = isMe ? 'You' : message.username || senderProfile?.username || senderProfile?.email?.split('@')[0] || 'Unknown User';\r\n                      const displayAvatar = message.avatar_url || senderProfile?.avatar_url || (message.username?.charAt(0).toUpperCase() || senderProfile?.username?.charAt(0).toUpperCase() || 'M');\r\n                      \r\n                      // Log message rendering\r\n                      console.log('SocialPage: Rendering message', index, 'ID:', message.id, 'Content:', message.content, 'Sender:', message.sender_id, 'IsMe:', isMe);\r\n                      \r\n                      return (\r\n                      <div key={message.id} className=\"flex gap-3\">\r\n                        <div className=\"w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center flex-shrink-0\">\r\n                          {typeof displayAvatar === 'string' && displayAvatar.startsWith('http') ? (\r\n                            <img src={displayAvatar} alt={displayName} className=\"w-full h-full rounded-full object-cover\" />\r\n                          ) : (\r\n                            <span className=\"text-accent-primary font-bold\">{displayAvatar}</span>\r\n                          )}\r\n                        </div>\r\n                        \r\n                        <div className=\"flex-1\">\r\n                          <div className=\"flex items-baseline gap-2\">\r\n                            <span className=\"font-medium text-white\">{displayName}</span>\r\n                            <span className=\"text-xs text-gray-500\">\r\n                              {new Date(message.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                            </span>\r\n                            {message.read_at && (\r\n                              <span className=\"text-xs text-blue-400\">\r\n                                \r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                          <div className={`mt-1 text-gray-300 bg-gray-800 p-3 rounded-lg max-w-3xl ${\r\n                            message.pending ? 'opacity-60 italic' : ''\r\n                          }`}>\r\n                            {message.is_attachment_upload ? (\r\n                              <div className=\"flex items-center gap-2\">\r\n                                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-accent-primary\"></div>\r\n                                <span>{message.content}</span>\r\n                              </div>\r\n                            ) : (\r\n                              <>\r\n                                <div>\r\n                                  {message.content}\r\n                                </div>\r\n                                {message.attachment_url && (\r\n                                  <div className=\"mt-2\">\r\n                                    {message.attachment_type?.startsWith('image/') ? (\r\n                                      <img \r\n                                        src={message.attachment_url} \r\n                                        alt=\"Attachment\" \r\n                                        className=\"max-w-xs max-h-48 rounded-lg border border-gray-700\"\r\n                                        onError={(e) => {\r\n                                          const target = e.target as HTMLImageElement;\r\n                                          target.onerror = null; // prevents infinite loop\r\n                                          target.style.display = 'none'; // hide broken image\r\n                                          target.previousElementSibling?.classList.add('text-red-500'); // add error to text\r\n                                        }}\r\n                                      />\r\n                                    ) : (\r\n                                      <a \r\n                                        href={message.attachment_url}\r\n                                        target=\"_blank\"\r\n                                        rel=\"noopener noreferrer\"\r\n                                        className=\"inline-flex items-center gap-2 text-blue-400 hover:text-blue-300\"\r\n                                      >\r\n                                        <FileIcon size={16} />\r\n                                        Download File\r\n                                      </a>\r\n                                    )}\r\n                                  </div>\r\n                                )}\r\n                                {message.pending && <span className=\"ml-2 text-xs text-gray-400\">Sending...</span>}\r\n                              </>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      )})}\r\n                    <div ref={messagesEndRef} />\r\n                    \r\n                    {/* Typing indicators */}\r\n                    {Object.entries(typingUsers).length > 0 && (\r\n                      <div className=\"px-4 py-2 text-sm text-gray-400 flex items-center\">\r\n                        <div className=\"flex space-x-1\">\r\n                          {[...Array(3)].map((_, i) => (\r\n                            <div \r\n                              key={i} \r\n                              className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\"\r\n                              style={{ animationDelay: `${i * 0.1}s` }}\r\n                            ></div>\r\n                          ))}\r\n                        </div>\r\n                        <span className=\"ml-2\">\r\n                          {Object.keys(typingUsers).length === 1 \r\n                            ? 'Someone is typing...' \r\n                            : `${Object.keys(typingUsers).length} people are typing...`}\r\n                        </span>\r\n                      </div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                \r\n                {activeCommunityTab === 'discover' && (\r\n                  <div className=\"space-y-6\">\r\n                    <div className=\"relative\">\r\n                      <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                        <Search className=\"h-5 w-5 text-gray-400\" />\r\n                      </div>\r\n                      <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search users by username or display name...\"\r\n                        value={searchUsername}\r\n                        onChange={(e) => setSearchUsername(e.target.value)}\r\n                        className=\"block w-full pl-10 pr-3 py-2 border border-gray-700 rounded-lg bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent-primary focus:border-transparent\"\r\n                        onKeyPress={async (e) => {\r\n                          if (e.key === 'Enter' && communityDb && searchUsername.trim()) {\r\n                            setLoadingSearch(true);\r\n                            try {\r\n                              const results = await communityDb.searchProfiles(searchUsername.trim());\r\n                              setSearchResults(results);\r\n                            } catch (error) {\r\n                              console.error('Error searching profiles:', error);\r\n                            } finally {\r\n                              setLoadingSearch(false);\r\n                            }\r\n                          }\r\n                        }}\r\n                      />\r\n                    </div>\r\n                    <button \r\n                      className=\"px-4 py-2 bg-accent-primary text-white rounded-lg hover:bg-accent-primary/90 border border-accent-primary\"\r\n                      onClick={async () => {\r\n                        if (communityDb && searchUsername.trim()) {\r\n                          setLoadingSearch(true);\r\n                          try {\r\n                            const results = await communityDb.searchProfiles(searchUsername.trim());\r\n                            setSearchResults(results);\r\n                          } catch (error) {\r\n                            console.error('Error searching profiles:', error);\r\n                          } finally {\r\n                            setLoadingSearch(false);\r\n                          }\r\n                        }\r\n                      }}\r\n                    >\r\n                      {loadingSearch ? 'Searching...' : 'Search Users'}\r\n                    </button>\r\n                    \r\n                    <div className=\"space-y-3\">\r\n                      {searchResults.length > 0 ? (\r\n                        searchResults.map((result: any) => {\r\n                          const isAlreadyFriend = friends.some(f => f.friend_id === result.id);\r\n                          const isOwnProfile = result.id === user?.id;\r\n                          const hasSentRequest = friendRequests.some(req => \r\n                            req.requester_id === user?.id && req.addressee_id === result.id\r\n                          );\r\n                          \r\n                          return (\r\n                            <div key={result.id} className=\"flex items-center gap-3 p-3 rounded-lg bg-gray-800\">\r\n                              <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-accent-primary to-purple-600 flex items-center justify-center text-white font-bold\">\r\n                                {typeof result.avatar_url === 'string' && result.avatar_url.startsWith('http') ? (\r\n                                  <img src={result.avatar_url} alt={result.username} className=\"w-full h-full rounded-full object-cover\" />\r\n                                ) : (\r\n                                  <span>{result.username.charAt(0).toUpperCase()}</span>\r\n                                )}\r\n                              </div>\r\n                              <div className=\"flex-1 min-w-0\">\r\n                                <p className=\"font-medium text-white truncate\">{result.username}</p>\r\n                                <p className=\"text-xs text-gray-400 truncate\">{result.display_name}</p>\r\n                              </div>\r\n                              {!isAlreadyFriend && !isOwnProfile && !hasSentRequest && (\r\n                                <button \r\n                                  onClick={async () => {\r\n                                    if (communityDb && user) {\r\n                                      try {\r\n                                        await communityDb.createFriendRequest(user.id, result.id);\r\n                                        setToastMessage('Friend request sent!');\r\n                                        setShowToast(true);\r\n                                        setTimeout(() => setShowToast(false), 3000);\r\n                                      } catch (error) {\r\n                                        console.error('Error sending friend request:', error);\r\n                                        setToastMessage('Failed to send friend request');\r\n                                        setShowToast(true);\r\n                                        setTimeout(() => setShowToast(false), 3000);\r\n                                      }\r\n                                    }\r\n                                  }}\r\n                                  className=\"px-3 py-1 bg-accent-primary text-white rounded text-sm hover:bg-accent-primary/90 border border-accent-primary\"\r\n                                >\r\n                                  Add Friend\r\n                                </button>\r\n                              )}\r\n                              {isAlreadyFriend && (\r\n                                <button \r\n                                  onClick={async () => {\r\n                                    // Create DM with friend\r\n                                    if (communityDb && user) {\r\n                                      try {\r\n                                        const dmConversation = await createDirectMessageConversation(user.id, result.id);\r\n                                        setConversations(prev => [...prev, dmConversation]);\r\n                                        setActiveConversation(dmConversation);\r\n                                      } catch (error) {\r\n                                        console.error('Failed to create DM:', error);\r\n                                      }\r\n                                    }\r\n                                  }}\r\n                                  className=\"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-500\"\r\n                                >\r\n                                  Message\r\n                                </button>\r\n                              )}\r\n                              {(isOwnProfile) && (\r\n                                <span className=\"px-3 py-1 bg-gray-600 text-gray-300 rounded text-sm\">\r\n                                  You\r\n                                </span>\r\n                              )}\r\n                              {hasSentRequest && (\r\n                                <span className=\"px-3 py-1 bg-yellow-600 text-yellow-100 rounded text-sm\">\r\n                                  Pending\r\n                                </span>\r\n                              )}\r\n                            </div>\r\n                          );\r\n                        })\r\n                      ) : (\r\n                        <div className=\"text-center py-8 text-gray-500\">\r\n                          <p>Search for users to connect with them</p>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                \r\n                {activeCommunityTab === 'friends' && (\r\n                  <div className=\"space-y-6\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <h2 className=\"text-xl font-semibold\">Friends ({friends.length})</h2>\r\n                      <button \r\n                        onClick={async () => {\r\n                          // Create a group chat with friends\r\n                          if (communityDb && user) {\r\n                            try {\r\n                              // Create a group conversation\r\n                              const groupConversation = await communityDb.createConversation(true, user.id, 'My Group Chat', []);\r\n                              setConversations(prev => [...prev, groupConversation]);\r\n                              setActiveConversation(groupConversation);\r\n                            } catch (error) {\r\n                              console.error('Failed to create group chat:', error);\r\n                            }\r\n                          }\r\n                        }}\r\n                        className=\"px-4 py-2 bg-accent-primary text-white rounded-lg hover:bg-accent-primary/90 text-sm border border-accent-primary\"\r\n                      >\r\n                        Create Group\r\n                      </button>\r\n                    </div>\r\n                    \r\n                    <div className=\"space-y-3\">\r\n                      {friends.length > 0 ? (\r\n                        friends.map((friend: any) => {\r\n                          const friendId = friend.friend_id;\r\n                          const profile = profiles[friendId];\r\n                          const displayName = profile?.username || `User ${friendId.substring(0, 8)}`;\r\n                          const displayAvatar = profile?.avatar_url || displayName.charAt(0).toUpperCase();\r\n                          \r\n                          return (\r\n                            <div key={friendId} className=\"flex items-center gap-3 p-3 rounded-lg bg-gray-800\">\r\n                              <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-accent-primary to-purple-600 flex items-center justify-center text-white font-bold\">\r\n                                {typeof displayAvatar === 'string' && displayAvatar.startsWith('http') ? (\r\n                                  <img src={displayAvatar} alt={displayName} className=\"w-full h-full rounded-full object-cover\" />\r\n                                ) : (\r\n                                  <span>{displayAvatar}</span>\r\n                                )}\r\n                              </div>\r\n                              <div className=\"flex-1 min-w-0\">\r\n                                <p className=\"font-medium text-white truncate\">{displayName}</p>\r\n                                <p className=\"text-xs text-gray-400 truncate\">{profile?.display_name || 'Online'}</p>\r\n                              </div>\r\n                              <button \r\n                                onClick={async () => {\r\n                                  // Create DM with friend\r\n                                  if (communityDb && user) {\r\n                                    try {\r\n                                      const dmConversation = await createDirectMessageConversation(user.id, friendId);\r\n                                      setConversations(prev => [...prev, dmConversation]);\r\n                                      setActiveConversation(dmConversation);\r\n                                    } catch (error) {\r\n                                      console.error('Failed to create DM:', error);\r\n                                    }\r\n                                  }\r\n                                }}\r\n                                className=\"px-3 py-1 bg-accent-primary text-white rounded text-sm hover:bg-accent-primary/90 border border-accent-primary\"\r\n                              >\r\n                                Message\r\n                              </button>\r\n                            </div>\r\n                          );\r\n                        })\r\n                      ) : (\r\n                        <div className=\"text-center py-8 text-gray-500\">\r\n                          <Users className=\"w-12 h-12 mx-auto text-gray-600 mb-4\" />\r\n                          <p>You don't have any friends yet</p>\r\n                          <p className=\"text-sm mt-2\">Search for users to add friends</p>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                \r\n                {activeCommunityTab === 'requests' && (\r\n                  <div className=\"space-y-6\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <h2 className=\"text-xl font-semibold\">Friend Requests</h2>\r\n                    </div>\r\n                    \r\n                    <div className=\"space-y-3\">\r\n                      {friendRequests.length > 0 ? (\r\n                        friendRequests.map((request: any) => {\r\n                          const isOutgoing = request.requester_id === user?.id;\r\n                          const otherUserId = isOutgoing ? request.addressee_id : request.requester_id;\r\n                          \r\n                          // Get profile from loaded profiles\r\n                          const otherUserProfile = profiles[otherUserId];\r\n                          const displayName = otherUserProfile?.username || `User ${otherUserId.substring(0, 8)}`;\r\n                          const displayAvatar = otherUserProfile?.avatar_url || displayName.charAt(0).toUpperCase();\r\n                          \r\n                          return (\r\n                            <div key={request.id} className=\"flex items-center gap-3 p-3 rounded-lg bg-gray-800\">\r\n                              <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-accent-primary to-purple-600 flex items-center justify-center text-white font-bold\">\r\n                                {typeof displayAvatar === 'string' && displayAvatar.startsWith('http') ? (\r\n                                  <img src={displayAvatar} alt={displayName} className=\"w-full h-full rounded-full object-cover\" />\r\n                                ) : (\r\n                                  <span>{displayAvatar}</span>\r\n                                )}\r\n                              </div>\r\n                              <div className=\"flex-1 min-w-0\">\r\n                                <p className=\"font-medium text-white truncate\">{displayName}</p>\r\n                                <p className=\"text-xs text-gray-400 truncate\">{isOutgoing ? 'Sent' : 'Received'}</p>\r\n                              </div>\r\n                              {isOutgoing ? (\r\n                                <span className=\"px-3 py-1 bg-yellow-600 text-yellow-100 rounded text-sm\">\r\n                                  Pending\r\n                                </span>\r\n                              ) : (\r\n                                <div className=\"flex gap-2\">\r\n                                  <button \r\n                                    onClick={async () => {\r\n                                      if (communityDb) {\r\n                                        await communityDb.updateFriendRequest(request.id, 'accepted');\r\n                                        // Refresh requests\r\n                                        const updatedRequests = await communityDb.getFriendRequests(user.id);\r\n                                        setFriendRequests(updatedRequests.filter((req: any) => req.status === 'pending'));\r\n                                        // Add to friends list\r\n                                        const newFriend = { user_id: user.id, friend_id: otherUserId, created_at: new Date().toISOString() };\r\n                                        setFriends(prev => [...prev, newFriend]);\r\n                                        \r\n                                        // Add profile to profiles\r\n                                        if (otherUserProfile) {\r\n                                          setProfiles(prev => ({ ...prev, [otherUserId]: otherUserProfile }));\r\n                                        }\r\n                                      }\r\n                                    }}\r\n                                    className=\"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-500\"\r\n                                  >\r\n                                    Accept\r\n                                  </button>\r\n                                  <button \r\n                                    onClick={async () => {\r\n                                      if (communityDb) {\r\n                                        await communityDb.updateFriendRequest(request.id, 'declined');\r\n                                        // Refresh requests\r\n                                        const updatedRequests = await communityDb.getFriendRequests(user.id);\r\n                                        setFriendRequests(updatedRequests.filter((req: any) => req.status === 'pending'));\r\n                                      }\r\n                                    }}\r\n                                    className=\"px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-500\"\r\n                                  >\r\n                                    Decline\r\n                                  </button>\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                          );\r\n                        })\r\n                      ) : (\r\n                        <div className=\"text-center py-8 text-gray-500\">\r\n                          <UserPlus className=\"w-12 h-12 mx-auto text-gray-600 mb-4\" />\r\n                          <p>No pending friend requests</p>\r\n                          <p className=\"text-sm mt-2\">Friend requests will appear here</p>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {activeCommunityTab === 'chat' && (\r\n                <div className=\"p-4 border-t border-card-border\">\r\n                  {errorMessage && (\r\n                    <div className=\"mb-2 p-2 bg-red-900/50 border border-red-700 rounded text-red-200 text-sm\">\r\n                      {errorMessage}\r\n                    </div>\r\n                  )}\r\n                  <div className=\"flex gap-3\">\r\n                    <div className=\"flex-1 relative\">\r\n                      <textarea\r\n                        value={newMessage}\r\n                        onChange={(e) => {\r\n                          setNewMessage(e.target.value);\r\n                          // Trigger typing indicator manually\r\n                          if (communityDb && activeConversation && user && e.target.value.trim() !== '') {\r\n                            communityDb.setTypingStatus(activeConversation.id, user.id, true);\r\n                                          \r\n                            // Clear any existing timeout\r\n                            if (typingTimeoutRef.current) {\r\n                              clearTimeout(typingTimeoutRef.current);\r\n                            }\r\n                                          \r\n                            // Set a new timeout to stop typing indicator after 2 seconds\r\n                            typingTimeoutRef.current = setTimeout(() => {\r\n                              communityDb.setTypingStatus(activeConversation.id, user.id, false);\r\n                            }, 2000);\r\n                          }\r\n                        }}\r\n                        onKeyPress={handleKeyPress}\r\n                        placeholder=\"Type your message here...\"\r\n                        className=\"w-full min-h-12 max-h-32 p-3 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-accent-primary focus:border-transparent resize-none\"\r\n                        rows={1}\r\n                      />\r\n                    </div>\r\n                    <div className=\"flex gap-2\">\r\n                      <button\r\n                        type=\"button\"\r\n                        className=\"self-end p-2 rounded-lg bg-gray-700 text-gray-300 hover:bg-gray-600\"\r\n                        onClick={() => {\r\n                          // Trigger file picker\r\n                          document.getElementById('attachment-input')?.click();\r\n                        }}\r\n                      >\r\n                        <Paperclip size={18} />\r\n                        <input\r\n                          id=\"attachment-input\"\r\n                          type=\"file\"\r\n                          className=\"hidden\"\r\n                          onChange={(e) => {\r\n                            const file = e.target.files?.[0];\r\n                            if (file) {\r\n                              setAttachment(file);\r\n                              // Show a temporary message indicating the file is being uploaded\r\n                              if (file && activeConversation && user) {\r\n                                const tempMessage = {\r\n                                  id: 'temp-' + Date.now(),\r\n                                  conversation_id: activeConversation.id,\r\n                                  sender_id: user.id,\r\n                                  content: `Uploading: ${file.name}`,\r\n                                  created_at: new Date().toISOString(),\r\n                                  is_attachment_upload: true\r\n                                };\r\n                                setMessages(prev => [...prev, tempMessage]);\r\n                              }\r\n                            }\r\n                          }}\r\n                        />\r\n                      </button>\r\n                      <button\r\n                        onClick={handleSendMessage}\r\n                        disabled={messageLoading || (!newMessage.trim() && !attachment)}\r\n                        className={`self-end px-4 py-2 rounded-lg flex items-center gap-2 hover-lift ${\r\n                          messageLoading || (!newMessage.trim() && !attachment)\r\n                            ? 'bg-gray-700 text-gray-500 cursor-not-allowed'\r\n                            : 'bg-accent-primary text-white hover:bg-accent-primary/90'\r\n                        }`}\r\n                      >\r\n                        <Send size={18} />\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                  <p className=\"text-xs text-gray-500 mt-2\">\r\n                    Press Enter to send, Shift+Enter for new line\r\n                  </p>\r\n                </div>\r\n              )}\r\n            </div>\r\n            \r\n            {/* Members sidebar */}\r\n            <div className=\"w-80 bg-card-bg border-l border-card-border flex flex-col\">\r\n              <div className=\"p-4 border-b border-card-border\">\r\n                <h2 className=\"text-lg font-bold text-white flex items-center gap-2\">\r\n                  <Users className=\"text-accent-primary\" size={20} />\r\n                  Members ({members.length})\r\n                </h2>\r\n              </div>\r\n              \r\n              <div className=\"flex-1 overflow-y-auto p-4\">\r\n                <div className=\"space-y-3\">\r\n                  {members.map((member) => {\r\n                    const isCurrentUser = member.user_id === user?.id;\r\n                    const displayUsername = isCurrentUser ? `${member.profiles?.username} (You)` : member.profiles?.username;\r\n                    const displayAvatar = member.profiles?.avatar_url || (member.profiles?.username?.charAt(0).toUpperCase() || 'M');\r\n                    \r\n                    return (\r\n                      <div key={member.user_id} className=\"flex items-center gap-3 p-2 rounded-lg hover:bg-gray-800\">\r\n                        <div className=\"w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center flex-shrink-0\">\r\n                          {typeof displayAvatar === 'string' && displayAvatar.startsWith('http') ? (\r\n                            <img src={displayAvatar} alt={displayUsername} className=\"w-full h-full rounded-full object-cover\" />\r\n                          ) : (\r\n                            <span className=\"text-accent-primary font-bold\">{displayAvatar}</span>\r\n                          )}\r\n                        </div>\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <p className=\"font-medium text-white truncate\">{displayUsername}</p>\r\n                          <p className=\"text-xs text-gray-500 truncate\">{member.profiles?.email}</p>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-700 text-gray-300\">\r\n                            {member.role}\r\n                          </span>\r\n                          {!isCurrentUser && (\r\n                            <div className=\"relative\">\r\n                              <button \r\n                                className=\"p-1 rounded hover:bg-gray-700\"\r\n                                onClick={() => {\r\n                                  // Show dropdown menu for block/report options\r\n                                  const dropdown = document.getElementById(`dropdown-${member.user_id}`);\r\n                                  if (dropdown) {\r\n                                    dropdown.classList.toggle('hidden');\r\n                                  }\r\n                                }}\r\n                              >\r\n                                <MoreVertical size={14} />\r\n                              </button>\r\n                              <div \r\n                                id={`dropdown-${member.user_id}`}\r\n                                className=\"hidden absolute right-0 mt-1 w-40 bg-gray-800 border border-gray-700 rounded-lg shadow-lg z-10\"\r\n                              >\r\n                                <div className=\"py-1\">\r\n                                  <button \r\n                                    className=\"block w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-red-900/50 hover:text-red-400\"\r\n                                    onClick={async () => {\r\n                                      if (communityDb && user) {\r\n                                        try {\r\n                                          await communityDb.blockUser(user.id, member.user_id);\r\n                                          setToastMessage('User blocked successfully');\r\n                                          setShowToast(true);\r\n                                          setTimeout(() => setShowToast(false), 3000);\r\n                                        } catch (error) {\r\n                                          console.error('Error blocking user:', error);\r\n                                          setToastMessage('Failed to block user');\r\n                                          setShowToast(true);\r\n                                          setTimeout(() => setShowToast(false), 3000);\r\n                                        }\r\n                                      }\r\n                                    }}\r\n                                  >\r\n                                    Block User\r\n                                  </button>\r\n                                  <button \r\n                                    className=\"block w-full text-left px-4 py-2 text-sm text-orange-500 hover:bg-orange-900/50 hover:text-orange-400\"\r\n                                    onClick={async () => {\r\n                                      // Prompt for report reason\r\n                                      const reason = prompt('Enter reason for reporting this user:');\r\n                                      if (reason && communityDb && user) {\r\n                                        try {\r\n                                          await communityDb.reportUser(user.id, member.user_id, reason);\r\n                                          setToastMessage('User reported successfully');\r\n                                          setShowToast(true);\r\n                                          setTimeout(() => setShowToast(false), 3000);\r\n                                        } catch (error) {\r\n                                          console.error('Error reporting user:', error);\r\n                                          setToastMessage('Failed to report user');\r\n                                          setShowToast(true);\r\n                                          setTimeout(() => setShowToast(false), 3000);\r\n                                        }\r\n                                      }\r\n                                    }}\r\n                                  >\r\n                                    Report User\r\n                                  </button>\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Toast notification for multi-tab auth changes */}\r\n        <ToastNotification \r\n          message={toastMessage}\r\n          isVisible={showToast}\r\n          onClose={() => setShowToast(false)}\r\n          onReload={handleReload}\r\n        />\r\n      </AppShell>\r\n    </ProtectedRoute>\r\n  );\r\n};\r\n\r\nexport default SocialPage;","import React, { useState, useEffect } from 'react';\r\n\r\ninterface ToastNotificationProps {\r\n  message: string;\r\n  isVisible: boolean;\r\n  onClose: () => void;\r\n  onReload?: () => void;\r\n}\r\n\r\nconst ToastNotification: React.FC<ToastNotificationProps> = ({ \r\n  message, \r\n  isVisible, \r\n  onClose, \r\n  onReload \r\n}) => {\r\n  if (!isVisible) return null;\r\n\r\n  return (\r\n    <div className=\"fixed top-4 right-4 z-50\">\r\n      <div className=\"bg-gray-800 border border-gray-700 rounded-lg shadow-lg p-4 max-w-sm flex items-start\">\r\n        <div className=\"flex-1\">\r\n          <p className=\"text-white text-sm\">{message}</p>\r\n        </div>\r\n        <div className=\"ml-4 flex gap-2\">\r\n          {onReload && (\r\n            <button\r\n              onClick={onReload}\r\n              className=\"px-3 py-1 bg-accent-primary text-white text-xs rounded hover:bg-accent-primary/90 transition-colors hover-lift\"\r\n            >\r\n              Reload\r\n            </button>\r\n          )}\r\n          <button\r\n            onClick={onClose}\r\n            className=\"px-3 py-1 bg-gray-700 text-white text-xs rounded hover:bg-gray-600 transition-colors hover-lift\"\r\n          >\r\n            Close\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ToastNotification;","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['circle', { cx: '10', cy: '7', r: '4', key: 'e45bow' }],\n  ['path', { d: 'M10.3 15H7a4 4 0 0 0-4 4v2', key: '3bnktk' }],\n  ['circle', { cx: '17', cy: '17', r: '3', key: '18b49y' }],\n  ['path', { d: 'm21 21-1.9-1.9', key: '1g2n9r' }],\n];\n\n/**\n * @component @name UserSearch\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSIxMCIgY3k9IjciIHI9IjQiIC8+CiAgPHBhdGggZD0iTTEwLjMgMTVIN2E0IDQgMCAwIDAtNCA0djIiIC8+CiAgPGNpcmNsZSBjeD0iMTciIGN5PSIxNyIgcj0iMyIgLz4KICA8cGF0aCBkPSJtMjEgMjEtMS45LTEuOSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/user-search\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst UserSearch = createLucideIcon('user-search', __iconNode);\n\nexport default UserSearch;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M5 12h14', key: '1ays0h' }],\n  ['path', { d: 'M12 5v14', key: 's699le' }],\n];\n\n/**\n * @component @name Plus\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNNSAxMmgxNCIgLz4KICA8cGF0aCBkPSJNMTIgNXYxNCIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/plus\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Plus = createLucideIcon('plus', __iconNode);\n\nexport default Plus;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['line', { x1: '4', x2: '20', y1: '9', y2: '9', key: '4lhtct' }],\n  ['line', { x1: '4', x2: '20', y1: '15', y2: '15', key: 'vyu0kd' }],\n  ['line', { x1: '10', x2: '8', y1: '3', y2: '21', key: '1ggp8o' }],\n  ['line', { x1: '16', x2: '14', y1: '3', y2: '21', key: 'weycgp' }],\n];\n\n/**\n * @component @name Hash\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8bGluZSB4MT0iNCIgeDI9IjIwIiB5MT0iOSIgeTI9IjkiIC8+CiAgPGxpbmUgeDE9IjQiIHgyPSIyMCIgeTE9IjE1IiB5Mj0iMTUiIC8+CiAgPGxpbmUgeDE9IjEwIiB4Mj0iOCIgeTE9IjMiIHkyPSIyMSIgLz4KICA8bGluZSB4MT0iMTYiIHgyPSIxNCIgeTE9IjMiIHkyPSIyMSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/hash\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Hash = createLucideIcon('hash', __iconNode);\n\nexport default Hash;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z',\n      key: '1oefj6',\n    },\n  ],\n  ['path', { d: 'M14 2v5a1 1 0 0 0 1 1h5', key: 'wfsgrz' }],\n];\n\n/**\n * @component @name File\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNNiAyMmEyIDIgMCAwIDEtMi0yVjRhMiAyIDAgMCAxIDItMmg4YTIuNCAyLjQgMCAwIDEgMS43MDQuNzA2bDMuNTg4IDMuNTg4QTIuNCAyLjQgMCAwIDEgMjAgOHYxMmEyIDIgMCAwIDEtMiAyeiIgLz4KICA8cGF0aCBkPSJNMTQgMnY1YTEgMSAwIDAgMCAxIDFoNSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/file\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst File = createLucideIcon('file', __iconNode);\n\nexport default File;\n"],"names":[],"mappings":"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A,AEAO,EAAiB,CFAX,AEAW,CAAA,AFAX,CEAW,AFAX,CAAA,AEAW,uBAjBJ,CFAD,AEAC,ADAV,OCAoB,WAAc,CAAA,AFAH,CEAG,AFAH,CAAA,AEAG,CFAH,AEAG,QAAK,CAAU,CAAA,yBACjC,GAAI,CDAH,ADAjB,AEAoB,CDAH,ADAjB,AEAoB,CFApB,AEAoB,ADAH,CDAjB,ACAiB,ACAG,CAAA,AFApB,QEAoC,CFAD,AEAC,CFAD,AEAC,CFAD,AEAC,CFAD,AEAC,QAAK,CAAU,CAAA,SACxD,SAAY,CAAA,EAAA,IAAS,CFAH,CEAG,AFAH,CAAA,IEAY,CFAH,AEAG,EAAI,CFAF,AEAE,CFAF,AEAE,GAAM,CFAH,AEAG,CAAA,AFAH,CAAA,AEAG,CFAH,AEAG,AAAK,QAAA,CAAU,CAAA,6BAC7B,6FFclB,CEAN,AFAM,CEAN,AFAM,CEAN,AFAM,CEAN,AFAM,CEAN,AFAM,IAAA,EAAA,eAAgC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAU,CAAA,AAjB9C,GAAI,CAAA,ACAH,ACAC,CFAE,AEAF,ADAD,GDAS,GAAI,CEAH,ADAE,CAAA,ACAF,EFAQ,CCAD,ACAD,AFAE,CAAG,CCAJ,ACAG,AFAC,CAAA,ACAJ,ACAG,CFAC,ACAJ,ACAG,CFAM,CCAC,ACAF,GFAM,CEAF,AFAE,CAAA,QAAU,CEAF,CAAA,CAAA,CAAA,yCFCJ,UAAU,CEAJ,CAAA,SFC5C,CEAA,AFAA,AAAE,GAAI,CEAF,AFAE,CEAF,AFAE,CAAA,AEAF,KFAY,CEAF,CAAA,GFAQ,EAAG,CEAF,AFAE,CEAF,AFAE,MAAU,CEAH,AFAG,CAAA,oFGmBnC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,EAAA,EAAiB,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,EAAQ,CAAA,AApBlC,CFAD,AEAC,ADAD,AFAA,AGoBmC,CAAA,CAAA,CAAA,CAAA,CAAA,CAnBlC,AAmBkC,CDnBnC,ACCG,AAkBgC,CHlBnC,AGAG,AAkB0C,CAAA,AHlB7C,AGAM,iHACH,GAAA,CAAA,AAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA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","ignoreList":[3,4,5,6]}